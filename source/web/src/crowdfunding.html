<!--@@master = masters/master.html-->

<!--@@block = custom_header-->
<div class="propertyHeader_phone  rmm" >
    <div class="rmm-toggled rmm-closed rmm-center-closed">
        <div class="rmm-toggled-controls">
            <div class="rmm-button">
                <img src="/static/images/common/header/phone/menu.png"/>
            </div>
            <div id="rmm-center-wrapper" class="rmm-center">
                <label id="newsHeader_title" class="title" for="">
                    %if property:
                        {{property.get('name',_('房产详情'))}}
                    %end
                </label>
            </div>
            <div class="rmm-toggled-share">
                <img src="/static/images/property_details/phone/wechat_share.png" />
            </div>
        </div>
        <ul class="rmm-menu" style="display:none;">
            <li><a href="/">{{_('首页')}}</a></li>
            <li><a href="/property_list">{{_('海外房产')}}</a></li>
            <li><a href="/news_list">{{_('投资资讯')}}</a></li>
        </ul>
    </div>
</div>

<!--@@close-->

<!--@@block = head-->
%if property:
    % property_type_slug = property.get('property_type',{}).get('slug')

    % tags = []
    % if 'intention' in property and property.get('intention'):
        % tags = [item['value'] for item in property['intention'] if 'value' in item]
    % end
    % tagString = ', '.join(tags)

    % from bottle import request


    <!-- cause video-js.css has related path font resource, so package in the same dir-->
    <!--build:css(dist) /static/vendors/video-js/video-js.css-->
    <link rel="stylesheet" href="/static/vendors/video-js/video-js.css">
    <!--endbuild-->

    <!--build:css(dist) /static/styles/property.html.css-->
    <link rel="stylesheet" href="/static/styles/propertyDetails.css"/>
    <link rel="stylesheet" href="/static/styles/propertyCard.css"/>
    <link rel="stylesheet" href="/static/styles/crowdfunding.css"/>
    <link rel="stylesheet" href="/static/styles/project/tabbar.css"/>
    <link rel="stylesheet" href="/static/styles/phone/wechatSharePopup.css"/>
    <link rel="stylesheet" href="/static/vendors/jcarousel/jcarousel.responsive.css"/>
    <!--endbuild-->

    <!-- minor change from original repo https://github.com/Fykec/excanvas, detail can check change log -->
    <!--[if lte IE 8]>
    <script type="text/javascript" src="/static/vendors/excanvas.min.js"></script>
    <![endif]-->

    <!--@@close-->
    <!--@@block = main-->
    <div class="propertyDetails">
        <div class="breadcrumb">
            % if property.get('country').get('value'):
            <a class="parent" href="/property_list?country={{property.get('country',{}).get('id')}}" target="_blank">{{property.get('country',{}).get('value','')}}</a> /
            % end
            % if property.get('city').get('value'):
            <a class="parent" href="/property_list?country={{property.get('country',{}).get('id')}}&city={{property.get('city',{}).get('id')}}" target="_blank">{{property.get('city',{}).get('value','')}}</a> /
            % end
            % if property.get('property_type') and property.get('property_type').get('value'):
            <a class="parent" href="/property_list?country={{property.get('country',{}).get('id')}}&city={{property.get('city',{}).get('id')}}&property_type={{property.get('property_type').get('id')}}" target="_blank">{{property.get('property_type',{}).get('value','')}}</a> /
            %end
            <span class="current">{{property.get('name','')}}</span>
        </div>
        <div class="content">
            <div class="pictures" data-tabs>
                <div class="labels">
                    <label class="type" for="">
                        租金产权
                    </label>
                    <label class="rent" for="">
                        剩余10天
                    </label>
                </div>

                <div class="big">
                    % for name in ['reality_images','surroundings_images','floor_plan','effect_pictures',
                        % 'indoor_sample_room_picture','planning_map']:
                        <div class="item" data-tab-name="{{name}}">
                            % if property.get(name):
                                <div class="rslides_wrapper">
                                    <ul class="rslides">
                                        % for image in property.get(name):
                                            <li>
                                                <div class="img" style="background:url('{{!fetch_image(image, property_id=property.get('id'))}}') no-repeat;background-size: cover; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{{!fetch_image(image, property_id=property.get('id'))}}', sizingMethod='scale');"></div>
                                            </li>
                                        % end
                                    </ul>
                                    <div class="leftPressArea"></div>
                                    <div class="rightPressArea"></div>
                                </div>
                            % else :
                                <img class="withPlaceholder" alt=""/>
                            % end
                        </div>
                    % end

                    % # Make sure property have videos and every video have at least one source
                    % if property.get('videos') and all(map(lambda x: len(x["sources"]) > 0, property.get('videos'))):
                    <div class="item videocontent" data-tab-name="video">
                        <video id="property_video" class="video-js vjs-default-skin vjs-big-play-centered"
                            controls preload="auto" width="auto" height="auto"
                            poster="/static/images/placeholder/video_holder_800x_141114.jpg"
                            data-setup='{}'>
                            % rec_videos = get_videos_by_ip(property.get('videos'))
                            % if(rec_videos and len(rec_videos) > 0):
                                % if "iphone" in request.headers.get('User-Agent').lower() :
                                    % for source in [x for x in rec_videos[0].get('sources') if "mobile-ios" in x["tags"]] :
                                    <source src="{{source.get('url')}}" type="{{source.get('type')}}"/>
                                    % end
                                % else :
                                    % for source in [x for x in rec_videos[0].get('sources') if "web-normal" in x["tags"]] :
                                    <source src="{{source.get('url')}}" type="{{source.get('type')}}"/>
                                    % end
                                % end
                            % end
                            <p class="vjs-no-js">{{!_('对不起，您的浏览器不支持视频播放，请下载<a href="http://se.360.cn/" target="_blank">360安全浏览器</a>或者最新的<a href="http://get.adobe.com/flashplayer/" target="_blank">Adobe Flash</a>重新打开')}}</p>
                        </video>
                    </div>
                    % end
                </div>

                <div class="thumbnails">
                    <ul>
                        % if property.get('reality_images', []) and len(property.get('reality_images', [])):
                            <li data-tab="reality_images">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('reality_images')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt="" />
                                <span class="text_wrapper"> <span class="text">{{_('实景图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('surroundings_images'):
                            <li data-tab="surroundings_images">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('surroundings_images')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt="" />
                                <span class="text_wrapper"> <span class="text">{{_('设施图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('floor_plan'):
                            <li data-tab="floor_plan">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('floor_plan')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt=""/>
                                <span class="text_wrapper"> <span class="text">{{_('户型图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('effect_pictures'):
                            <li data-tab="effect_pictures">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('effect_pictures')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt=""/>
                                <span class="text_wrapper"> <span class="text">{{_('效果图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('indoor_sample_room_picture'):
                            <li data-tab="indoor_sample_room_picture">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('indoor_sample_room_picture')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt=""/>
                                <span class="text_wrapper"> <span class="text">{{_('样板间图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('planning_map'):
                            <li data-tab="planning_map">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('planning_map')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt=""/>
                                <span class="text_wrapper"> <span class="text">{{_('规划图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('videos') and all(map(lambda x: len(x["sources"]) > 0, property.get('videos'))):
                        <li data-tab="video">
                            <img onerror="window.onImgError(this);" src="/static/images/placeholder/video_holder_150x_141114.jpg" alt=""/>
                            <span class="text_wrapper"> <span class="text">{{_('视频')}}</span></span>
                            <span class="border"></span>
                        </li>
                        % end
                    </ul>
                </div>
            </div>

            <table class="propertyCard_phone">
                <tr>
                    <td class="left">
                        <table>
                            <tr>
                                <td>
                                    <h1 class=name>{{property.get('name')}}</h1>
                                    % if 'intention' in property and property.get('intention'):
                                        <div class="tag">
                                            <img src="/static/images/property_details/phone/tag-icon-phone.png" height=12 alt=""/>
                                            <label>
                                                {{tagString}}
                                            </label>
                                        </div>
                                    % end
                                    % if 'country' in property or 'city' in property:
                                        % country = property.get('country',{}).get('value')
                                        % city = property.get('city',{}).get('value')
                                        % city_string = ', '.join([x for x in [country,city] if x])
                                        <div class="tag">
                                            <img src="/static/images/property_details/phone/location-icon-phone.png" height=12 alt=""/>
                                            <label>
                                                {{city_string}}
                                            </label>
                                        </div>
                                    % end
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td class="middle">
                        <table>
                            <tr>
                                <td>
                                    <label class=price>
                                        <!--@@include=partials/get_unit_price.html  -->
                                    </label>
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td class="right">
                        <table>
                            <tr>
                                <td>
                                    <a href="/calculator?property={{property.get('id')}}" class=calculator>
                                        <img src="/static/images/property_details/phone/calculator.png"/>
                                    </a>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>

            <table class="numbers_phone">
                <tr>
                    %if property.get('annual_return_estimated'):
                        <td>
                            <span class="text">{{!_('预计总年化收益率')}}</span>
                            <span class="percentage emphasized"><strong>
                                {{property.get('annual_return_estimated')}}
                            </strong></span>
                        </td>
                    % end

                    %if property.get('annual_cash_return_estimated'):
                        <td>
                            <span class="text">{{!_('预估现金年化收益率')}}</span>
                            <span class="percentage emphasized"><strong>
                                {{property.get('annual_cash_return_estimated')}}
                            </strong></span>
                        </td>
                    %end
                </tr>
            </table>

            %if property.get('highlight'):
                <div class="advantages">
                    <ul>
                        % for item in property.get('highlight'):
                            <li>{{item}}</li>
                        %end
                    </ul>
                </div>
            %end
            <div id="propertyDetails_description" class="meta">
                % if property_type_slug != 'new_property' and property_type_slug != 'student_housing':
                    <ul class="numbers">
                        <li>
                            {{_('房屋面积')}}
                            % if property.get('space'):
                                <strong>
                                    {{float("{0:.2f}".format(float(property.get('space',{}).get('value',0))))}}
                                    <span class="unit">
                                        {{!format_unit(property.get('space',{}).get('unit',''))}}
                                    </span>
                                </strong>
                            % end
                        </li>
                        % if property.get('bedroom_count','') :
                            <li>
                                {{_('卧室')}}
                                <strong>{{ property.get('bedroom_count','') }}</strong>
                            </li>
                        % end

                        % if property.get('bathroom_count') :
                            <li>
                                {{_('卫生间')}}
                                <strong>{{ property.get('bathroom_count') }}</strong>
                            </li>
                        % end

                        % if property.get('living_room_count',''):
                            <li>
                                {{_('客厅')}}
                                <strong>{{ property.get('living_room_count','') }}</strong>
                            </li>
                        % end

                        % if property.get('kitchen_count','') :
                            <li>
                                {{_('厨房')}}
                                <strong>{{ property.get('kitchen_count','') }}</strong>
                            </li>
                        % end
                    </ul>
                    <hr/>
                %end
                <table class="other">
                    <colgroup>
                        <col class="col-name">
                        <col>
                        <col class="col-name">
                        <col>
                    </colgroup>
                    <tbody>
                        <tr>
                            <td class="name">
                                <i>
                                    <img src="/static/images/property_details/icon-house.png" alt=""/>
                                    </i>
                                    <label>
                                    {{_('产权类型')}}
                                    </label>
                            </td>
                            <td class="value">
                                {{property.get('equity_type',{}).get('value','') }}
                            </td>
                        </tr>
                        % if 'decorative_style' in property:
                            <tr>
                                <td class="name">
                                    <i>
                                        <img src="/static/images/property_details/icon-pallet.png" alt=""/>
                                        </i>
                                        <label>
                                        {{_('装修风格')}}
                                        </label>
                                </td>
                                <td class="value">
                                    {{property.get('decorative_style',{}).get('value')}}
                                </td>
                            </tr>
                        % end
                        % if 'address' in property:
                        <tr>
                            <td class="name">
                                <i>
                                    <img src="/static/images/property_details/icon-location.png" alt=""/>
                                    </i>
                                    <label>
                                    {{_('产权地址')}}
                                    </label>
                            </td>
                            <td class="value">
                                {{property.get('address')}}
                            </td>
                        </tr>
                        % end
                        % if 'street' in property:
                        <tr>
                            <td class="name">
                                <i>
                                    <img src="/static/images/property_details/icon-map.png" alt=""/>
                                    </i>
                                    <label>
                                    {{_('街区')}}
                                    </label>
                            </td>
                            <td class="value">
                                {{property.get('street','')}}
                                %if (report):
                                    <a class="street-link" style="display: none" target="_blank" href="/region_report/{{property.get('zipcode_index')}}">
                                        {{_(' (查看详细街区报告)')}}
                                    </a>
                                %end
                            </td>
                        </tr>
                        % end
                        % if property_type_slug == 'new_property' or property_type_slug == 'student_housing':
                            <tr>
                                <td colspan="1" class="name">
                                    <i>
                                        <img src="/static/images/property_details/icon-kaleidoscope.png" alt=""/>
                                        </i>
                                        <label for="">
                                        {{_('主要户型')}}
                                        </label>
                                </td>
                                <td colspan="3" class="value">
                                    % if property.get('main_house_types'):
                                        % for type in property.get('main_house_types'):
                                            <a href="#propertyDetails_houseTypes">
                                                <span class="toggleTag selected">
                                                    %if 'bedroom_count' in type and type.get('bedroom_count') != 0:
                                                    {{type.get('bedroom_count',0)}}{{_('室')}}
                                                    %end
                                                    %if 'living_room_count' in type and type.get('living_room_count') != 0:
                                                    {{type.get('living_room_count',0)}}{{_('厅')}}
                                                    %end
                                                    % if 'value' in type.get('building_area',{}) and 'unit' in type.get('building_area',{}):
                                                        (
                                                        {{float("{0:.2f}".format(float(type.get('building_area',{}).get('value'))))}}
                                                        {{!format_unit(type.get('building_area',{}).get('unit',''))}}
                                                        )
                                                    % end
                                                </span>
                                            </a>
                                        % end
                                    % end
                                </td>
                            </tr>
                        % end
                    </tbody>
                </table>
            </div>

            %if property.get('description'):
                <div class="description" data-ui="description">
                    {{!property.get('description')}}
                </div>
                <div class="clearfix expendDescription_wrapper">
                    <button data-fn="expendDescription" class="ghostButton red" >{{_('展开')}}</button>
                </div>
                <hr/>
            %end

            <div class="team">
                <h3 class="propertyDetails_title">{{_('管理团队')}}</h3>
                <p class="des">
                    The Sponsor is an experienced real estate principal investor and investment management firm headquartered in Los
Angeles, California with an investment focus on distressed real estate investments in the middle market sector throughout
the United States. The Oro team collectively brings more than 80 years of experience in principal real estate investing, with
Oro's principals having invested in over $3 billion in assets over the past 20 years. Oro currently owns a 180,694 square
foot multi-suite flex center similar to the Property located less than 20 miles west in Upland, CA. Oro will hire 1st
Commercial Realty Group for on-site management of the Property. In addition to managing hundreds of properties across
the west and southwest encompassing more than 20 million square feet, 1st Commercial is headquartered in Upland, CA,
which is 20 miles west of the Property, and currently manages the Sponsor's multi-suite flex center located in Upland
mentioned above. They are a 24 hour-a-day firm with experience in managing this property type.
                </p>
                <ul class="members">
                    <li class="member">
                        <div class="avatar_wrapper">
                            <div class="avatar" style="background-image: url(/static/images/placeholder/avatar.png)"></div>
                            <img class="linkedin" alt="" src="/static/images/crowdfunding/linkedin.png"/>
                        </div>
                        <label class="name" for="">Max MaxManMan</label>
                        <label class="position" for="">Managing Partner</label>
                    </li>
                     <li class="member">
                        <div class="avatar_wrapper">
                            <div class="avatar" style="background-image: url(/static/images/placeholder/avatar.png)"></div>
                            <img class="linkedin" alt="" src="/static/images/crowdfunding/linkedin.png"/>
                        </div>
                        <label class="name" for="">Max MaxManMan</label>
                        <label class="position" for="">Managing Partner</label>
                     </li>
                      <li class="member">
                        <div class="avatar_wrapper">
                            <div class="avatar" style="background-image: url(/static/images/placeholder/avatar.png)"></div>
                            <img class="linkedin" alt="" src="/static/images/crowdfunding/linkedin.png"/>
                        </div>
                        <label class="name" for="">Max MaxManMan</label>
                        <label class="position" for="">Managing Partner</label>
                    </li>
                </ul>
                <hr/>
            </div>

            <div class="materials">
                <h3 class="propertyDetails_title">{{_('相关资料')}}</h3>
                <ul>
                    <li class="material">
                        <img alt="" src="/static/images/crowdfunding/material.png"/>
                        <div class="text">
                            <label class="type" for="">PDF</label>
                            <label class="name" for="">项目描述</label>
                        </div>
                    </li>
                    <li class="material">
                        <img alt="" src="/static/images/crowdfunding/material.png"/>
                        <div class="text">
                            <label class="type" for="">PDF</label>
                            <label class="name" for="">投资合同</label>
                        </div>
                    </li>
                    <li class="material">
                        <img alt="" src="/static/images/crowdfunding/material.png"/>
                        <div class="text">
                            <label class="type" for="">PDF</label>
                            <label class="name" for="">股份转让合同</label>
                        </div>
                    </li>
                </ul>
                <hr/>
            </div>


            %if (report):
                <div class="regionReport" id="regionReport">
                    %if (report.get('image')):
                    <img alt="" src="" style="background:url('{{!fetch_image(report.get('image'))}}') no-repeat;background-size: cover; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{{!fetch_image(report.get('image'))}}', sizingMethod='scale');"/>
                    %else:
                    <img alt="" src="" style="background:url('/static/images/background/login-background.jpg') no-repeat;background-size: cover; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/static/images/background/login-background.jpg', sizingMethod='scale');"/>
                    %end
                    <div class="img_shadow"></div>
                    <div class="text_container">
                        <div class="text">
                            <h1 class="name">
                                {{report.get('name')}}
                            </h1>
                            <p class="des">
                                {{report.get('description')}}
                            </p>
                            <a class="ghostButton detail" href="/region_report/{{report.get('zipcode_index')}}" target="_blank">
                                {{_('查看详细街区报告')}}
                            </a>
                        </div>
                    </div>
                </div>
            %end
        </div>
        <div class="aside">
            <div class="propertyCard">
                <h1>{{property.get('name','')}}</h1>
                % if 'intention' in property and property.get('intention'):
                    <div class="tag">
                        <img src="/static/images/property_details/tag-icon.png" alt=""/>
                        <label>
                            {{tagString}}
                        </label>
                    </div>
                % end
                % if 'country' in property or 'city' in property:
                    % country = property.get('country',{}).get('value')
                    % city = property.get('city',{}).get('value')
                    % city_string = ', '.join([x for x in [country,city] if x])
                    <div class="tag">
                        <img src="/static/images/property_details/location-icon.png" alt=""/>
                        <label>
                            {{city_string}}
                        </label>
                    </div>
                % end

                %if property.get('total_price') or property.get('unit_price') or (property.get('main_house_types') and len(property.get('main_house_types'))):
                    <div class="price">
                        <table>
                            <tr>
                                <td class="price_inner">
                                    <!--@@include=partials/get_unit_price.html  -->
                                </td>
                                %if property.get('status') == 'sold out':
                                    <td class="soldOut">
                                        <span>{{_('售罄')}}</span>
                                    </td>
                                %end
                            </tr>
                        </table>
                    </div>
                %end

                <table class="numbers">
                    <tr>
                        %if property.get('annual_return_estimated'):
                            <td>
                                <span class="percentage emphasized"><strong>
                                    {{property.get('annual_return_estimated')}}
                                </strong></span>
                                <span class="text">{{!_('预计总<br/>年化收益率')}}</span>
                            </td>
                        % end

                        %if property.get('annual_cash_return_estimated'):
                            <td>
                                <span class="percentage emphasized"><strong>
                                    {{property.get('annual_cash_return_estimated')}}
                                </strong></span>
                                <span class="text">{{!_('预估现金<br/>年化收益率')}}</span>
                            </td>
                        %end
                    </tr>
                </table>

                <hr/>
                <table class="actions">
                    <tr>
                        <td style="text-align:left;">
                            % isFavorite = property.get('id') in [i.get('property',{}).get('id') for i in favorite_list]
                            <button data-fn="addFav" data-property-id="{{property.get('id','')}}"
                                    class="flatButton"
                                    style="{{ 'display:none' if isFavorite else ''}}"
                                    data-message-40090="{{_('已经收藏过了')}}"
                                    >
                                <img src="/static/images/property_details/icon-star.png" alt=""/>
                                <span class="text"> {{_('收藏')}} </span>
                            </button>
                            <button data-fn="removeFav"
                                    class="flatButton"
                                    style="{{ 'display:none' if not isFavorite else ''}}"
                                    % if isFavorite:
                                    % foundId = [x for x in favorite_list if x.get('property',{}).get('id') == property.get('id')][0].get('id')
                                    data-favorite-id="{{foundId}}"
                                    % end
                                    >
                                    <img src="/static/images/property_details/icon-star.png" alt=""/>
                                    <span class="text"> {{_('取消收藏') }} </span>
                            </button>
                        </td>
                        <td style="text-align:center;">
                            <button data-fn="shareToWeChat" class="flatButton green">
                                <img src="/static/images/property_details/icon-wechat.png" alt=""/>
                                {{_('分享到微信')}}
                            </button>
                        </td>
                        <td style="text-align:right;">
                            % name = property.get('name','')
                            <button class="flatButton orange" onclick="team.shareToWeibo({title:'{{name}}'}) ">
                                <img src="/static/images/property_details/icon-weibo.png" alt=""/>
                                {{_('分享到微博')}}
                            </button>
                        </td>
                    </tr>
                </table>
            </div>


            % if 'intention' in property and property.get('intention'):
                % item_width = '25%'
                %if len(property.get('intention')) > 4:
                    % item_width = str("{0:.2f}".format(float(1.0 / len(property.get('intention'))) * 100))  + '%'
                %end
                <div class="intentionTags" data-tabs>
                    <h2 class="propertyDetails_title">{{_('投资标签')}}</h2>
                    <ul class="tab">
                        % for intention in property.get('intention'):
                            %if intention.get('slug') and intention.get('value'):
                                <li data-tab="{{intention.get('slug','')}}" style="width:{{item_width}}">
                                    <div class="image_wrapper">
                                        <img src="/static/images/intention/icon/{{intention.get('slug')}}-red.png" alt=""/>
                                    </div>
                                    <div class="text">
                                        {{intention.get('value')}}
                                    </div>
                                </li>
                            %end
                        % end
                    </ul>
                    <ul class="content">
                        % for intention in property.get('intention') :
                            <li data-tab-name="{{intention.get('slug','')}}">
                                {{intention.get('description','')}}
                            </li>
                        % end
                    </ul>
                </div>
                <hr/>
            % end
             <div class="relatedProperties">
                 <h2 class="title">{{_('相关房产')}}</h2>
                 <ul>
                     % main_property = property
                     % for property in related_property_list:
                         <li class="propertyItem">
                             <a href="/property/{{property.get('id')}}">
                                 %if (property.get('cover')):
                                     <img src="{{!fetch_image(property.get('cover'), thumbnail=True, property_id=property.get('id'))}}" onerror="window.onImgError(this);" width="320" height="213"/>
                                 %elif (property.get('reality_images') and len(property.get('reality_images'))):
                                     <img src="{{!fetch_image(property.get('reality_images')[0], thumbnail=True, property_id=property.get('id'))}}" onerror="window.onImgError(this);" width="320" height="213"/>
                                 %else :
                                     <img class="withPlaceholder" width="320" height="213"/>
                                 %end
                                 <div class="img_shadow"></div>
                                 <div class="text">
                                     <h3 class="title">
                                         {{property.get('name')}}
                                     </h3>
                                     <label class="price">
                                         <!--@@include=partials/get_unit_price.html  -->
                                     </label>
                                 </div>
                             </a>
                         </li>
                     % end
                     % property = main_property
                 </ul>
             </div>
        </div>

    </div>

    <div id="popupShareToWeChat" style="display:none; text-align:center;font-size: 12px;">
        <img src="" alt="二维码" width="220" height="220"/>
        <p>{{_('打开微信，使用 “扫一扫” 即可将网页分享到朋友圈')}}</p>
    </div>

    <div class="wechatPage_popup" style="display:none;">
        <h1 class="tip"> {{!_('点击右上角')}}</h1>
        <img class="buttonHolder"  alt="" src="/static/images/property_details/wechat_share/phone/wechat_button.png"/>
        <h1 class="tip"> {{!_('分享链接给微信好友')}}</h1>
        <div class="guide">
            <img  alt="" src="/static/images/property_details/wechat_share/phone/wechat_guide.png"/>
        </div>
        <a class="gotIt" href ="#close-modal" rel="modal:close">{{_('我知道了')}}</a>
    </div>

    <ul class="floatBar_phone">
        <li class="favorite"
            data-fn="addFav"
            data-property-id="{{property.get('id','')}}"
            style="{{ 'display:none' if isFavorite else ''}}"
            data-message-40090="{{_('已经收藏过了')}}"
            ><img src="/static/images/property_details/phone/favorite.png"></img></li>
        <li class="favorite"
            data-fn="removeFav"
            style="{{ 'display:none' if not isFavorite else ''}}"
            % if isFavorite:
            % foundId = [x for x in favorite_list if x.get('property',{}).get('id') == property.get('id')][0].get('id')
            data-favorite-id="{{foundId}}"
            % end
            ><img src="/static/images/property_details/icon-star.png"></img></li>
        <li class="phone"><a href="tel:4000926433" >{{_('拨打400-0926-433')}}</a></li>
        <li class="requirement"><a href="/requirement?property={{property.get('id')}}"><img src="/static/images/property_details/phone/requirement.png"></img></a></li>
    </ul>


    <textarea id="pythonProperty" style="display: none;">
        {{json_dumps(property)}}
    </textarea>


    <!--@@close-->

    <!--@@block = scripts-->
    <script src="/static/vendors/Chart.min.js"></script>

    <script>
     (function () {
         $('.rmm-toggled .rmm-toggled-controls .rmm-toggled-share').on('click', function () {
             window.openWeChatShare('{{property.get('id')}}')
             ga('send', 'event', 'property_detail', 'share', 'open-wechat-mobile')
         });

         window.openWeChatShare = function (propertyId) {
             if (window.team.isWeChat()) {
                 if (window.team.isWeChatiOS()) {
                     $('.wechatPage_popup .buttonHolder').attr('src', '/static/images/property_details/wechat_share/phone/wechat_button_ios.png')
                 }
                 $('.wechatPage_popup').modal()
                 $('.wechatPage_popup').find('.close-modal').hide()
             }
             else {
                 location.href = "/wechat_share?property=" + propertyId
             }
         }

         function updateResponsiveSlides($slide, auto) {
             $slide.responsiveSlides({
                 pager: true,
                 auto: auto,
                 nav: true,
                 pause: true,
                 prevText: '<',
                 nextText: '>'
             })
         }

         updateResponsiveSlides($('.pictures .rslides'), true)

         $('.rslides_wrapper .leftPressArea').click(function (event) {
             $(event.target).parent().find('a.prev').click()

             ga('send', 'event', 'property_detail', 'click', 'prev-image',$(event.target).parent().parent().attr('data-tab-name'))
         })

         $('.rslides_wrapper .rightPressArea').click(function (event) {
             $(event.target).parent().find('a.next').click()

             ga('send', 'event', 'property_detail', 'click', 'next-image',$(event.target).parent().parent().attr('data-tab-name'))
         })


         $('[data-tabs]').tabs({trigger: 'click'}).on('openTab', function (event, target, tabName) {
             if (tabName === 'video') {
                 //Hide labels to show no-video-js text and for better video experience
                 $('.content .pictures .labels').hide()
             }else{
                 $('.content .pictures .labels').show()
             }

             ga('send', 'event', 'property_detail', 'click', 'change-tab',tabName)
         })



         $('[data-fn=addFav]').on('click', function () {
             ga('send', 'event', 'property_detail', 'click', 'add-fav')
             if (window.project.checkLoginIfNot()) {
                 return
             }
             var $button = $(this)
             var property_id = $button.attr('data-property-id')

             $.betterPost('/api/1/user/favorite/add', {
                 property_id: property_id
             })
                                      .done(function (val) {
                                          $button.hide().parent().find('[data-fn=removeFav]').show().attr('data-favorite-id', val)

                                          ga('send', 'event', 'property_detail', 'click', 'add-fav-success')
                                      })
                                      .fail(function (errorCode) {
                                          if (errorCode === 40100) {

                                          } else {
                                              alert($button.attr('data-message-' + errorCode) || i18n('服务器忙，请稍后重试。'))
                                          }

                                          ga('send', 'event', 'property_detail', 'click', 'add-fav-failed',errorCode)
                                      })


         })

         $('[data-fn=removeFav]').on('click', function () {
             ga('send', 'event', 'property_detail', 'click', 'remove-fav')
             if (window.project.checkLoginIfNot()) {
                 return
             }
             var $button = $(this)
             var favorite_id = $button.attr('data-favorite-id')
             $.betterPost('/api/1/user/favorite/' + favorite_id + '/remove')
                                      .done(function () {
                                          $button.hide().parent().find('[data-fn=addFav]').show()
                                          ga('send', 'event', 'property_detail', 'click', 'remove-fav-success')
                                      })
                                      .fail(function (errorCode) {
                                          if (errorCode === 40100) {

                                          } else {
                                              alert($button.attr('data-message-' + errorCode) || i18n('服务器忙，请稍后重试。'))
                                          }
                                          ga('send', 'event', 'property_detail', 'click', 'remove-fav-failed',errorCode)
                                      })
         })

         $('[data-fn=shareToWeChat]').on('click', function () {
             $('#popupShareToWeChat')
             .find('img').prop('src', '/qrcode/generate?content=' + encodeURIComponent(geoLocation.href)).end()
             .modal()
             ga('send', 'event', 'property_detail', 'share', 'open-wechat-web')
         })
     })();

    </script>
    <!--build:js /static/scripts/crowdfunding.html.js-->
    <script src="/static/vendors/jquery.slimscroll.min.js"></script>
    <script src="/static/vendors/jcarousel/jquery.jcarousel.min.js"></script>
    <script src="/static/vendors/jcarousel/jcarousel.responsive.js"></script>
    <script src="/static/vendors/video-js/video.js"></script>
    <!--endbuild-->

    <script>
     $('[data-fn=expendDescription]').on('click', function () {
         $(this).parent().hide()
            .parent().find('[data-ui=description]').height('auto')
         $(this).parent().hide()
             .parent().find('[data-ui=description]').toggleClass( "no-after" )
         ga('send', 'event', 'property_detail', 'click', 'extend-description')
     });

     videojs.options.flash.swf = "/static/vendors/video-js/video-js.swf";

    </script>
    <!-- @endif -->

    <!--@@close-->
