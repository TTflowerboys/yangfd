<!--@@master = masters/master.html-->

<!--@@block = custom_header-->
<div class="propertyHeader_phone  rmm" >
    <div class="rmm-toggled rmm-closed rmm-center-closed">
        <div class="rmm-toggled-controls">
            <div class="rmm-button">
                <img src="/static/images/common/header/phone/menu.png"/>
            </div>
            <div id="rmm-center-wrapper" class="rmm-center">
                <label id="newsHeader_title" class="title" for="">
                    %if property:
                        {{property.get('name',_('房产详情'))}}
                    %end
                </label>
            </div>
            <div class="rmm-toggled-share">
                <img src="/static/images/property_details/phone/wechat_share.png" />
            </div>
        </div>
        <ul class="rmm-menu" style="display:none;">
            <li><a href="/">{{_('首页')}}</a></li>
            <li><a href="/property_list">{{_('海外房产')}}</a></li>
            <li><a href="/news_list">{{_('投资资讯')}}</a></li>
        </ul>
    </div>
</div>

<!--@@close-->

<!--@@block = head-->
%if property:
    % property_type_slug = property.get('property_type',{}).get('slug')

    % tags = []
    % if 'intention' in property and property.get('intention'):
        % tags = [item['value'] for item in property['intention'] if 'value' in item]
    % end
    % tagString = ', '.join(tags)

    % from bottle import request


    <!-- cause video-js.css has related path font resource, so package in the same dir-->
    <!--build:css(dist) /static/vendors/video-js/video-js.css-->
    <link rel="stylesheet" href="/static/vendors/video-js/video-js.css">
    <!--endbuild-->

    <!--build:css(dist) /static/styles/property.html.css-->
    <link rel="stylesheet" href="/static/styles/propertyDetails.css"/>
    <link rel="stylesheet" href="/static/styles/propertyCard.css"/>
    <link rel="stylesheet" href="/static/styles/crowdfunding.css"/>
    <link rel="stylesheet" href="/static/styles/project/tabbar.css"/>
    <link rel="stylesheet" href="/static/styles/phone/wechatSharePopup.css"/>
    <link rel="stylesheet" href="/static/vendors/jcarousel/jcarousel.responsive.css"/>
    <link rel="stylesheet" href="/static/vendors/progress-bar/progress.css"/>
    <!--endbuild-->

    <!-- minor change from original repo https://github.com/Fykec/excanvas, detail can check change log -->
    <!--[if lte IE 8]>
    <script type="text/javascript" src="/static/vendors/excanvas.min.js"></script>
    <![endif]-->

    <!--@@close-->
    <!--@@block = main-->
    <div class="propertyDetails">
        <div class="breadcrumb">
            % if property.get('country').get('value'):
                <a class="parent" href="/property_list?country={{property.get('country',{}).get('id')}}" target="_blank">{{property.get('country',{}).get('value','')}}</a> /
            % end
            % if property.get('city').get('value'):
                <a class="parent" href="/property_list?country={{property.get('country',{}).get('id')}}&city={{property.get('city',{}).get('id')}}" target="_blank">{{property.get('city',{}).get('value','')}}</a> /
            % end
            % if property.get('property_type') and property.get('property_type').get('value'):
                <a class="parent" href="/property_list?country={{property.get('country',{}).get('id')}}&city={{property.get('city',{}).get('id')}}&property_type={{property.get('property_type').get('id')}}" target="_blank">{{property.get('property_type',{}).get('value','')}}</a> /
            %end
            <span class="current">{{property.get('name','')}}</span>
        </div>
        <div class="content">
            <div class="pictures" data-tabs>
                <div class="labels">
                    %if property.get('investment_type'):
                        <label class="type" for="">
                            {{property.get('investment_type')[0].get('value')}}
                        </label>
                    %end
                    % from datetime import datetime
                    % now = datetime.utcnow()
                    %if property.get('funding_end_date') and property.get('funding_end_date') > now:
                        <label class="rent" for="">
                            {{_('剩余')}}{{(property.get('funding_end_date') - now).days}}{{_('天')}}
                        </label>
                    %end
                </div>

                <div class="big">
                    % for name in ['reality_images']:
                        <div class="item" data-tab-name="{{name}}">
                            % if property.get(name):
                                <div class="rslides_wrapper">
                                    <ul class="rslides">
                                        % for image in property.get(name):
                                            <li>
                                                <div class="img" style="background:url('{{!fetch_image(image, property_id=property.get('id'))}}') no-repeat;background-size: cover; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{{!fetch_image(image, property_id=property.get('id'))}}', sizingMethod='scale');"></div>
                                            </li>
                                        % end
                                    </ul>
                                    <div class="leftPressArea"></div>
                                    <div class="rightPressArea"></div>
                                </div>
                            % else :
                                <img class="withPlaceholder" alt=""/>
                            % end
                        </div>
                    % end

                    % # Make sure property have videos and every video have at least one source
                    % if property.get('videos') and all(map(lambda x: len(x["sources"]) > 0, property.get('videos'))):
                        <div class="item videocontent" data-tab-name="video">

                        </div>
                    % end
                </div>

                <div class="thumbnails">
                    <ul>
                        % if property.get('reality_images', []) and len(property.get('reality_images', [])):
                            <li data-tab="reality_images">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('reality_images')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt="" />
                                <span class="text_wrapper"> <span class="text">{{_('实景图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('videos') and all(map(lambda x: len(x["sources"]) > 0, property.get('videos'))):
                            <li data-tab="video">
                                <img onerror="window.onImgError(this);" src="/static/images/placeholder/video_holder_150x_141114.jpg" alt=""/>
                                <span class="text_wrapper"> <span class="text">{{_('视频')}}</span></span>
                                <span class="border"></span>
                            </li>
                        % end
                    </ul>
                </div>
            </div>

            <table class="propertyCard_phone">
                <tr>
                    <td class="left">
                        <h1 class=name>{{property.get('name')}}</h1>
                        % if 'intention' in property and property.get('intention'):
                            <div class="tag">
                                <img src="/static/images/property_details/phone/tag-icon-phone.png" height=12 alt=""/>
                                <label>
                                    {{tagString}}
                                </label>
                            </div>
                        % end
                        % if 'country' in property or 'city' in property:
                            % country = property.get('country',{}).get('value')
                            % city = property.get('city',{}).get('value')
                            % city_string = ', '.join([x for x in [country,city] if x])
                            <div class="tag">
                                <img src="/static/images/property_details/phone/location-icon-phone.png" height=12 alt=""/>
                                <label>
                                    {{city_string}}
                                </label>
                            </div>
                        % end
                    </td>
                    <td class="middle">
                        <table>
                            <tr>
                                <td>
                                    <label class="limit" for="">
                                        %if property.get('funding_min'):
                                            {{! str(property.get('funding_min')) + _('起投<br/>') + str(property.get('term')) +  _('年锁定')}}
                                        %else :
                                            %if property.get('term'):
                                                {{str(property.get('term')) +  _('年锁定')}}
                                            %end
                                        %end
                                    </label>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>

             <div class="price_phone">
                <div class="left">
                    <label class="available" for="">
                        {{_('可投资')}}
                        <strong>386</strong>{{_('万元')}}
                    </label>
                    <div class="progress">
                        <div class="progress-bar" style="width:50%; background-color:#e60014;"></div>
                    </div>
                    <div class="info">

                        <label class="target" for="">
                            {{_('目标筹资')}}
                            <span data-type="formatted_currency">
                                {{property.get('funding_goal')}}
                            </span>
                        </label>
                    </div>
                </div>
                <button class="button red invest">
                    {{_('我要投资')}}
                </button>

            </div>

            <table class="numbers_phone">
                <tr>
                    %if property.get('annual_return_estimated'):
                        <td>
                            <span class="text">{{!_('预计总年化收益率')}}</span>
                            <span class="percentage emphasized"><strong>
                                {{property.get('annual_return_estimated')}}
                            </strong></span>
                        </td>
                    % end

                    %if property.get('annual_cash_return_estimated'):
                        <td>
                            <span class="text">{{!_('预估现金年化收益率')}}</span>
                            <span class="percentage emphasized"><strong>
                                {{property.get('annual_cash_return_estimated')}}
                            </strong></span>
                        </td>
                    %end
                </tr>
            </table>


            %if property.get('highlight'):
                <div class="advantages">
                    <ul>
                        % for item in property.get('highlight'):
                            <li>{{item}}</li>
                        %end
                    </ul>
                </div>
            %end
            <div id="propertyDetails_description" class="meta">
                % if property_type_slug != 'new_property' and property_type_slug != 'student_housing':
                    <ul class="numbers">
                        <li>
                            {{_('房屋面积')}}
                            % if property.get('space'):
                                <strong>
                                    {{float("{0:.2f}".format(float(property.get('space',{}).get('value',0))))}}
                                    <span class="unit">
                                        {{!format_unit(property.get('space',{}).get('unit',''))}}
                                    </span>
                                </strong>
                            % end
                        </li>
                        % if property.get('bedroom_count','') :
                            <li>
                                {{_('卧室')}}
                                <strong>{{ property.get('bedroom_count','') }}</strong>
                            </li>
                        % end

                        % if property.get('bathroom_count') :
                            <li>
                                {{_('卫生间')}}
                                <strong>{{ property.get('bathroom_count') }}</strong>
                            </li>
                        % end

                        % if property.get('living_room_count',''):
                            <li>
                                {{_('客厅')}}
                                <strong>{{ property.get('living_room_count','') }}</strong>
                            </li>
                        % end

                        % if property.get('kitchen_count','') :
                            <li>
                                {{_('厨房')}}
                                <strong>{{ property.get('kitchen_count','') }}</strong>
                            </li>
                        % end
                    </ul>
                    <hr/>
                %end
                <table class="other">
                    <colgroup>
                        <col class="col-name">
                        <col>
                        <col class="col-name">
                        <col>
                    </colgroup>
                    <tbody>
                        % if 'address' in property:
                            <tr>
                                <td class="name">
                                    <i>
                                        <img src="/static/images/property_details/icon-location.png" alt=""/>
                                        </i>
                                        <label>
                                            {{_('产权地址')}}
                                        </label>
                                </td>
                                <td class="value">
                                    {{property.get('address')}}
                                </td>
                            </tr>
                        % end
                        % if 'street' in property:
                            <tr>
                                <td class="name">
                                    <i>
                                        <img src="/static/images/property_details/icon-map.png" alt=""/>
                                        </i>
                                        <label>
                                            {{_('街区')}}
                                        </label>
                                </td>
                                <td class="value">
                                    {{property.get('street','')}}
                                    %if report:
                                        <a class="street-link" style="display: none" target="_blank" href="/region_report/{{property.get('zipcode_index')}}">
                                            {{_(' (查看详细街区报告)')}}
                                        </a>
                                    %end
                                </td>
                            </tr>
                        % end
                    </tbody>
                </table>
            </div>

            %if property.get('description'):
                <div class="description" data-ui="description">
                    {{!property.get('description')}}
                </div>
                <div class="clearfix expendDescription_wrapper">
                    <button data-fn="expendDescription" class="ghostButton red" >{{_('展开')}}</button>
                </div>
                <hr/>
            %end

            <div class="investment_analysis">
                <h3 class="propertyDetails_title">{{_('投资受益分析')}}</h3>
                <div class="calculator">
                    <div class="input">
                        <input class="ghostInput" placeholder="{{_('本金')}}" data-investment="capital" type="number" value="{{property.get('funding_min')}}" data-investment-value="{{property.get('funding_min')}}"/>
                        <button class="button red" name="calculate">
                            {{_('计算')}}
                        </button>
                    </div>

                    <ul class="numbers">
                        <li>
                            <span class="text">{{!_('最大预估年化回报率')}}</span>
                            <span class="percentage">
                                <strong data-investment="max_annual_return_estimated" data-investment-value="{{property.get('max_annual_return_estimated')}}">
                                     {{str(float("{0:.2f}".format(property.get('max_annual_return_estimated') * 100))) + '%'}}
                                </strong>
                            </span>

                        </li>
                        <li>
                            <span class="text">{{!_('最大年化现金回报预估')}}</span>
                            <span class="percentage">
                                <strong data-investment="max_annual_cash_return_estimated" data-investment-value="{{property.get('max_annual_cash_return_estimated')}}">
                                    {{str(float("{0:.2f}".format(property.get('max_annual_cash_return_estimated') * 100))) + '%'}}
                                </strong>
                            </span>

                        </li>
                        <li>
                            <span class="text">{{!_('周期')}}</span>
                            <span class="percentage">
                                <span data-investment="term" data-investment-value="{{property.get('term')}}">
                                    <strong>
                                        {{str(property.get('term'))}}
                                    </strong>
                                    {{_('年')}}
                                </span>
                            </span>

                        </li>
                        <li class="cash">
                            <span class="text">{{!_('预计现金收益')}}</span>
                            <span class="percentage">
                                <span data-investment="cash_return">

                                </span>
                            </span>
                        </li>
                        <li class="total">
                            <span class="text">{{!_('预计总收益')}}</span>
                            <span class="percentage total">
                                <span data-investment="total_return">

                                </span>
                            </span>
                        </li>
                    </ul>
                </div>

                <canvas class="barChart" id="barChart">
                </canvas>
                <hr/>
            </div>

            <div class="team">
                <h3 class="propertyDetails_title">{{_('管理团队')}}</h3>
                <p class="des">
                    {{!property.get('operator')}}
                </p>
                %if property.get('management_team'):
                    <ul class="members">
                        % for member in property.get('management_team'):
                            <li class="member">
                                <a class="avatar_wrapper"
                                   %if member.get('linkedin_home'):
                                   href="{{member.get('linkedin_home')}}"
                                   %end
                                   >
                                   <div class="avatar"
                                        %if member.get('avatar'):
                                        style="background-image:url('{{member.get('avatar')}}'); background-size: cover; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{{member.get('avatar')}}', sizingMethod='scale')"
                                        %end
                                        ></div>
                                        <img class="linkedin" alt="" src="/static/images/crowdfunding/linkedin.png"/>
                                </a>
                                %if member.get('name'):
                                    <label class="name" for="">{{member.get('name')}}</label>
                                %end
                                %if member.get('title'):
                                    <label class="position" for="">{{member.get('title')}}</label>
                                %end
                            </li>
                        % end
                    </ul>
                %end
                <hr/>
            </div>

            <div class="finance">
                <h3 class="propertyDetails_title">{{_('财务分析')}}</h3>
                %if property.get('capital_structure'):

                    % capital_total = 0.0
                    % for capital_item in  property.get('capital_structure'):
                        %  capital_total += capital_item.get('price')
                    % end
                    <div class="stackedBar">

                        %for index, capital_item in  enumerate(property.get('capital_structure')):
                            <div class="bar bar{{index}}" style="width: {{str(float('{0:.2f}'.format(capital_item.get('price') / capital_total * 100))) + '%'}}">
                                {{str(float('{0:.2f}'.format(capital_item.get('price') / capital_total * 100))) + '%'}}
                            </div>

                        % end
                    </div>

                    <table>
                        <tr>
                            <th class="item">{{_('项目')}}</th>
                            <th class="source">{{_('资金来源')}}</th>
                            <th class="rate">{{_('比例')}}</th>
                            <th class="amount">{{_('金额')}}</th>
                        </tr>

                        % for index, capital_item in enumerate(property.get('capital_structure')):
                            <tr>
                                <td class="item item{{index}}">
                                    <div class="itemName itemName{{index}}">
                                        {{capital_item.get('type')}}
                                    </div>
                                </td>

                                <td>
                                    {{capital_item.get('source')}}
                                </td>
                                <td>
                                    {{str(float('{0:.2f}'.format(capital_item.get('price') / capital_total * 100))) + '%'}}
                                </td>
                                <td data-type="formatted_currency">
                                    {{capital_item.get('price')}}
                                </td>
                            </tr>
                        % end
                        <tr>
                            <td class="item ">
                                <div class="itemName itemNameTotal">
                                    Total
                                </div>
                            </td>
                            <td></td>
                            <td>100%</td>
                            <td data-type="formatted_currency">
                                {{capital_total}}
                            </td>
                        </tr>
                    </table>
                %end

                <div class="des">{{!property.get('financials')}}</div>
                <hr/>
            </div>

            <div class="materials">
                <h3 class="propertyDetails_title">{{_('相关资料')}}</h3>
                <ul>
                    % from six.moves.urllib.parse import quote_plus
                    % for material in property.get('materials'):
                        <li class="material">
                            <a href="/pdf_viewer/crowdfunding/{{property.get('id')}}?filename={{quote_plus(material.get('filename').encode('utf-8'))}}&link={{quote_plus(material.get('link').encode('utf-8'))}}">
                                <img alt="" src="/static/images/crowdfunding/material.png"/>
                                <label class="name" for="">{{material.get('filename')}}</label>
                            </a>
                        </li>
                    % end
                </ul>
                <hr/>
            </div>


            %if (report):
                <div class="regionReport" id="regionReport">
                    %if report.get('image'):
                        <img alt="" src="" style="background:url('{{!fetch_image(report.get('image'))}}') no-repeat;background-size: cover; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{{!fetch_image(report.get('image'))}}', sizingMethod='scale');"/>
                    %else:
                        <img alt="" src="" style="background:url('/static/images/background/login-background.jpg') no-repeat;background-size: cover; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/static/images/background/login-background.jpg', sizingMethod='scale');"/>
                    %end
                    <div class="img_shadow"></div>
                    <div class="text_container">
                        <div class="text">
                            <h1 class="name">
                                {{report.get('name')}}
                            </h1>
                            <p class="des">
                                {{report.get('description')}}
                            </p>
                            <a class="ghostButton detail" href="/region_report/{{report.get('zipcode_index')}}" target="_blank">
                                {{_('查看详细街区报告')}}
                            </a>
                        </div>
                    </div>
                </div>
                <hr/>
            %end

            <div class="records">
                <h3 class="propertyDetails_title">{{_('投资记录')}}</h3>
                <table style="">
                    <tr>
                        <th class="name">{{_('用户')}}</th>
                        <th class="amount">{{_('投资金额（人民币，元）')}}</th>
                        <th class="date">{{_('投资时间')}}</th>
                        <th class="status">{{_('状态')}}</th>
                    </tr>
                    <tr>
                        <td class="name">王**</td>
                        <td class="amount">6000.00</td>
                        <td class="date">2015-01-02 14:32</td>
                        <td class="status">成功</td>
                    </tr>
                    <tr>
                        <td class="name">王**</td>
                        <td class="amount">6000.00</td>
                        <td class="date">2015-01-02 14:32</td>
                        <td class="status">成功</td>
                    </tr>

                    <tr>
                        <td class="name">王**</td>
                        <td class="amount">6000.00</td>
                        <td class="date">2015-01-02 14:32</td>
                        <td class="status">成功</td>
                    </tr>

                    <tr>
                        <td class="name">王**</td>
                        <td class="amount">6000.00</td>
                        <td class="date">2015-01-02 14:32</td>
                        <td class="status">成功</td>
                    </tr>

                    <tr>
                        <td class="name">王**</td>
                        <td class="amount">6000.00</td>
                        <td class="date">2015-01-02 14:32</td>
                        <td class="status">成功</td>
                    </tr>

                    <tr>
                        <td class="name">王**</td>
                        <td class="amount">6000.00</td>
                        <td class="date">2015-01-02 14:32</td>
                        <td class="status">成功</td>
                    </tr>
                </table>
                <div class="more">
                    <button class="expand">
                        <img alt="" src="/static/images/crowdfunding/expand.png"/>
                        <label for="">
                            {{_('更多')}}
                        </label>
                    </button>
                </div>
            </div>

            <div class="comments">
                <h3 class="propertyDetails_title">{{_('项目问答汇总')}}</h3>
                %if user:
                    <form class="addComment" name="addComment">
                        <h4 class="user">
                            {{user.get('nickname')}}
                        </h4>
                        <div class="comment_wrapper">
                            <textarea name="comment"></textarea>
                        </div>
                        <button class="button red">
                            {{_('提交')}}
                        </button>
                    </form>
                %end
                <ul id="comment_list" class="comment_list">

                </ul>
                <img src="/static/images/common/ajax-loader.gif" id="loadIndicator" class="loadIndicator" style="display:none"/>
                <button id="loadMore" class="loadMore ghostButton red" onclick="javascript:window.loadComment()">{{_('加载更多')}}</button>
            </div>
        </div>
        <div class="aside">
            <div class="propertyCard">
                <h1>{{property.get('name','')}}</h1>
                % if 'intention' in property and property.get('intention'):
                    <div class="tag">
                        <img src="/static/images/property_details/tag-icon.png" alt=""/>
                        <label>
                            {{tagString}}
                        </label>
                    </div>
                % end
                % if 'country' in property or 'city' in property:
                    % country = property.get('country',{}).get('value')
                    % city = property.get('city',{}).get('value')
                    % city_string = ', '.join([x for x in [country,city] if x])
                    <div class="tag">
                        <img src="/static/images/property_details/location-icon.png" alt=""/>
                        <label>
                            {{city_string}}
                        </label>
                    </div>
                % end


                <div class="price">
                    <label class="available" for="">
                        {{_('可投资')}}
                        <strong>386</strong>{{_('万元')}}
                    </label>
                    <div class="progress">
                        <div class="progress-bar" style="width:50%; background-color:#e60014;"></div>
                    </div>
                    <div class="info">
                        <label class="limit" for="">
                            %if property.get('funding_min'):
                            {{ str(property.get('funding_min')) + _('起投，') + str(property.get('term')) +  _('年锁定')}}
                            %else :
                                %if property.get('term'):
                                    {{str(property.get('term')) +  _('年锁定')}}
                                %end
                            %end
                        </label>
                        <label class="target" for="">
                            {{_('目标筹资')}}
                            <span data-type="formatted_currency">
                                {{property.get('funding_goal')}}
                            </span>
                        </label>
                    </div>

                    <button class="button red invest">
                        {{_('我要投资')}}
                    </button>

                </div>

                <table class="numbers">
                    <tr>
                        %if property.get('annual_return_estimated'):
                            <td>
                                <span class="percentage emphasized"><strong>
                                    {{property.get('annual_return_estimated')}}
                                </strong></span>
                                <span class="text">{{!_('预计总<br/>年化收益率')}}</span>
                            </td>
                        % end

                        %if property.get('annual_cash_return_estimated'):
                            <td>
                                <span class="percentage emphasized"><strong>
                                    {{property.get('annual_cash_return_estimated')}}
                                </strong></span>
                                <span class="text">{{!_('预估现金<br/>年化收益率')}}</span>
                            </td>
                        %end
                    </tr>
                </table>

                <hr/>
                <table class="actions">
                    <tr>
                        <td style="text-align:left;">
                            % isFavorite = False
                            % foundId = None
                            % for item in favorite_list:
                                %if item.get('item'):
                                    %if item.get('item').get('id') == property.get('id'):
                                        % isFavorite = True
                                        % foundId = item.get('id')
                                    %end
                                %end
                            % end
                            <button data-fn="addFav" data-item-id="{{property.get('id','')}}"
                                    class="flatButton"
                                    style="{{ 'display:none' if isFavorite else ''}}"
                                    data-message-40090="{{_('已经收藏过了')}}"
                                    >
                                <img src="/static/images/property_details/icon-star.png" alt=""/>
                                <span class="text"> {{_('收藏')}} </span>
                            </button>
                            <button data-fn="removeFav"
                                    class="flatButton"
                                    style="{{ 'display:none' if not isFavorite else ''}}"
                                    % if isFavorite:
                                    data-favorite-id="{{foundId}}"
                                    % end
                                    >
                                    <img src="/static/images/property_details/icon-star.png" alt=""/>
                                    <span class="text"> {{_('取消收藏') }} </span>
                            </button>
                        </td>
                        <td style="text-align:center;">
                            <button data-fn="shareToWeChat" class="flatButton green">
                                <img src="/static/images/property_details/icon-wechat.png" alt=""/>
                                {{_('分享到微信')}}
                            </button>
                        </td>
                        <td style="text-align:right;">
                            % name = property.get('name','')
                            <button class="flatButton orange" onclick="team.shareToWeibo({title:'{{name}}'}) ">
                                <img src="/static/images/property_details/icon-weibo.png" alt=""/>
                                {{_('分享到微博')}}
                            </button>
                        </td>
                    </tr>
                </table>
            </div>


            % if 'intention' in property and property.get('intention'):
                % item_width = '25%'
                %if len(property.get('intention')) > 4:
                    % item_width = str("{0:.2f}".format(float(1.0 / len(property.get('intention'))) * 100))  + '%'
                %end
                <div class="intentionTags" data-tabs>
                    <h2 class="propertyDetails_title">{{_('投资标签')}}</h2>
                    <ul class="tab">
                        % for intention in property.get('intention'):
                            %if intention.get('slug') and intention.get('value'):
                                <li data-tab="{{intention.get('slug','')}}" style="width:{{item_width}}">
                                    <div class="image_wrapper">
                                        <img src="/static/images/intention/icon/{{intention.get('slug')}}-red.png" alt=""/>
                                    </div>
                                    <div class="text">
                                        {{intention.get('value')}}
                                    </div>
                                </li>
                            %end
                        % end
                    </ul>
                    <ul class="content">
                        % for intention in property.get('intention') :
                            <li data-tab-name="{{intention.get('slug','')}}">
                                {{intention.get('description','')}}
                            </li>
                        % end
                    </ul>
                </div>
                <hr/>
            % end

            <div class="faqs">
                <h2 class="propertyDetails_title">{{_('众筹热门问答')}}</h2>

                <ul class="questions">
                    <li>
                        <h4 class="title">
                            <div class="indicator"></div>
                            How do I pledge?
                        </h4>
                        <p class="content">
                            Enter your pledge amount and select a reward. On the next page we'll ask you to log in or sign up with Kickstarter, and then we'll send you to Amazon Payments to complete the checkout process.
                        </p>
                    </li>
                    <li>
                        <h4 class="title">
                            <div class="indicator"></div>
                            How do I pledge?
                        </h4>
                        <p class="content">

                        </p>
                    </li>
                    <li>
                        <h4 class="title">
                            <div class="indicator"></div>
                            How do I pledge?
                        </h4>
                        <p class="content">

                        </p>
                    </li>
                </ul>
                <button class="more ghostButton red">
                    {{_('更多')}}
                </button>
            </div>
            <div class="relatedProperties">
                <h2 class="title">{{_('相关房产')}}</h2>
                <ul>
                    % main_property = property
                    % for property in related_property_list:
                        <li class="propertyItem">
                            <a href="/property/{{property.get('id')}}">
                                %if property.get('cover'):
                                    <img src="{{!fetch_image(property.get('cover'), thumbnail=True, property_id=property.get('id'))}}" onerror="window.onImgError(this);" width="320" height="213"/>
                                %elif (property.get('reality_images') and len(property.get('reality_images'))):
                                    <img src="{{!fetch_image(property.get('reality_images')[0], thumbnail=True, property_id=property.get('id'))}}" onerror="window.onImgError(this);" width="320" height="213"/>
                                %else :
                                    <img class="withPlaceholder" width="320" height="213"/>
                                %end
                                <div class="img_shadow"></div>
                                <div class="text">
                                    <h3 class="title">
                                        {{property.get('name')}}
                                    </h3>
                                    <label class="price">
                                        <!--@@include=partials/get_unit_price.html  -->
                                    </label>
                                </div>
                            </a>
                        </li>
                    % end
                    % property = main_property
                </ul>
            </div>
        </div>

    </div>

    <div id="popupShareToWeChat" style="display:none; text-align:center;font-size: 12px;">
        <img src="" alt="二维码" width="220" height="220"/>
        <p>{{_('打开微信，使用 “扫一扫” 即可将网页分享到朋友圈')}}</p>
    </div>

    <div class="wechatPage_popup" style="display:none;">
        <h1 class="tip"> {{!_('点击右上角')}}</h1>
        <img class="buttonHolder"  alt="" src="/static/images/property_details/wechat_share/phone/wechat_button.png"/>
        <h1 class="tip"> {{!_('分享链接给微信好友')}}</h1>
        <div class="guide">
            <img  alt="" src="/static/images/property_details/wechat_share/phone/wechat_guide.png"/>
        </div>
        <a class="gotIt" href ="#close-modal" rel="modal:close">{{_('我知道了')}}</a>
    </div>

    <ul class="floatBar_phone">
        <li class="favorite"
            data-fn="addFav"
            data-item-id="{{property.get('id','')}}"
            style="{{ 'display:none' if isFavorite else ''}}"
            data-message-40090="{{_('已经收藏过了')}}"
            ><img src="/static/images/property_details/phone/favorite.png"></img></li>
        <li class="favorite"
            data-fn="removeFav"
            style="{{ 'display:none' if not isFavorite else ''}}"
            % if isFavorite:
            data-favorite-id="{{foundId}}"
            % end
            ><img src="/static/images/property_details/icon-star.png"></img></li>
        <li class="phone"><a href="tel:4000926433" >{{_('拨打400-0926-433')}}</a></li>
        <li class="requirement"><a href="/requirement?property={{property.get('id')}}"><img src="/static/images/property_details/phone/requirement.png"></img></a></li>
    </ul>


    <script id="commentCell_template" type="text/template">
        <li>
            <div class="userInfo">
                <h4 class="user">
                    {=comment.user.nickname=}
                </h4>
                <label class="date">
                    {=project.formatTime(comment.time)=}
                </label>
            </div>
            <p class="content">
                {=comment.content=}
            </p>
        </li>
    </script>

    <!-- @@include=/static/templates/property_video.tpl.html-->


    <textarea id="pythonProperty" style="display: none;">
        {{json_dumps(property)}}
    </textarea>



    <!--@@close-->

    <!--@@block = scripts-->
    <script src="/static/vendors/Chart.min.js"></script>
    <!--build:js /static/scripts/crowdfunding.html.js-->
    <script src="/static/scripts/property_gallery.js"></script>
    <script src="/static/scripts/property_wechat.js"></script>
    <script src="/static/scripts/crowdfunding_favorite.js"></script>
    <script src="/static/scripts/update_investment_chart.js"></script>
    <script src="/static/scripts/crowdfunding.js"></script>
    <!--endbuild-->
    <!-- @endif -->

    <!--@@close-->
%end
