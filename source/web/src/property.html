<!--@@master = masters/master.html-->

<!--@@block = head-->
%if property:
    % property = _i18n(property)
    % property_type_slug = property.get('property_type',{}).get('slug')

    % tags = []
    % if 'intention' in property and property.get('intention'):
        % for index,item in enumerate(property.get('intention')):
            % tags.append(item.get('value',''))
        % end
    % end
    % tagString = ', '.join(tags)

    % from urllib import quote_plus
    <title>{{property.get('name',_('房产详情'))}}</title>
    <meta name="Description" content="{{property.get('name',_('房产详情'))}}">
    <meta name="Keywords" content="{{property.get('name',_('房产详情'))+','+tagString+u',洋房东,海外置业,楼盘,公寓,别墅,学区房,英国房产,洋房东,海外投资,海外房产,海外买房,海外房地产,海外房产投资,英国房价,Youngfunding,investment,overseas investment,property,apartment,house,UK property'}}">

    <!--build:css(dist) /static/styles/property.html.css-->
    <link rel="stylesheet" href="/static/styles/propertyDetails.css"/>
    <link rel="stylesheet" href="/static/styles/propertyCard.css"/>
    <link rel="stylesheet" href="/static/styles/project/tabbar.css"/>
    <link rel="stylesheet" href="/static/styles/mainHouseTypePopup.css"/>
    <link rel="stylesheet" href="/static/vendors/jcarousel/jcarousel.responsive.css"/>
    <!--endbuild-->

    <!--[if lte IE 8]>
    <script src="/static/vendors/excanvas.min.js"></script>
    <![endif]-->
    <!--@@close-->
    <!--@@block = main-->
    <div class="propertyDetails" style="margin-top: 100px;">
        <div class="content">
            <div class="pictures" data-tabs>
                <div class="labels">
                    %if property.get('property_type') and property.get('property_type').get('value'):
                        <label class="type" for="">{{property.get('property_type').get('value')}}</label>
                    %end
                    %if property.get('rental_guarantee_term'):
                        <label class="rent" for="">
                            {{_('包租')}}
                            {{property.get('rental_guarantee_term')}}
                            {{_('年')}}
                        </label>
                    %end
                </div>

                <div class="big">
                    % for name in ['reality_images','surroundings_images','floor_plan','effect_pictures',
                        % 'indoor_sample_room_picture','planning_map']:
                        <div class="item" data-tab-name="{{name}}">
                            % if property.get(name):
                                <div class="rslides_wrapper">
                                    <ul class="rslides">
                                        % for image in property.get(name):
                                            <li>
                                                <img src="/image/fetch?link={{quote_plus(image.encode('utf-8'))}}&property_id={{property.get('id','')}}" alt="" width="800" height="533"/>
                                            </li>
                                        % end
                                    </ul>
                                </div>
                            % else :
                                <img src="/static/images/placeholder/image.jpg" alt="" width="800" height="480"/>
                            % end
                        </div>
                    % end
                    % if property.get('longitude') and property.get('latitude'):
                        % long = property.get('longitude')
                        % lat = property.get('latitude')
                        <a href="https://ditu.google.cn/maps/?q={{long}},{{lat}}&z=14" target="_blank"
                           class="item" data-tab-name="map">
                            <img id="propertyMap" data-longitude="{{long}}" data-latitude="{{lat}}" src="about:blank;" width="800" height="533"/>
                        </a>
                    % end
                </div>

                <div class="thumbnails">
                    <ul>
                        % if property.get('reality_images', []) and len(property.get('reality_images', [])):
                            <li data-tab="reality_images">
                                <img src="/image/fetch?link={{quote_plus(property.get('reality_images')[0].encode('utf-8')) + '_thumbnail'}}&property_id={{property.get('id','')}}"
                                     alt="" width="200" height="133"/>
                                <span class="text_wrapper"> <span class="text">{{_('实景图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('surroundings_images'):
                            <li data-tab="surroundings_images">
                                <img src="/image/fetch?link={{quote_plus(property.get('surroundings_images')[0].encode('utf-8')) + '_thumbnail'}}&property_id={{property.get('id','')}}"
                                     alt="" width="200" height="133"/>
                                <span class="text_wrapper"> <span class="text">{{_('设施图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('floor_plan'):
                            <li data-tab="floor_plan">
                                <img src="/image/fetch?link={{quote_plus(property.get('floor_plan')[0].encode('utf-8')) + '_thumbnail'}}&property_id={{property.get('id','')}}"
                                     alt="" width="200" height="133"/>
                                <span class="text_wrapper"> <span class="text">{{_('户型图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('effect_pictures'):
                            <li data-tab="effect_pictures">
                                <img src="/image/fetch?link={{quote_plus(property.get('effect_pictures')[0].encode('utf-8')) + '_thumbnail'}}&property_id={{property.get('id','')}}"
                                     alt="" width="200" height="133"/>
                                <span class="text_wrapper"> <span class="text">{{_('效果图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('indoor_sample_room_picture'):
                            <li data-tab="indoor_sample_room_picture">
                                <img src="/image/fetch?link={{quote_plus(property.get('indoor_sample_room_picture')[0].encode('utf-8')) + '_thumbnail'}}&property_id={{property.get('id','')}}"
                                     alt="" width="200" height="133"/>
                                <span class="text_wrapper"> <span class="text">{{_('样板间图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('planning_map'):
                            <li data-tab="planning_map">
                                <img src="/image/fetch?link={{quote_plus(property.get('planning_map')[0].encode('utf-8')) + '_thumbnail'}}&property_id={{property.get('id','')}}"
                                     alt="" width="200" height="133"/>
                                <span class="text_wrapper"> <span class="text">{{_('规划图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('longitude') and property.get('latitude'):
                            <li data-tab="map">
                                <img src="/static/images/placeholder/map.jpg" alt="" width="200" height="133"/>
                                <span class="text_wrapper"> <span class="text">{{_('地图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end
                    </ul>
                </div>
            </div>
            <div class="nav tabbar">
                <ul>
                    <li>
                        <a href="#propertyDetails_description">{{_('详情')}}</a>
                    </li>
                    % if property.get('main_house_types'):
                        <li><a href="#propertyDetails_houseTypes">{{_('户型')}}</a></li>
                    % end
                    % if property_type_slug == 'new_property' or property_type_slug == 'student_housing':
                        <li><a href="#propertyDetails_project">{{_('楼盘介绍')}}</a></li>
                    %end
                    % if property.get('historical_price') :
                        <li><a href="#propertyDetails_price">{{_('价格趋势')}}</a></li>
                    % end
                    % if property.get('estimated_monthly_cost') and property.get('estimated_monthly_rent'):
                        <li><a href="#propertyDetails_incoming">{{_('月收支分析')}}</a></li>
                    % end
                </ul>
            </div>
            <div id="propertyDetails_description" class="meta">
                % if property_type_slug != 'new_property' and property_type_slug != 'student_housing':
                    <ul class="numbers">
                        <li>
                            {{_('房屋面积')}}
                            % if property.get('space'):
                                <strong>{{ property.get('space',{}).get('value',0) }}
                                    <span class="unit">
                                        % unit = property.get('space',{}).get('unit','')
                                        <!--@@include=partials/get_area_unit.html {"unit":"unit"}-->
                                    </span>
                                </strong>
                            % end
                        </li>
                        % if property.get('bedroom_count','') :
                            <li>
                                {{_('卧室')}}
                                <strong>{{ property.get('bedroom_count','') }}</strong>
                            </li>
                        % end

                        % if property.get('bathroom_count') :
                            <li>
                                {{_('卫生间')}}
                                <strong>{{ property.get('bathroom_count') }}</strong>
                            </li>
                        % end

                        % if property.get('living_room_count',''):
                            <li>
                                {{_('厅堂')}}
                                <strong>{{ property.get('living_room_count','') }}</strong>
                            </li>
                        % end

                        % if property.get('kitchen_count','') :
                            <li>
                                {{_('厨房')}}
                                <strong>{{ property.get('kitchen_count','') }}</strong>
                            </li>
                        % end
                    </ul>
                    <hr/>
                %end
                <table class="other">
                    <colgroup>
                        <col class="col-name">
                        <col>
                        <col class="col-name">
                        <col>
                    </colgroup>
                    <tbody>
                        <tr>
                            <td class="name">
                                <i>
                                    <img src="/static/images/property_details/icon-house.png" alt=""/>
                                    </i>
                                    {{_('产权类型')}}
                            </td>
                            <td class="value">
                                {{property.get('equity_type',{}).get('value','') }}
                            </td>
                            <td class="value">
                                % if 'opening_time' in property:
                                    {{property.get('opening_time','')}}
                                % end
                            </td>
                        </tr>
                        % if 'decorative_style' in property:
                            <tr>
                                <td class="name">
                                    <i>
                                        <img src="/static/images/property_details/icon-pallet.png" alt=""/>
                                        </i>
                                        {{_('装修风格')}}
                                </td>
                                <td class="value">
                                    {{property.get('decorative_style',{}).get('value')}}
                                </td>
                            </tr>
                        % end
                        <tr>

                            <td class="name">
                                <i>
                                    <img src="/static/images/property_details/icon-location.png" alt=""/>
                                    </i>
                                    {{_('产权地址')}}
                            </td>
                            <td class="value">
                                {{property.get('address')}}
                                <a target="_blank" href="https://ditu.google.cn/maps?q={{ quote_plus( property.get('address','').encode('utf-8')) }}">
                                    {{_(' (查看地图)')}}
                                </a>
                            </td>
                        </tr>
                        <tr>
                            <td class="name">
                                <i>
                                    <img src="/static/images/property_details/icon-map.png" alt=""/>
                                    </i>
                                    {{_('街区')}}
                            </td>
                            <td class="value">
                                {{property.get('street','')}}
                            </td>
                        </tr>
                        % if property_type_slug == 'new_property' or property_type_slug == 'student_housing':
                            <tr>
                                <td colspan="1" class="name">
                                    <i>
                                        <img src="/static/images/property_details/icon-kaleidoscope.png" alt=""/>
                                        </i>
                                        {{_('主要户型')}}
                                </td>
                                <td colspan="3" class="value">
                                    % if property.get('main_house_types'):
                                        % for type in property.get('main_house_types'):
                                            <a href="#propertyDetails_houseTypes">
                                                <span class="toggleTag selected">
                                                    {{type.get('bedroom_count',0)}}{{_('室')}}
                                                    {{type.get('living_room_count',0)}}{{_('厅')}}
                                                    % if 'value' in type.get('building_area',{}) and 'unit' in type.get('building_area',{}):
                                                        (
                                                        {{type.get('building_area',{}).get('value')}}
                                                        % unit = type.get('building_area',{}).get('unit')
                                                        <!--@@include partials/get_area_unit.html {"unit":"unit"}-->
                                                        )
                                                    % end
                                                </span>
                                            </a>
                                        % end
                                    % end

                                </td>
                            </tr>
                        % end
                    </tbody>
                </table>
            </div>
            %if property.get('highlight'):
                <div class="advantages">
                    <ul>
                        % for item in property.get('highlight'):
                            <li>{{item}}</li>
                        %end
                    </ul>
                </div>
            %end
            %if property.get('description'):
                <div class="description" data-ui="description">
                    {{property.get('description')}}
                </div>
                <div class="clearfix">
                    <button data-fn="expendDescription" class="ghostButton red" style="float:right;">{{_('展开')}}</button>
                </div>
                <hr/>
            %end
            % if property.get('main_house_types'):
                <div id="propertyDetails_houseTypes" class="houseTypes">
                    <h3 class="propertyDetails_title">{{_('楼盘户型')}}</h3>
                    <div class="jcarousel-wrapper">
                        <div class="jcarousel">
                            <ul>
                                % for item in property.get('main_house_types') :
                                    % if item:
                                        <li>
                                            <div style="position:relative;">
                                                <a href="{{item.get('floor_plan')}}" target="_blank">
                                                    <img src="/image/fetch?link={{ quote_plus( item.get('floor_plan','').encode('utf-8')) + '_thumbnail'}}&property_id={{property.get('id','')}}"
                                                         alt=""/>
                                                </a>
                                                <div class="table_wrapper">
                                                    <table class="text">
                                                        <tr>
                                                            <td>
                                                                <span class="name">{{_('房间')}}</span>
                                                                <span class="value">{{item.get('bedroom_count',0)}}</span>
                                                            </td>
                                                            <td>
                                                                <span class="name">{{_('客厅')}}</span>
                                                                <span class="value">{{item.get('living_room_count',0)}}</span>
                                                            </td>
                                                            <td>
                                                                <span class="name">{{_('卫生间')}}</span>
                                                                <span class="value">{{item.get('kitchen_count',0)}}</span>
                                                            </td>
                                                            <td>
                                                                <span class="name">{{_('厨房')}}</span>
                                                                <span class="value">{{item.get('bathroom_count',0)}}</span>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                            <div class="text2">
                                                <table>
                                                    <tr>
                                                        <td>
                                                            <span class="name">{{_('面积')}}</span>
                                                            <span class="value">
                                                                <strong >
                                                                    {{float("{0:.2f}".format(float(item.get('building_area',{}).get('value'))))}}
                                                                    % unit = item.get('building_area',{}).get('unit')
                                                                    <!--@@include partials/get_area_unit.html {"unit":"unit"}-->
                                                                </strong>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span class="name">{{_('售价')}}</span>
                                                            <span class="value">
                                                                %if 'total_price' in item and item.get('total_price'):
                                                                    <strong>
                                                                        {{item.get('total_price',{}).get('unit_symbol')}}
                                                                    </strong>
                                                                    <strong data-type="currency">
                                                                        {{int(float(item.get('total_price',{}).get('value')))}}
                                                                    </strong>
                                                                %end
                                                            </span>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </div>
                                        </li>
                                    % end
                                % end
                            </ul>
                        </div>
                        <a href="#" class="jcarousel-control-prev">&lsaquo;</a>
                        <a href="#" class="jcarousel-control-next">&rsaquo;</a>

                    </div>
                </div>
                <hr/>
            %end
            % if property_type_slug == 'new_property' or property_type_slug == 'student_housing':
                <div id="propertyDetails_project" class="brief">
                    <h3 class="propertyDetails_title">{{_('楼盘介绍')}}</h3>
                    <div class="table_wrapper">
                        <table class="table">
                            <colgroup>
                                <col style="width: 16em;">
                                <col>
                            </colgroup>
                            % if property.get('opening_time'):
                                <tr>
                                    <td>{{_('开盘时间')}}</td>
                                    <td>{{property.get('opening_time','')}}</td>
                                </tr>
                            % end
                            % if property.get('completion_time'):
                                <tr>
                                    <td>{{_('完工时间')}}</td>
                                    <td>{{property.get('completion_time','')}}</td>
                                </tr>
                            % end
                            % if property.get('building_type'):
                                <tr>
                                    <td>{{_('建筑类型')}}</td>
                                    <td>{{property.get('building_type','')}}</td>
                                </tr>
                            % end
                            % if property.get('property_management_type'):
                                <tr>
                                    <td>{{_('物业类型')}}</td>
                                    <td>{{property.get('property_management_type','')}}</td>
                                </tr>
                            % end
                            % if property.get('building_area'):
                                <tr>
                                    <td>{{_('建筑面积')}}</td>
                                    <td>
                                        %if property.get('building_area'):
                                            {{float("{0:.2f}".format(float(property.get('building_area').get('value'))))}}
                                            % unit = property.get('building_area').get('unit')
                                            <!--@@include partials/get_area_unit.html {"unit":"unit"}-->
                                        %end
                                    </td>
                                </tr>
                            % end
                            % if property.get('plot_ratio'):
                                <tr>
                                    <td>{{_('容积率间')}}</td>
                                    <td>{{property.get('plot_ratio','')}}</td>
                                </tr>
                            % end
                            % if property.get('planning_area'):
                                <tr>
                                    <td>{{_('规划面积')}}</td>
                                    <td>
                                        %if property.get('planning_area'):
                                            {{float("{0:.2f}".format(float(property.get('planning_area').get('value'))))}}
                                            % unit = property.get('planning_area').get('unit')
                                            <!--@@include partials/get_area_unit.html {"unit":"unit"}-->
                                        %end
                                    </td>
                                </tr>
                            % end
                            % if property.get('greening_rate'):
                                <tr>
                                    <td>{{_('绿化率')}}</td>
                                    <td>{{property.get('greening_rate','')}}</td>
                                </tr>
                            % end
                            % if property.get('parking_space_count'):
                                <tr>
                                    <td>{{_('车位数')}}</td>
                                    <td>{{property.get('parking_space_count','')}}</td>
                                </tr>
                            % end
                            % if property.get('planning_household_count'):
                                <tr>
                                    <td>{{_('规划户数')}}</td>
                                    <td>{{property.get('planning_household_count','')}}</td>
                                </tr>
                            % end
                            % if property.get('developer'):
                                <tr>
                                    <td>{{_('开发商')}}</td>
                                    <td>{{property.get('developer','')}}</td>
                                </tr>
                            % end
                            % if property.get('property_management_company'):
                                <tr>
                                    <td>{{_('物业公司')}}</td>
                                    <td>{{property.get('property_management_company','')}}</td>
                                </tr>
                            % end
                        </table>
                    </div>
                </div>
                <hr/>
            %end
            % if property.get('historical_price') :
                <div id="propertyDetails_price" class="trend">
                    <h3 class="propertyDetails_title">{{_('价格趋势')}} ({{_.currency}})</h3>
                    <canvas id="lineChart" width="800" height="400"></canvas>
                </div>
                <hr/>
            % end

            % if property.get('estimated_monthly_cost') and property.get('estimated_monthly_rent'):
                <div id="propertyDetails_incoming" class="incoming">
                    <h3 class="propertyDetails_title">{{_('月收支分析')}}</h3>
                    <div class="stackedBar">
                        % total = float(property.get('estimated_monthly_rent',{}).get('value',0))
                        % cost = 0

                        % for item in property.get('estimated_monthly_cost'):
                            % price = float(item.get('price',{}).get('value',0))
                            % cost += price
                            <div class="bar bar1" style="width: {{price/total*100}}%">
                                {{item.get('price',{}).get('unit_symbol','')}}
                                {{'%.2f' % float(item.get('price',{}).get('value',0))}}
                            </div>
                        % end

                        <div class="bar last" style="width: {{100 - cost / total * 100}}%">
                            {{ property.get('estimated_monthly_rent',{}).get('unit_symbol','') }}
                            {{ '%.2f' % (total - cost) }}
                        </div>

                        % if cost != 0:
                            <div class="annotation annotation4" style="width: {{cost / total * 100}}%;">
                                {{_('支出')}}
                            </div>
                        % end

                        <div class="annotation annotation6" style="width: {{100 - cost / total * 100}}%;">
                            {{_('预期净收益')}}
                        </div>
                        <div class="annotation annotation5" style="width: 100%;">
                            {{_('预期总收入')}}
                        </div>
                    </div>
                    <table class="text">
                        <colgroup>
                            <col style="width: 150px;">
                            <col style="width: 150px;">
                            <col>
                            <col style="width: 150px;">
                        </colgroup>
                        <tr>
                            <td>
                                <span class="bar bar0"></span>
                                <p class="name">{{_('预期总收入')}}</p>
                                <p class="value">
                                    {{ property.get('estimated_monthly_rent',{}).get('unit_symbol','') }}
                                    <strong>{{ '%.2f' % float(property.get('estimated_monthly_rent',{}).get('value',0)) }}</strong>
                                </p>
                            </td>
                            % for item in property.get('estimated_monthly_cost'):
                                <td>
                                    <span class="bar bar1"></span>
                                    <p class="name">{{item.get('item')}}</p>
                                    <p class="value">
                                        {{item.get('price',{}).get('unit_symbol','')}}
                                        <strong>{{ '%.2f' % float(item.get('price',{}).get('value',0)) }}</strong>
                                    </p>
                                </td>
                            %end
                            <td>
                                <span class="bar bar3"></span>
                                <p class="name">{{_('预期净收益')}}</p>
                                <p class="value">
                                    {{ property.get('estimated_monthly_rent',{}).get('unit_symbol','') }}
                                    <strong>{{ '%.2f' % (total - cost) }}</strong>
                                </p>
                            </td>
                        </tr>
                    </table>
                </div>
                <hr/>
            % end
            <div class="nearby" style="display: none;">
                <h3 class="propertyDetails_title">{{_('周边配套')}}</h3>
                <ul>
                    <li>
                        <h4><i><img src="/static/images/property_details/icon-bus.png" alt=""/></i>{{_('交通设施')}}</h4>
                        <strong>??</strong>
                        <hr/>
                        <ul>
                            <li>?{{_('条地铁线') }}</li>
                            <li>?{{_('个公交车站') }}</li>
                            <li>?{{_('个汽车租赁点') }}</li>
                        </ul>
                        <button class="flatButton" style="width: 100%">{{_('查看详细交通')}}</button>
                    </li>
                    <li>
                        <h4><i><img src="/static/images/property_details/icon-cap.png" alt=""/></i>{{_('周边学校')}}</h4>
                        <strong>??</strong>
                        <hr/>
                        <ul>
                            <li>?{{_('所小学')}}</li>
                            <li>?{{_('所高中')}}</li>
                            <li>?{{_('所大学')}}</li>
                        </ul>
                        <button class="flatButton" style="width: 100%">{{_('查看详细交通')}}</button>
                    </li>
                    <li>
                        <h4>
                            <i><img src="/static/images/property_details/icon-briefcase.png" alt=""/></i>
                            {{_('便民设施')}}
                        </h4>
                        <strong>??</strong>
                        <hr/>
                        <ul>
                            <li>?{{_('所公园')}}</li>
                            <li>?{{_('所健身馆')}}</li>
                            <li>?{{_('所游泳馆')}}</li>
                        </ul>
                        <button class="flatButton" style="width: 100%">{{_('查看详细交通')}}</button>
                    </li>
                    <li>
                        <h4>
                            <i><img src="/static/images/property_details/icon-shield.png" alt=""/></i>
                            {{_('便民设施')}}
                        </h4>
                        <strong>??</strong>
                        <hr/>
                        <ul>
                            <li>?{{_('所公园')}}</li>
                            <li>?{{_('所健身馆')}}</li>
                            <li>?{{_('所游泳馆')}}</li>
                        </ul>
                        <button class="flatButton" style="width: 100%">{{_('查看详细交通')}}</button>
                    </li>
                </ul>
            </div>
        </div>
        <div class="aside">
            <div class="propertyCard">
                <h1>{{property.get('name','')}}</h1>
                % if 'intention' in property and property.get('intention'):
                    <div class="tag">
                        <img src="/static/images/property_details/tag-icon.png" alt=""/>
                        {{tagString}}
                    </div>
                % end
                % if 'country' in property or 'city' in property:
                    % country = property.get('country',{}).get('value')
                    % city = property.get('city',{}).get('value')
                    % city_string = ', '.join([x for x in [country,city] if x])
                    <div class="tag"><img src="/static/images/property_details/location-icon.png" alt=""/>
                        {{city_string}}
                    </div>
                % end

                <div class="price">
                    <table>
                        <tr>
                            <td class="price_inner">
                                % if property.get('property_type') and (property.get('property_type').get('slug') == 'new_property' or property.get('property_type').get('slug') == 'student_housing'):
                                    %if 'main_house_types' in property and property.get('main_house_types') and len(property.get('main_house_types')):
                                        <span class="mute">{{_('最低投资')}}</span>
                                        <span>
                                            {{property.get('main_house_types',{})[0].get('total_price',{}).get('unit_symbol')}}
                                        </span>
                                        <strong data-type="currency">
                                            % minPrice = int(float(property.get('main_house_types')[0].get('total_price').get('value')))
                                            %for index, type  in enumerate(property.get('main_house_types')):
                                                %if minPrice > int(float(type.get('total_price').get('value'))):
                                                    %   minPrice = int(float(type.get('total_price').get('value')))
                                                %end
                                            %end
                                            {{minPrice}}
                                        </strong>
                                    %elif 'unit_price' in property and property.get('unit_price'):
                                        <span class="mute">{{_('参考价格')}}</span>
                                        <span>
                                            {{property.get('unit_price',{}).get('price',{}).get('unit_symbol')}}
                                        </span>
                                        <strong data-type="currency">
                                            {{int(float(str(property.get('unit_price',{}).get('price',{}).get('value',''))) / float(str(property.get('unit_price').get('unit').get('value'))))}}
                                        </strong>
                                        <span>
                                            /
                                            % unit = property.get('unit_price',{}).get('unit',{}).get('unit')
                                            <!--@@include=partials/get_area_unit.html {"unit":"unit"}-->
                                        </span>
                                    %end
                                % else :
                                    %if 'total_price' in property and property.get('total_price'):
                                        <span class="mute">{{_('参考价格')}}</span>
                                        <span>{{property.get('total_price',{}).get('unit_symbol','')}}</span>
                                        <strong data-type="currency">
                                            {{int(float(property.get('total_price',{}).get('value','')))}}
                                        </strong>
                                    %end
                                % end
                            </td>
                            %if property.get('status') == 'sold out':
                                <td class="soldOut">
                                    <span>{{_('售罄')}}</span>
                                </td>
                            %end
                        </tr>
                    </table>
                </div>
                <ul class="numbers">
                    %if property.get('rental_guarantee_rate'):
                        <li>
                            <span class="percentage emphasized">
                                <strong>{{float("{0:.2f}".format(property.get('rental_guarantee_rate')))}}</strong><strong>%</strong>
                            </span>
                            <span class="text">{{!_('年租金<br/>收益')}}</span>
                        </li>
                    %elif property.get('annual_return_estimated'):
                        <li>
                            <span class="percentage emphasized"><strong>
                                {{property.get('annual_return_estimated')}}
                            </strong></span>
                            <span class="text">{{!_('预计总<br/>年化收益率')}}</span>
                        </li>
                    % end

                    %if property.get('rental_guarantee_term'):
                       <li>
                            <span class="percentage emphasized">
                                <strong>{{property.get('rental_guarantee_term')}}</strong><strong>{{_('年')}}</strong>
                            </span>
                            <span class="text">{{!_('包租')}}</span>
                        </li>
                    % elif property.get('annual_cash_return_estimated'):
                        <li>
                            <span class="percentage emphasized"><strong>
                                {{property.get('annual_cash_return_estimated')}}
                            </strong></span>
                            <span class="text">{{!_('预计租金<br/>年化收益率')}}</span>
                        </li>
                    %end
                </ul>
                <hr/>
                <table class="actions">
                    <tr>
                        <td style="text-align:left;">
                            % isFavorite = property.get('id') in [i.get('property',{}).get('id') for i in favorite_list]
                            <button data-fn="addFav" data-property-id="{{property.get('id','')}}"
                                    class="flatButton"
                                    style="{{ 'display:none' if isFavorite else ''}}"
                                    data-message-40090="{{_('已经收藏过了')}}"
                                    >
                                <img src="/static/images/property_details/icon-star.png" alt=""/>
                                <span class="text"> {{_('收藏')}} </span>
                            </button>
                            <button data-fn="removeFav"
                                    class="flatButton"
                                    style="{{ 'display:none' if not isFavorite else ''}}"
                                    % if isFavorite:
                                    % foundId = [x for x in favorite_list if x.get('property',{}).get('id') == property.get('id')][0].get('id')
                                    data-favorite-id="{{foundId}}"
                                    % end
                                    >
                                    <img src="/static/images/property_details/icon-star.png" alt=""/>
                                    <span class="text"> {{_('取消收藏') }} </span>
                            </button>
                        </td>
                        <td style="text-align:center;">
                            <button data-fn="shareToWeChat" class="flatButton green">
                                <img src="/static/images/property_details/icon-wechat.png" alt=""/>
                                {{_('分享到微信')}}
                            </button>
                        </td>
                        <td style="text-align:right;">
                            % name = property.get('name','')
                            <button class="flatButton orange" onclick="team.shareToWeibo({title:'{{name}}'}) ">
                                <img src="/static/images/property_details/icon-weibo.png" alt=""/>
                                {{_('分享到微博')}}
                            </button>
                        </td>
                    </tr>
                </table>
            </div>

            <form class="intentionForm" name="intentionForm"
                  data-message-success="{{_('提交成功')}}"
                  data-message-40000="{{_('你填写的手机或邮箱的格式不正确')}}"
                  data-message-unknown="{{_('服务器忙，请稍后')}}"
                  >
                <input name="property_id" type="hidden" value="{{property.get('id','')}}"/>
                <div class="row">
                    <input name="nickname" type="text" placeholder="{{_('您的姓名')}}" data-validator="trim, required"
                           value="{{ user.get('nickname') if user else ''}}"/>
                </div>
                <div class="row">
                    <select name="country">
                        %for index, country in enumerate(country_list):
                            <option value="{{country.get('id')}}"
                                    % if country.get('id') == user.get('country',{}).get('id') if user and user.get('country') else None:
                                    selected
                                    %end
                                    >
                                    %if (country.get('slug') == 'CN'):
                                        (+86)
                                    %elif (country.get('slug') == 'GB') :
                                        (+44)
                                    %elif (country.get('slug') == 'US') :
                                        (+1)
                                    %elif (country.get('slug') == 'HK') :
                                        (+85)
                                    %end
                                    {{_i18n(country.get('value'))}}
                            </option>
                        %end
                    </select>
                    <input name="phone" type="text" placeholder="{{_('您的电话')}}" data-validator="trim, required"
                           value="{{user.get('phone','') if user else ''}}"/>
                </div>
                <div class="row">
                    <input name="email" type="text" placeholder="{{_('您的邮箱')}}" data-validator="trim, required, email"
                           value="{{user.get('email','') if user and user.get('email') else ''}}"/>
                </div>
                <div class="row">
                    <select name="budget">
                        <option value="">-- {{_('您的预算')}}
                            (
                            {{_('可选')}},
                            <!--@@include=partials/current_currency.html -->
                            ) --
                        </option>
                        %for index, budget in enumerate(_i18n(budget_list)):
                            %if budget.get('currency') == _.currency:
                                <option value="{{budget.get('id')}}">{{budget.get('value')}}</option>
                            %end
                        %end
                    </select>
                </div>
                <div class="row">
                    <textarea name="description" placeholder="{{_('写下您的其他需求和描述，方便我们在挑选房源时作为参考')}}({{ _('可选') }})"></textarea>
                </div>
                % if not user:
                    <div class="row">
                        <input id="c77a0b1a-1612-42e6-abbf-2ddc38095ad1" type="checkbox" name="register" checked/>
                        <label for="c77a0b1a-1612-42e6-abbf-2ddc38095ad1">{{_('免费成为会员，查看详细报告') }}</label>
                    </div>
                % end
                <div class="action">
                    <button class="flatButton" type="submit" disabled>{{_('联系我们（免费）')}}</button>
                </div>
                <div class="row" data-role="serverFeedback" style="display: none; text-align:center;"></div>
                <hr/>
                <div class="contact">
                    {{_('拨打 4000926433')}}
                </div>
            </form>
            <hr/>

            % if 'intention' in property and property.get('intention'):
                <div class="intentionTags" data-tabs>
                    <h2 class="propertyDetails_title">{{_('投资标签')}}</h2>
                    <ul class="tab">
                        % for intention in property.get('intention'):
                            <li data-tab="{{intention.get('slug','')}}">
                                <div class="image_wrapper">
                                    <img src="/static/images/intention/icon/{{intention.get('slug')}}-red.png" alt=""/>
                                </div>
                                <div class="text">
                                    {{intention.get('value')}}
                                </div>
                            </li>
                        % end
                    </ul>
                    <ul class="content">
                        % for intention in property.get('intention'):
                            <li data-tab-name="{{intention.get('slug','')}}">
                                {{intention.get('description','')}}
                            </li>
                        % end
                    </ul>
                </div>
                <hr/>
            % end
            <h2 class="propertyDetails_title">{{_('房贷计算')}}</h2>
            <form class="intentionForm calculator" name="mortgageForm">
                <div class="row">
                    <!--partial include must be in seperate line for translation extract-->
                    <label class="label">{{_('购房总价')}} (
                        <!--@@include=partials/current_currency.html -->
                        )</label>
                    % if property_type_slug == 'new_property' or property_type_slug == 'student_housing':
                        <input name="_total" type="text" placeholder=""
                               data-type="currency"
                               data-validator="decimal, trim, required"
                               data-message-required="{{_('必填')}}"
                               data-message-decimal="{{_('必须为数字')}}"/>
                    % else:
                        <input name="_total" type="text" placeholder=""
                               data-type="currency"
                               value="{{int(float(type.get('total_price',{}).get('value')))}} if 'total_price' in type"
                               data-validator="decimal, trim, required"
                               data-message-required="{{_('必填')}}"
                               data-message-decimal="{{_('必须为数字')}}"/>
                    % end
                </div>
                <div class="row">
                    <label class="label">{{_('首付款')}} (
                        <!--@@include=partials/current_currency.html -->
                        )</label>
                    <input name="_down_payment" type="text" placeholder=""
                           data-type="currency"
                           data-message-required="{{_('必填')}}"
                           data-validator="decimal, trim, required" data-message-decimal="{{_('必须为数字')}}"/>
                </div>
                <div class="row">
                    <label class="label">{{_('贷款金额')}} (
                        <!--@@include=partials/current_currency.html -->
                        )</label>
                    <input readonly name="loan" type="text" placeholder=""
                           data-type="currency"
                           data-message-required="必填"
                           data-validator="decimal, trim, required" data-message-decimal="{{_('必须为数字')}}"/>
                </div>
                <div class="row">
                    <label class="label">{{_('贷款利率')}}
                        (
                        <a class="link" target="_blank" href="http://www.moneysupermarket.com/mortgages/search/results/?goal=MOR_BTL">{{_('更多贷款选择')}}</a> )
                    </label>
                    <div class="inputAddOn">
                        <input name="rate" type="text" placeholder=""
                               data-message-required="{{_('必填')}}"
                               data-validator="decimal, trim, required" data-message-decimal="{{_('必须为数字')}}"/>
                        <span class="addOn">%</span>
                    </div>
                </div>
                <div class="row">
                    <label class="label">{{_('贷款年限')}}</label>
                    <input name="term" type="text" placeholder=""
                           data-message-required="{{_('必填')}}"
                           data-validator="number, trim, required" data-message-decimal="{{_('必须为整数')}}"/>
                </div>
                <div class="row">
                    <label class="label">{{_('还款类型')}}</label>
                    <select name="_type" data-validator="required"
                            data-message-required="{{_('必填')}}"
                            >
                        <option value="repayment">{{_('本息按揭')}}</option>
                        <option value="interestonly">{{_('仅还利息')}}</option>
                    </select>
                </div>
                <div class="action">
                    <button type="submit" class="flatButton">{{_('计算贷款')}}</button>
                </div>
                <a class="link" target="_blank" href="/news_list">{{_('贷款流程')}}</a>
                <hr/>
                <div class="table_wrapper" data-ui="result" style="display: none;">
                    <table>
                        <colgroup>
                            <col class="col-name">
                            <col class="col-value">
                        </colgroup>
                        <tr>
                            <td class="name">{{_('总支付利息')}}</td>
                            <td class="value">
                                <!--@@include=partials/current_currency_sympol.html -->
                                <span data-name="total_interest"></span></td>
                        </tr>
                        <tr>
                            <td class="name">{{_('本息合计')}}</td>
                            <td class="value">
                                <!--@@include=partials/current_currency_sympol.html -->
                                <span data-name="total"></span></td>
                        </tr>
                        <tr>
                            <td class="name">{{_('每月还款')}}</td>
                            <td class="value">
                                <!--@@include=partials/current_currency_sympol.html -->
                                <span data-name="monthly"></span></td>
                        </tr>
                    </table>
                </div>
            </form>
        </div>
    </div>
    <!--@@include=partials/main_house_type_popup.html -->
    <div id="popupShareToWeChat" style="display:none; text-align:center;font-size: 12px;">
        <img src="" alt="二维码" width="220" height="220"/>
        <p>{{_('打开微信，使用 “扫一扫” 即可将网页分享到朋友圈')}}</p>
    </div>
    <!--@@close-->

    <!--@@block = scripts-->
    <script src="/static/vendors/Chart.min.js"></script>


    <script>
     (function () {

         $(".rslides").responsiveSlides({
             pager: true,
             auto: false,
             nav: true,
             prevText: '<',
             nextText: '>'
         })


         $('[data-tabs]').tabs({trigger: 'click'}).on('openTab', function (event, target, tabName) {
             if (tabName === 'map') {
                 var $propertyMap = $('#propertyMap')
                 var longitude = $propertyMap.attr('data-longitude')
                 var latitude = $propertyMap.attr('data-latitude')
                 var url = 'https://maps.googleapis.com/maps/api/staticmap'
                 if ($propertyMap.get(0).src.indexOf(url) === 0) { return }
                 var result = team.setQuery('center', longitude + ',' + latitude, url)
                 result = team.setQuery('zoom', 15, result)
                 result = team.setQuery('size', '640x384', result)
                 result = team.setQuery('markers', longitude + ',' + latitude, result)
                 $propertyMap.get(0).src = result
             }
         })

         $('[data-fn=addFav]').on('click', function () {
             var $button = $(this)
             var property_id = $button.attr('data-property-id')
             $.betterPost('/api/1/user/favorite/add', {
                 property_id: property_id
             })
                                      .done(function (val) {
                                          $button.hide().parent().find('[data-fn=removeFav]').show().attr('data-favorite-id', val)
                                      })
                                      .fail(function (errorCode) {
                                          if (errorCode === 40100) {
                                              project.goToSignIn()
                                          } else {
                                              alert($button.attr('data-message-' + errorCode) || i18n('服务器忙，请稍后重试。'))
                                          }
                                      })
         })

         $('[data-fn=removeFav]').on('click', function () {
             var $button = $(this)
             var favorite_id = $button.attr('data-favorite-id')
             $.betterPost('/api/1/user/favorite/' + favorite_id + '/remove')
                                      .done(function () {
                                          $button.hide().parent().find('[data-fn=addFav]').show()
                                      })
                                      .fail(function (errorCode) {
                                          if (errorCode === 40100) {
                                              project.goToSignIn()
                                          } else {
                                              alert($button.attr('data-message-' + errorCode) || i18n('服务器忙，请稍后重试。'))
                                          }
                                      })
         })

         $('[data-fn=shareToWeChat]').on('click', function () {
             $('#popupShareToWeChat')
                                      .find('img').prop('src', '/qrcode/generate?content=' + encodeURIComponent(location.href)).end()
                                      .modal()
         })

     })()

    </script>

    % if property.get('historical_price') :
        <textarea id="python_historical_price" style="display: none;">
    {{json_dumps(sorted(property.get('historical_price'), key=lambda price:price['time']))}}
        </textarea>
        <script>
         window.historical_price = JSON.parse(document.getElementById('python_historical_price').innerHTML) || null
        </script>
    % end

    <!--build:js /static/scripts/property.html.js-->
    <script src="/static/scripts/showHistoricalPrice.js"></script>
    <script src="/static/scripts/intentionForm.js"></script>
    <script src="/static/scripts/mortgageForm.js"></script>
    <script src="/static/vendors/jcarousel/jquery.jcarousel.min.js"></script>
    <script src="/static/vendors/jcarousel/jcarousel.responsive.js"></script>
    <!--endbuild-->

    <script>
     $('[data-fn=expendDescription]').on('click', function () {
         $(this).parent().hide()
            .parent().find('[data-ui=description]').height('auto')
     })
    </script>

    <!--@@close-->
