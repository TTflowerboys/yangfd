<!--@@master = masters/master.html-->

<!--@@block = head-->

<!-- cause video-js.css has related path font resource, so package in the same dir-->
<!--build:css(dist) /static/bower_components/video-js/dist/video-js/video-js.css-->
<link rel="stylesheet" href="/static/bower_components/video-js/dist/video-js/video-js.css">
<!--endbuild-->
<!--build:css(dist) /static/styles/property.html.css-->
<link rel="stylesheet" href="/static/styles/iconFont.css">
<link rel="stylesheet" href="/static/bower_components/intro.js/minified/introjs.min.css">
<link rel="stylesheet" href="/static/styles/introjsTheme.css">
<link rel="stylesheet" href="/static/bower_components/swiper/dist/css/swiper.min.css">
<link rel="stylesheet" href="/static/bower_components/photoswipe/dist/photoswipe.css"/>
<link rel="stylesheet" href="/static/bower_components/jquery.stickynavbar/animate.min.css"/>
<link rel="stylesheet" href="/static/vendors/iOSList/jquery.ioslist.css"/>
<link rel="stylesheet" href="/static/styles/propertyDetails.css"/>
<link rel="stylesheet" href="/static/styles/propertyCard.css"/>
<link rel="stylesheet" href="/static/styles/project/tabbar.css"/>
<link rel="stylesheet" href="/static/styles/bingMap.css"/>
<link rel="stylesheet" href="/static/styles/mainHouseTypePopup.css"/>
<link rel="stylesheet" href="/static/styles/phone/wechatSharePopup.css"/>
<link rel="stylesheet" href="/static/vendors/jcarousel/jcarousel.responsive.css"/>
<!--endbuild-->
<link rel="stylesheet" href="/static/bower_components/photoswipe/dist/default-skin/default-skin.css"/>

<!-- minor change from original repo https://github.com/Fykec/excanvas, detail can check change log -->
<!--[if lte IE 8]>
<script type="text/javascript" src="/static/vendors/excanvas.min.js"></script>
<![endif]-->

<!--@@close-->

<!--@@block = custom_header-->
<div class="propertyHeader_phone  rmm" >
    <div class="rmm-toggled rmm-closed rmm-center-closed">
        <div class="rmm-toggled-controls">
            <div class="rmm-button">
                <img src="/static/images/common/header/phone/menu.png"/>
            </div>
            <div id="rmm-center-wrapper" class="rmm-center">
                <label id="newsHeader_title" class="title" for="">
                    %if property:
                        {{property.get('name',_('房产详情'))}}
                    %end
                </label>
            </div>
            <div class="rmm-toggled-share">
                <img src="/static/images/property_details/phone/wechat_share.png" />
            </div>
        </div>
        <ul class="rmm-menu" style="display:none;">
            <li><a href="/">{{_('首页')}}</a></li>
            <li><a href="/property-list">{{_('海外房产')}}</a></li>
            <!-- @if ENV!='production' -->
            <li><a href="/crowdfunding-introduce">{{_('海外众筹')}}</a></li>
            <!-- @endif -->
            <!-- @if ENV!='production' -->
            <li><a href="/property-to-rent-list">{{_('海外租房')}}</a></li>
            <!-- @endif -->
            <li><a href="/news-list">{{_('投资资讯')}}</a></li>
        </ul>
    </div>
</div>
%if property:
% property_type_slug = property.get('property_type',{}).get('slug')

% tags = []
% if 'intention' in property and property.get('intention'):
% tags = [item['value'] for item in property['intention'] if 'value' in item]
% end
% tagString = ', '.join(tags)

% from bottle import request




<div id="stickyNavbar" class="stickyNavbar unsticky">
    <nav id="nav">
        <ul class="nav navbar-nav">
            <li class="menuItem">
                <a href="#propertyDetails_description">{{_('房产详情')}}</a>
            </li >
            %if (property.get('latitude') and property.get('longitude')) and property.get('country').get('code') in ['US', 'GB']:
            <li><a href="#propertyDetails_aroundMap">{{_('周边配套')}}</a></li>
            %end
            % if property.get('main_house_types'):
            <li class="menuItem"><a href="#propertyDetails_houseTypes">{{_('楼盘户型')}}</a></li>
            % end
            % if property_type_slug == 'new_property' or property_type_slug == 'student_housing':
            <li class="menuItem"><a href="#propertyDetails_project">{{_('楼盘介绍')}}</a></li>
            %end
            % if property.get('historical_price') :
            <li class="menuItem"><a href="#propertyDetails_price">{{_('价格趋势')}}</a></li>
            % end
            % if property.get('estimated_monthly_cost') and property.get('estimated_monthly_rent'):
            <li class="menuItem"><a href="#propertyDetails_incoming">{{_('月收支分析')}}</a></li>
            % end
            % if property.get('brochure') and len(property.get('brochure')) > 0:
            <li class="menuItem"><a href="#propertyDetails_brochure">{{_('相关资料')}}</a></li>
            % end
            % if report :
            <li class="menuItem"><a href="#regionReport">{{_('街区报告')}}</a></li>
            % end
        </ul>
        <a class="contact" href="tel:4000926433">
            {{!_('拨打 <strong>400-0926-433</strong>')}}
        </a>
    </nav>
</div>
<!--@@close-->


    <!--@@block = main-->

    <div class="propertyDetails">
        <div class="breadcrumb">
            % if get_country_name_by_code(property.get('country',{}).get('code')):
                <a class="parent" href="/property_list?country={{property.get('country',{}).get('code')}}" target="_blank">{{get_country_name_by_code(property.get('country',{}).get('code'))}}</a> /
            % end
            % if property.get('city').get('name'):
                <a class="parent" href="/property_list?country={{property.get('country',{}).get('code')}}&city={{property.get('city',{}).get('id')}}" target="_blank">{{property.get('city',{}).get('name','')}}</a> /
            % end
            % if property.get('property_type') and property.get('property_type').get('value'):
                <a class="parent" href="/property_list?country={{property.get('country',{}).get('code')}}&city={{property.get('city',{}).get('id')}}&property_type={{property.get('property_type').get('id')}}" target="_blank">{{property.get('property_type',{}).get('value','')}}</a> /
            %end
            <span class="current">{{property.get('name','')}}</span>
        </div>
        <div class="content">
            <div class="pictures" data-tabs>
                <div class="labels">
                    %if property.get('property_type') and property.get('property_type').get('value'):
                        <label class="type" for="">{{property.get('property_type').get('value')}}</label>
                    %end
                    %if property.get('rental_guarantee_term'):
                        <label class="rent" for="">
                            {{property.get('rental_guarantee_term')}}
                            {{' '}}
                            {{_('年包租')}}
                            %if property.get('rental_guarantee_rate'):
                                {{' '}}
                                {{str(float("{0:.2f}".format(property.get('rental_guarantee_rate')))) + '%'}}
                            %end
                        </label>
                    %end
                </div>

                <div class="big">
                    % for name in ['reality_images','surroundings_images','floor_plan','effect_pictures',
                        % 'indoor_sample_room_picture','planning_map']:
                        <div class="item" data-tab-name="{{name}}">
                            % if property.get(name):
                                <div class="swiper-container">
                                    <ul class="swiper-wrapper" data-init="false">
                                        % for image in property.get(name):
                                            <li class="swiper-slide img" href="{{!fetch_image(image, property_id=property.get('id'))}}" class="swiper-slide" data-style="background-image: url('<url>');background-size: cover;filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='<url>', sizingMethod='scale');background-repeat: no-repeat;">
                                            </li>
                                        % end
                                    </ul>
                                    <div class="swiper-button swiper-button-prev"><</div>
                                    <div class="swiper-button swiper-button-next">></div>
                                    <div class="swiper-pagination"></div>
                                    <div class="leftPressArea"></div>
                                    <div class="rightPressArea"></div>
                                </div>
                            % else :
                                <img class="withPlaceholder" alt=""/>
                            % end
                        </div>
                    % end

                    % # Make sure property have videos and every video have at least one source
                    % if property.get('videos') and all(map(lambda x: "sources" in x and len(x["sources"]) > 0, property.get('videos'))):
                        <div class="item videocontent" data-tab-name="video">
                            <img src="/static/images/common/ajax-loader.gif" id="videoLoadIndicator" class="videoLoadIndicator"/>
                        </div>
                    % end
                </div>

                <div class="thumbnails">
                    <ul>
                        % if property.get('reality_images', []) and len(property.get('reality_images', [])):
                            <li data-tab="reality_images">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('reality_images')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt="" />
                                <span class="text_wrapper"> <span class="text">{{_('实景图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('surroundings_images'):
                            <li data-tab="surroundings_images">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('surroundings_images')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt="" />
                                <span class="text_wrapper"> <span class="text">{{_('设施图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('floor_plan'):
                            <li data-tab="floor_plan">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('floor_plan')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt=""/>
                                <span class="text_wrapper"> <span class="text">{{_('户型图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('effect_pictures'):
                            <li data-tab="effect_pictures">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('effect_pictures')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt=""/>
                                <span class="text_wrapper"> <span class="text">{{_('效果图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('indoor_sample_room_picture'):
                            <li data-tab="indoor_sample_room_picture">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('indoor_sample_room_picture')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt=""/>
                                <span class="text_wrapper"> <span class="text">{{_('样板间图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('planning_map'):
                            <li data-tab="planning_map">
                                <img onerror="window.onImgError(this);" src="{{!fetch_image(property.get('planning_map')[0], thumbnail=True, property_id=property.get('id'))}}"
                                     alt=""/>
                                <span class="text_wrapper"> <span class="text">{{_('规划图')}}</span> </span>
                                <span class="border"></span>
                            </li>
                        % end

                        % if property.get('videos') and all(map(lambda x: len(x["sources"]) > 0, property.get('videos'))):
                            <li data-tab="video">
                                <img onerror="window.onImgError(this);" src="/static/images/placeholder/video_holder_150x_141114.jpg" alt=""/>
                                <span class="text_wrapper"> <span class="text">{{_('视频')}}</span></span>
                                <span class="border"></span>
                            </li>
                        % end
                    </ul>
                </div>
            </div>

            <table class="propertyCard_phone">
                <tr>
                    <td class="left">
                        <h1 class=name>{{property.get('name')}}</h1>
                        % if 'intention' in property and property.get('intention'):
                            <div class="tag">
                                <img src="/static/images/property_details/phone/tag-icon-phone.png" height=12 alt=""/>
                                <label>
                                    {{tagString}}
                                </label>
                            </div>
                        % end
                        % if 'country' in property or 'city' in property:
                            % country = get_country_name_by_code(property.get('country',{}).get('code'))
                            % city = property.get('city',{}).get('name')
                            % city_string = ', '.join([x for x in [country,city] if x])
                            <div class="tag">
                                <img src="/static/images/property_details/phone/location-icon-phone.png" height=12 alt=""/>
                                <label>
                                    {{city_string}}
                                </label>
                            </div>
                        % end
                    </td>
                    <td class="middle">
                        <table>
                            <tr>
                                <td>
                                    <label class=price>
                                        <!--@@include=partials/get_unit_price.html  -->
                                        <div class="price_reference">
                                            <!--@@include=partials/get_reference_price.html  -->
                                        </div>
                                    </label>
                                    %if property.get('minimum_down_payment_rate'):
                                        <label class="minimumDownPaymentRate" for="">
                                            {{_('首付')}}
                                            <strong>
                                                {{str("{0:.0f}".format(float(property.get('minimum_down_payment_rate')) * 100))  + '%'}}
                                            </strong>
                                        </label>
                                    %end
                                </td>
                            </tr>
                        </table>
                    </td>
                    <td class="right">
                        <table>
                            <tr>
                                <td>
                                    <a href="/calculator?property={{property.get('id')}}" class=calculator>
                                        <img src="/static/images/property_details/phone/calculator.png"/>
                                    </a>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>

            <div class="numbers_phone">
                %if property.get('annual_return_estimated'):
                    <div id="annualReturnEstimatedColumn" class="column">
                        <span class="text">{{!_('预计年化收益率')}}</span>
                        <span class="percentage emphasized"><strong>{{property.get('annual_return_estimated')}}</strong></span>
                    </div>
                % end
                %if property.get('annual_cash_return_estimated'):
                    <div id="annualCashReturnEstimatedColumn" class="column">
                        <span class="text">{{!_('预估租金收益率')}}</span>
                        <span class="percentage emphasized"><strong>{{property.get('annual_cash_return_estimated')}}</strong></span>
                    </div>
                %end
                <script>
                 var annualCashReturnHeight = document.getElementById('annualCashReturnEstimatedColumn').clientHeight;
                 var annualReturnHeight = document.getElementById('annualReturnEstimatedColumn').clientHeight;
                 if (annualReturnHeight > annualCashReturnHeight) {
                     document.getElementById('annualCashReturnEstimatedColumn').style.height=annualReturnHeight+'px';
                 } else {
                     document.getElementById('annualReturnEstimatedColumn').style.height=annualCashReturnHeight+'px';
                 }
                </script>
            </div>

            <div id="propertyDetails_description" class="meta scrollto">
                <div class="seperator"></div>
                <h3 class="propertyDetails_title">{{_('房产详情')}}</h3>
                % if property_type_slug != 'new_property' and property_type_slug != 'student_housing':
                    <ul class="numbers">
                        <li>
                            {{_('房屋面积')}}
                            % if property.get('space'):
                                <strong>
                                    {{float("{0:.2f}".format(float(property.get('space',{}).get('value',0))))}}
                                    <span class="unit">
                                        {{!format_unit(property.get('space',{}).get('unit',''))}}
                                    </span>
                                </strong>
                            % end
                        </li>
                        % if property.get('bedroom_count','') :
                            <li>
                                {{_('卧室')}}
                                <strong>{{ property.get('bedroom_count','') }}</strong>
                            </li>
                        % end

                        % if property.get('bathroom_count') :
                            <li>
                                {{_('卫生间')}}
                                <strong>{{ property.get('bathroom_count') }}</strong>
                            </li>
                        % end

                        % if property.get('living_room_count',''):
                            <li>
                                {{_('客厅')}}
                                <strong>{{ property.get('living_room_count','') }}</strong>
                            </li>
                        % end

                        % if property.get('kitchen_count','') :
                            <li>
                                {{_('厨房')}}
                                <strong>{{ property.get('kitchen_count','') }}</strong>
                            </li>
                        % end
                    </ul>
                    <div class="seperator"></div>
                %end
                <table class="other">
                    <colgroup>
                        <col class="col-name">
                        <col>
                        <col class="col-name">
                        <col>
                    </colgroup>
                    <tbody>
                        <tr>
                            <td class="name">
                                <i>
                                    <img src="/static/images/property_details/icon-house.png" alt=""/>
                                    </i>
                                    <label>
                                        {{_('产权类型')}}
                                    </label>
                            </td>
                            <td class="value">
                                {{property.get('equity_type',{}).get('value','') }}
                            </td>
                        </tr>
                        % if 'decorative_style' in property:
                            <tr>
                                <td class="name">
                                    <i>
                                        <img src="/static/images/property_details/icon-pallet.png" alt=""/>
                                        </i>
                                        <label>
                                            {{_('装修风格')}}
                                        </label>
                                </td>
                                <td class="value">
                                    {{property.get('decorative_style',{}).get('value')}}
                                </td>
                            </tr>
                        % end
                        % if 'address' in property:
                            <tr>
                                <td class="name">
                                    <i>
                                        <img src="/static/images/property_details/icon-location.png" alt=""/>
                                        </i>
                                        <label>
                                            {{_('产权地址')}}
                                        </label>
                                </td>
                                <td class="value">
                                    {{property.get('address')}}
                                </td>
                            </tr>
                        % end
                        % if 'street' in property:
                            <tr>
                                <td class="name">
                                    <i>
                                        <img src="/static/images/property_details/icon-map.png" alt=""/>
                                        </i>
                                        <label>
                                            {{_('街区')}}
                                        </label>
                                </td>
                                <td class="value">
                                    {{property.get('street','')}}
                                    %if report:
                                        <a class="street-link" style="display: none" target="_blank" href="/region-report/{{property.get('report_id')}}">
                                            {{_(' (查看详细街区报告)')}}
                                        </a>
                                    %end
                                </td>
                            </tr>
                        % end
                        % if property_type_slug == 'new_property' or property_type_slug == 'student_housing':
                            <tr>
                                <td colspan="1" class="name">
                                    <i>
                                        <img src="/static/images/property_details/icon-kaleidoscope.png" alt=""/>
                                        </i>
                                        <label for="">
                                            {{_('主要户型')}}
                                        </label>
                                </td>
                                <td colspan="3" class="value">
                                    % if property.get('main_house_types'):
                                        % for type in property.get('main_house_types'):
                                            <a href="#propertyDetails_houseTypes">
                                                <span class="toggleTag selected">
                                                    %if 'bedroom_count' in type and type.get('bedroom_count') != 0:
                                                        {{type.get('bedroom_count',0)}}{{_('室')}}
                                                    %end
                                                    %if 'living_room_count' in type and type.get('living_room_count') != 0:
                                                        {{type.get('living_room_count',0)}}{{_('厅')}}
                                                    %end
                                                    % if 'value' in type.get('building_area_min',{}) and 'unit' in type.get('building_area_min',{}):
                                                        (
                                                        {{float("{0:.2f}".format(float(type.get('building_area_min',{}).get('value'))))}}
                                                        {{!format_unit(type.get('building_area_min',{}).get('unit',''))}}
                                                        )
                                                    % end
                                                </span>
                                            </a>
                                        % end
                                    % end
                                </td>
                            </tr>
                        % end
                    </tbody>
                </table>

                %if property.get('highlight'):
                    <div class="advantages">
                        <ul>
                            % for item in property.get('highlight'):
                                <li>{{item}}</li>
                            %end
                        </ul>
                    </div>
                %end
                %if property.get('description'):
                    <div class="description" data-ui="description">
                        {{!property.get('description')}}
                    </div>
                    <div class="clearfix expendDescription_wrapper">
                        <button data-fn="expendDescription" class="ghostButton red" >{{_('展开')}}</button>
                    </div>
                %end
            </div>

            %if (property.get('latitude') and property.get('longitude')) and property.get('country').get('code') in ['US', 'GB']:
                <div id="propertyDetails_aroundMap" class="maps_wrapper scrollto">
                    <div class="seperator"></div>
                    <h3 class="propertyDetails_title">{{_('周边配套')}}</h3>
                    <div class="staticMap">
                        <img id="mapImg" class="mapImg" alt="" onerror="window.onImgError(this);"/>
                        <div id="showMap" class="button red">
                            <label for="">
                                {{_('查看房产周边设施')}}
                            </label>
                            <img class="icons" alt="" src="/static/images/property_details/icon-static-map-category.png"/>
                        </div>
                    </div>
                    <!--@@include partials/bing_map.html  -->
                    <!--@@include partials/bing_map_icons.html -->
                    <img src="/static/images/common/ajax-loader.gif" id="mapLoadIndicator" class="mapLoadIndicator" style="display:none;"/>
                </div>
            %end
            % if property.get('main_house_types'):
                <div id="propertyDetails_houseTypes" class="houseTypes scrollto">
                    <div class="seperator"></div>
                    <h3 class="propertyDetails_title">{{_('楼盘户型')}}</h3>
                    <div class="jcarousel-wrapper">
                        <div class="jcarousel">
                            <ul>
                                % for index,item in enumerate(property.get('main_house_types')) :
                                    % if item:
                                        <li class="item{{index}}">
                                            <a onclick="javascript:window.openMainHouseType(null, '{{index}}',false)">
                                                <div style="position:relative;">
                                                    %if item.get('floor_plan') and len(item.get('floor_plan'))>0:
                                                        <img class="floor_plan" src="{{!fetch_image(item.get('floor_plan')[0], thumbnail=True, property_id=property.get('id'))}}"
                                                             alt="{{item.get('name','')}}" onerror="window.onImgError(this);"/>
                                                    %else :
                                                        <img alt="{{item.get('name','')}}" class="withPlaceholder"/>
                                                    %end
                                                    <div class="table_wrapper">
                                                        <table class="text">
                                                            <tr>
                                                                %if 'bedroom_count' in item and item.get('bedroom_count') != 0:
                                                                    <td>
                                                                        <span class="name">{{_('卧室')}}</span>
                                                                        <span class="value">{{item.get('bedroom_count',0)}}</span>
                                                                    </td>
                                                                %end
                                                                %if 'living_room_count' in item and item.get('living_room_count') != 0:
                                                                    <td>
                                                                        <span class="name">{{_('客厅')}}</span>
                                                                        <span class="value">{{item.get('living_room_count',0)}}</span>
                                                                    </td>
                                                                %end
                                                                %if 'bathroom_count' in item and item.get('bathroom_count') != 0:
                                                                    <td>
                                                                        <span class="name">{{_('卫生间')}}</span>
                                                                        <span class="value">{{item.get('bathroom_count',0)}}</span>
                                                                    </td>
                                                                %end
                                                                %if 'kitchen_count' in item and item.get('kitchen_count') != 0:
                                                                    <td>
                                                                        <span class="name">{{_('厨房')}}</span>
                                                                        <span class="value">{{item.get('kitchen_count',0)}}</span>
                                                                    </td>
                                                                %end
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>
                                                <div class="text2">
                                                    <table>
                                                        <tr>
                                                            <td class="space">
                                                                <span class="name">{{_('面积')}}</span>
                                                                <span class="value">
                                                                    <strong >
                                                                        {{float("{0:.2f}".format(float(str(item.get('building_area_min',{}).get('value')))))}}
                                                                        {{!format_unit(item.get('building_area_min',{}).get('unit',''))}}
                                                                    </strong><span>{{_('起')}}</span>
                                                                </span>
                                                            </td>
                                                            <td class="price">
                                                                <span class="name">{{_('参考售价')}}</span>
                                                                <span class="value">
                                                                    %if item.get('total_price_min'):
                                                                        <strong>
                                                                            {{item.get('total_price_min',{}).get('unit_symbol')}}
                                                                        </strong>
                                                                        <span data-type="formatted_currency">
                                                                            {{int(float(item.get('total_price_min',{}).get('value')))}}
                                                                        </span><span>{{_('起')}}</span>

                                                                    %end
                                                                </span>
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </a>
                                        </li>
                                    % end
                                % end
                            </ul>
                        </div>
                        <a href="#" class="jcarousel-control-prev">&lsaquo;</a>
                        <a href="#" class="jcarousel-control-next">&rsaquo;</a>
                    </div>
                    <span id="propertyDetails_houseTypes_data" style="display: none">{{json_dumps(property.get('main_house_types'))}}</span>
                </div>

            %end
            % if property_type_slug == 'new_property' or property_type_slug == 'student_housing':
                <div id="propertyDetails_project" class="brief scrollto">
                    <div class="seperator"></div>
                    <h3 class="propertyDetails_title">{{_('楼盘介绍')}}</h3>
                    <div class="table_wrapper">
                        <table class="table">
                            <colgroup>
                                <col style="width: 16em;">
                                <col>
                            </colgroup>
                            % if property.get('opening_time'):
                                <tr>
                                    <td><div class="hint">{{_('开盘时间')}}</div></td>
                                    <td><div class="value">{{property.get('opening_time','')}}</div></td>
                                </tr>
                            % end
                            % if property.get('completion_time'):
                                <tr>
                                    <td><div class="hint">{{_('完工时间')}}</div></td>
                                    <td><div class="value">{{property.get('completion_time','')}}</div></td>
                                </tr>
                            % end
                            % if property.get('building_type'):
                                <tr>
                                    <td><div class="hint">{{_('建筑类型')}}</div></td>
                                    <td><div class="value">{{property.get('building_type','')}}</div></td>
                                </tr>
                            % end
                            % if property.get('property_management_type'):
                                <tr>
                                    <td><div class="hint">{{_('物业类型')}}</div></td>
                                    <td><div class="value">{{property.get('property_management_type','')}}</div></td>
                                </tr>
                            % end
                            % if property.get('building_area_min') and float(str(property.get('building_area_min').get('value')))!=0:
                                <tr>
                                    <td><div class="hint">{{_('建筑面积')}}</div></td>
                                    <td>
                                        %if property.get('building_area_min'):
                                            <div class="value">
                                                {{float("{0:.2f}".format(float(str(property.get('building_area_min').get('value')))))}}
                                                {{!format_unit(property.get('building_area_min',{}).get('unit',''))}}
                                            </div>
                                        %end
                                    </td>
                                </tr>
                            % end
                            % if property.get('plot_ratio'):
                                <tr>
                                    <td><div class="hint">{{_('容积率间')}}</div></td>
                                    <td><div class="value">{{property.get('plot_ratio','')}}</div></td>
                                </tr>
                            % end
                            % if property.get('planning_area') and float(property.get('planning_area').get('value'))!=0:
                                <tr>
                                    <td><div class="hint">{{_('规划面积')}}</div></td>
                                    <td>
                                        %if property.get('planning_area'):
                                            <div class="value">
                                                {{float("{0:.2f}".format(float(property.get('planning_area').get('value'))))}}
                                                {{!format_unit(property.get('planning_area',{}).get('unit',''))}}
                                            </div>
                                        %end
                                    </td>
                                </tr>
                            % end
                            % if property.get('greening_rate'):
                                <tr>
                                    <td><div class="hint">{{_('绿化率')}}</div></td>
                                    <td><div class="value">{{property.get('greening_rate','')}}</div></td>
                                </tr>
                            % end
                            % if property.get('parking_space_count'):
                                <tr>
                                    <td><div class="hint">{{_('车位数')}}</div></td>
                                    <td><div class="value">{{property.get('parking_space_count','')}}</div></td>
                                </tr>
                            % end
                            % if property.get('planning_household_count'):
                                <tr>
                                    <td><div class="hint">{{_('规划户数')}}</div></td>
                                    <td><div class="value">{{property.get('planning_household_count','')}}</div></td>
                                </tr>
                            % end
                            % if property.get('property_management_company'):
                                <tr>
                                    <td><div class="hint">{{_('物业公司')}}</div></td>
                                    <td><div class="value">{{property.get('property_management_company','')}}</div></td>
                                </tr>
                            % end
                        </table>
                    </div>
                </div>
            %end
            % if property.get('historical_price') :
                <div id="propertyDetails_price" class="trend scrollto">
                    <div class="seperator"></div>
                    <h3 class="propertyDetails_title">{{_('价格趋势')}} ({{_.currency}})</h3>
                    % if property.get('equal_property_description'):
                        <div class="historical_price_description">{{property.get('equal_property_description','')}}</div>
                    % end
                    <canvas id="lineChart"></canvas>
                </div>
            % end

            % if property.get('estimated_monthly_cost') and property.get('estimated_monthly_rent'):
                <div id="propertyDetails_incoming" class="incoming scrollto">
                    <div class="seperator"></div>
                    <h3 class="propertyDetails_title">{{_('月收支分析')}}</h3>
                    % if property.get('estimated_income_description'):
                        <div class="historical_price_description">{{property.get('estimated_income_description','')}}</div>
                    % end
                    <div class="stackedBar">
                        % total = float(property.get('estimated_monthly_rent',{}).get('value',0))
                        % cost = 0

                        %for index, item in enumerate(property.get('estimated_monthly_cost')):
                            % price = float(item.get('price',{}).get('value',0))
                            % cost += price
                            <div class="bar bar{{index+1}}" style="width: {{price/total*100}}%">
                                {{item.get('price',{}).get('unit_symbol','')}}
                                {{'%.2f' % float(item.get('price',{}).get('value',0))}}
                            </div>
                        %end
                        <div class="bar last" style="width: {{100 - cost / total * 100}}%">
                            {{ property.get('estimated_monthly_rent',{}).get('unit_symbol','') }}
                            {{ '%.2f' % (total - cost) }}
                        </div>

                        % if cost != 0:
                            <div class="annotation annotation4" style="width: {{cost / total * 100}}%;">
                                {{_('支出')}}
                            </div>
                        % end

                        <div class="annotation annotation6" style="width: {{100 - cost / total * 100}}%;">
                            {{_('预期净收益')}}
                        </div>
                        <div class="annotation annotation5" style="width: 100%;">
                            {{_('预期总收入')}}
                        </div>
                    </div>
                    <table class="text">
                        <colgroup>
                            <col style="width: 150px;">
                            <col style="width: 150px;">
                            <col style="width: 150px;">
                            <col style="width: 150px;">
                        </colgroup>
                        <tr>
                            <td>
                                <span class="bar first"></span>
                                <p class="name">{{_('预期总收入')}}</p>
                                <p class="value">
                                    {{ property.get('estimated_monthly_rent',{}).get('unit_symbol','') }}
                                    <strong>{{ '%.2f' % float(property.get('estimated_monthly_rent',{}).get('value',0)) }}</strong>
                                </p>
                            </td>

                            %for index, item in enumerate(property.get('estimated_monthly_cost')):
                                <td>
                                    <span class="bar bar{{index+1}}"></span>
                                    <p class="name">{{item.get('item')}}</p>
                                    <p class="value">
                                        {{item.get('price',{}).get('unit_symbol','')}}
                                        <strong>{{ '%.2f' % float(item.get('price',{}).get('value',0)) }}</strong>
                                    </p>
                                </td>
                            %end
                            <td>
                                <span class="bar last"></span>
                                <p class="name">{{_('预期净收益')}}</p>
                                <p class="value">
                                    {{ property.get('estimated_monthly_rent',{}).get('unit_symbol','') }}
                                    <strong>{{ '%.2f' % (total - cost) }}</strong>
                                </p>
                            </td>
                        </tr>
                    </table>

                    <table class="text_phone">
                        <colgroup>
                            <col style="width: 150px;">
                            <col style="width: 150px;">
                            <col style="width: 150px">
                            <col style="width: 150px;">
                        </colgroup>
                        <tr>
                            <td>
                                <span class="bar first"></span>
                                <p class="name">{{_('预期总收入')}}</p>
                                <p class="value">
                                    {{ property.get('estimated_monthly_rent',{}).get('unit_symbol','') }}
                                    <strong>{{ '%.2f' % float(property.get('estimated_monthly_rent',{}).get('value',0)) }}</strong>
                                </p>
                            </td>
                            <td>
                                <span class="bar last"></span>
                                <p class="name">{{_('预期净收益')}}</p>
                                <p class="value">
                                    {{ property.get('estimated_monthly_rent',{}).get('unit_symbol','') }}
                                    <strong>{{ '%.2f' % (total - cost) }}</strong>
                                </p>
                            </td>
                        </tr>
                        %for index, item in enumerate(property.get('estimated_monthly_cost')):
                            <tr class="gap"></tr>
                            <tr>
                                <td>
                                    <span class="bar bar{{index+1}}"></span>
                                    <p class="name">{{item.get('item')}}</p>
                                    <p class="value">
                                        {{item.get('price',{}).get('unit_symbol','')}}
                                        <strong>{{ '%.2f' % float(item.get('price',{}).get('value',0)) }}</strong>
                                    </p>
                                </td>
                            </tr>
                        %end
                    </table>
                </div>
            % end

            % if property.get('brochure') and len(property.get('brochure')) > 0:
                <div id="propertyDetails_brochure" class="brochure scrollto">
                    <div class="seperator"></div>
                    <h3 class="propertyDetails_title">{{_('相关资料')}}</h3>
                    % if user:
                        <div class="brochures_entry">
                            <div class="brochures_entry_wrapper">
                                % from six.moves.urllib.parse import quote_plus
                                % link = property.get('brochure')[0].get('url')
                                % link = quote_plus(link.encode('utf-8'))
                                <a href="/pdf_viewer/property/{{property.get('id')}}?link={{link}}" target="_blank" class="ghostButton red" >{{_('点击查看完整资料')}}</a>
                            </div>
                            <img class="guide_img" src="/static/images/property_details/img_brochure_cover.png" alt="">
                        </div>
                    % else:
                        <div class="brochure_wrapper">
                            <div class="brochures">
                                <ul>
                                    % if len(property.get('brochure')[0].get('rendered')) > 2:
                                        % # Because all of our brochures have same first two pages
                                        % for image in property.get('brochure')[0].get('rendered')[2::]:
                                            <li><img src="{{image}}" alt=""></li>
                                        % end
                                    % else:
                                        % for image in property.get('brochure')[0].get('rendered'):
                                            <li><img src="{{image}}" alt=""></li>
                                        % end
                                    % end
                                    <li>
                                        <div class="guide">
                                            <span class="guide_text">{{_('如需获取更多资料，请 ')}}<a onclick="project.checkLoginIfNot()">登录</a>{{_('，或者 ')}}<a onclick="project.goToSignUp()">注册</a></span>
                                            <img class="guide_img" src="/static/images/property_details/img_brochure_cover.png" alt="">
                                        </div>
                                    </li>
                                </ul>
                            </div>
                            <div class="leftPressArea"></div>
                            <div class="rightPressArea"></div>

                            <a href="#" class="brochures-control-prev">&lsaquo;</a>
                            <a href="#" class="brochures-control-next">&rsaquo;</a>
                        </div>
                    % end
                </div>
            % end

            %if report:
                <div id="regionReport" class="regionReport scrollto" >
                    <div class="seperator"></div>
                    <h3 class="propertyDetails_title">{{_('街区报告')}}</h3>
                    <div class="regionReport_inner">
                        %if report.get('image'):
                            <img alt="" src="" style="background:url('{{!fetch_image(report.get('image'))}}') no-repeat;background-size: cover; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='{{!fetch_image(report.get('image'))}}', sizingMethod='scale');"/>
                        %else:
                            <img alt="" src="" style="background:url('/static/images/background/login-background.jpg') no-repeat;background-size: cover; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='/static/images/background/login-background.jpg', sizingMethod='scale');"/>
                        %end
                        <div class="img_shadow"></div>
                        <div class="text_container">
                            <div class="text">
                                <h1 class="name">
                                    {{report.get('name')}}
                                </h1>
                                <p class="des">{{report.get('description')}}</p>
                                <a class="ghostButton detail" href="/region-report/{{report.get('id')}}" target="_blank">
                                    {{_('查看详细街区报告')}}
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            %end
        </div>
        <div class="aside">
            <div class="propertyCard">
                <h1>{{property.get('name','')}}</h1>
                % if 'intention' in property and property.get('intention'):
                    <div class="tag">
                        <img src="/static/images/property_details/tag-icon.png" alt=""/>
                        <label>
                            {{tagString}}
                        </label>
                    </div>
                % end
                % if 'country' in property or 'city' in property:
                    % country = get_country_name_by_code(property.get('country',{}).get('code'))
                    % city = property.get('city',{}).get('name')
                    % city_string = ', '.join([x for x in [country,city] if x])
                    <div class="tag">
                        <img src="/static/images/property_details/location-icon.png" alt=""/>
                        <label>
                            {{city_string}}
                        </label>
                    </div>
                % end

                %if property.get('total_price_min') or property.get('unit_price') or (property.get('main_house_types') and len(property.get('main_house_types'))):
                    <div class="price">
                        <table>
                            <tr>
                                <td class="price_inner">
                                    <!--@@include=partials/get_unit_price.html  -->
                                    <div class="price_reference">
                                        <!--@@include=partials/get_reference_price.html  -->
                                    </div>
                                </td>
                                %if property.get('minimum_down_payment_rate'):
                                    <td class="minimumDownPaymentRate">
                                        <span>
                                            {{_('首付')}}
                                            <br/>
                                            <strong>
                                                {{str("{0:.0f}".format(float(property.get('minimum_down_payment_rate')) * 100))  + '%'}}
                                            </strong>
                                        </span>
                                    </td>
                                %end
                                %if property.get('status') == 'sold out':
                                    <td class="soldOut">
                                        <span>{{_('售罄')}}</span>
                                    </td>
                                %end
                            </tr>
                        </table>
                    </div>
                %end

                <table class="numbers">
                    <tr>
                        %if property.get('annual_return_estimated'):
                            <td>
                                <span class="percentage emphasized"><strong>{{property.get('annual_return_estimated')}}</strong></span>
                                <span class="text">{{!_('预计<br/>年化收益率')}}</span>
                            </td>
                        % end

                        %if property.get('annual_cash_return_estimated'):
                            <td>
                                <span class="percentage emphasized"><strong>{{property.get('annual_cash_return_estimated')}}</strong></span>
                                <span class="text">{{!_('预估租金<br/>收益率')}}</span>
                            </td>
                        %end
                    </tr>
                </table>

                <div class="seperator"></div>
                <table class="actions">
                    <tr>
                        <td style="text-align:left;">
                            <button data-fn="addFav" data-property-id="{{property.get('id','')}}"
                                    class="flatButton ajaxButton"
                                    style="{{ 'display:none' if is_favorited else ''}}"
                                    data-message-40090="{{_('已经收藏过了')}}"
                                    >
                                <img src="/static/images/property_details/icon-star.png" alt=""/>
                                <span class="text"> {{_('收藏')}} </span>
                            </button>
                            <button data-fn="removeFav"
                                    class="flatButton ajaxButton"
                                    style="{{ 'display:none' if not is_favorited else ''}}"
                                    % if is_favorited:
                                    data-property-id="{{property.get('id','')}}"
                                    % end
                                    >
                                    <img src="/static/images/property_details/icon-star-active.png" alt=""/>
                                    <span class="text"> {{_('取消收藏') }} </span>
                            </button>
                        </td>
                        <td style="text-align:center;">
                            <button data-fn="shareToWeChat" class="flatButton green">
                                <img src="/static/images/property_details/icon-wechat.png" alt=""/>
                                {{_('分享到微信')}}
                            </button>
                        </td>
                        <td style="text-align:right;">
                            % name = property.get('name','')
                            <button class="flatButton orange" onclick="team.shareToWeibo({title:'{{name}}'}) ">
                                <img src="/static/images/property_details/icon-weibo.png" alt=""/>
                                {{_('分享到微博')}}
                            </button>
                        </td>
                    </tr>
                </table>
            </div>

            <form class="intentionForm" name="intentionForm"
                  data-message-success="{{_('提交成功')}}"
                  data-message-40000="{{_('你填写的手机或邮箱的格式不正确')}}"
                  data-message-unknown="{{_('服务器忙，请稍后')}}"
                  >
                <input name="property_id" type="hidden" value="{{property.get('id','')}}"/>
                <div class="row">
                    <input name="nickname" type="text" placeholder="{{_('您的姓名(必填)')}}" data-validator="trim, required"
                           value="{{ user.get('nickname') if user else ''}}"/>
                </div>
                <div class="row">
                    <select name="country">
                        % for country in country_list:
                            % if country.get('code') == 'GB':
                                <option value="{{country.get('code')}}"
                                    % if country.get('code') == user.get('country',{}).get('code') if user and user.get('country') else None:
                                    selected
                                    %end
                                    >
                                    (+44) {{get_country_name_by_code(country.get('code'))}}
                                </option>
                                % country_list.remove(country)
                            %end
                        %end
                        %for index, country in enumerate(country_list):
                            <option value="{{country.get('code')}}"
                                    % if country.get('code') == user.get('country',{}).get('code') if user and user.get('country') else None:
                                    selected
                                    %end
                                    >
                                    %if (country.get('code') == 'CN'):
                                        (+86)
                                    %elif (country.get('code') == 'GB') :
                                        (+44)
                                    %elif (country.get('code') == 'US') :
                                        (+1)
                                    %elif (country.get('code') == 'HK') :
                                        (+852)
                                    %end
                                    {{get_country_name_by_code(country.get('code'))}}
                            </option>
                        %end
                    </select>
                    <input name="phone" type="text" placeholder="{{_('您的电话(必填)')}}" data-validator="trim, required"
                           value="{{user.get('phone','') if user else ''}}"/>
                </div>
                <div class="row">
                    <input name="email" type="text" placeholder="{{_('您的邮箱(必填)')}}" data-validator="trim, required, email"
                           value="{{user.get('email','') if user and user.get('email') else ''}}"/>
                </div>
                <div class="row">
                    <select name="budget">
                        <option value="">-- {{_('您的预算')}}
                            (
                            {{_('可选')}},
                            <!--@@include=partials/current_currency.html -->
                            ) --
                        </option>
                        %for index, budget in enumerate(budget_list):
                            %if budget.get('currency') == _.currency:
                                <option value="{{budget.get('id')}}">{{budget.get('value')}}</option>
                            %end
                        %end
                    </select>
                </div>
                <div class="row">
                    <textarea name="description" placeholder="{{_('请在这里写下您的其他需求和购房疑问，我们的置业顾问将与您取得联系，竭诚为您服务')}}({{ _('可选') }})"></textarea>
                </div>
                % if not user:
                    <div class="row">
                        <input id="c77a0b1a-1612-42e6-abbf-2ddc38095ad1" type="checkbox" name="register" checked/>
                        <label for="c77a0b1a-1612-42e6-abbf-2ddc38095ad1">{{_('免费成为会员，查看详细报告') }}</label>
                    </div>
                % end
                <div class="action">
                    <button class="flatButton" type="submit" disabled>{{_('留言咨询')}}</button>
                </div>
                <div class="row" data-role="serverFeedback" style="display: none; color: red;"></div>
                <div class="seperator"></div>
                <div class="contact">
                    {{_('或拨打')}}<a href="tel:4000926433">400-0926-433</a>{{_('咨询 ')}}
                </div>
            </form>
            <div class="seperator"></div>

            % if 'intention' in property and property.get('intention'):
                % item_width = '25%'
                %if len(property.get('intention')) > 4:
                    % item_width = str("{0:.2f}".format(float(1.0 / len(property.get('intention'))) * 100))  + '%'
                %end
                <div class="intentionTags" data-tabs>
                    <h2 class="propertyDetails_title">{{_('投资标签')}}</h2>
                    <ul class="tab">
                        % for intention in property.get('intention'):
                            %if intention.get('slug') and intention.get('value'):
                                <li data-tab="{{intention.get('slug','')}}" style="width:{{item_width}}">
                                    <div class="image_wrapper">
                                        <img src="/static/images/intention/icon/{{intention.get('slug')}}-red.png" alt=""/>
                                    </div>
                                    <div class="text">
                                        {{intention.get('value')}}
                                    </div>
                                </li>
                            %end
                        % end
                    </ul>
                    <ul class="content">
                        % for intention in property.get('intention') :
                            <li data-tab-name="{{intention.get('slug','')}}">
                                {{intention.get('description','')}}
                            </li>
                        % end
                    </ul>
                </div>
                <div class="seperator"></div>
            % end
            <h2 class="propertyDetails_title">{{_('房贷计算')}}</h2>
            <!--@@include=partials/mortgage_form.html  -->
            <div class="seperator"></div>

            <div class="relatedProperties">
                <h2 class="title">{{_('相关房产')}}</h2>
                <ul>
                    % main_property = property
                    % for property in related_property_list:
                        <li class="propertyItem">
                            <a href="/property/{{property.get('id')}}">
                                %if property.get('cover'):
                                    <img src="{{!fetch_image(property.get('cover'), thumbnail=True, property_id=property.get('id'))}}" onerror="window.onImgError(this);" width="360" height="240"/>
                                %elif (property.get('reality_images') and len(property.get('reality_images'))):
                                    <img src="{{!fetch_image(property.get('reality_images')[0], thumbnail=True, property_id=property.get('id'))}}" onerror="window.onImgError(this);" width="360" height="240"/>
                                %else :
                                    <img class="withPlaceholder" width="360" height="240"/>
                                %end
                                <div class="img_shadow"></div>
                                <div class="text">
                                    <h3 class="title">
                                        {{property.get('name')}}
                                    </h3>
                                    <label class="price">
                                        <!--@@include=partials/get_unit_price.html-->
                                        <div class="price_reference">
                                            <!--@@include=partials/get_reference_price.html  -->
                                        </div>
                                    </label>
                                </div>
                            </a>
                        </li>
                    % end
                    % property = main_property
                </ul>
            </div>
        </div>

        <div id="main_house_type_popup" class="main_house_type_popup" style="display: none">
            <div id="main_house_type_popup_shadow" class="main_house_type_popup_shadow"></div>
        </div>

    </div>



    <div id="popupShareToWeChat" style="display:none; text-align:center;font-size: 12px;">
        <img src="" alt="二维码" width="220" height="220"/>
        <p>{{_('打开微信，使用 “扫一扫” 即可将网页分享到朋友圈')}}</p>
    </div>

    <div class="wechatPage_popup" style="display:none;">
        <h1 class="tip"> {{!_('点击右上角')}}</h1>
        <img class="buttonHolder"  alt="" src="/static/images/property_details/wechat_share/phone/wechat_button.png"/>
        <h1 class="tip"> {{!_('分享链接给微信好友')}}</h1>
        <div class="guide">
            <img  alt="" src="/static/images/property_details/wechat_share/phone/wechat_guide.png"/>
        </div>
        <a class="gotIt" href ="#close-modal" rel="modal:close">{{_('我知道了')}}</a>
    </div>

    <div id="menu_phone" class="menu_phone">
        <ul id="menu_content_phone" class="menu_content" style="display:none;">
                <li class="menuItem">
                    <a href="#propertyDetails_description">{{_('房产详情')}}</a>
                </li >
                %if (property.get('latitude') and property.get('longitude')) and property.get('country').get('code') in ['US', 'GB']:
                    <li><a href="#propertyDetails_aroundMap">{{_('周边配套')}}</a></li>
                %end
                % if property.get('main_house_types'):
                    <li class="menuItem"><a href="#propertyDetails_houseTypes">{{_('楼盘户型')}}</a></li>
                % end
                % if property_type_slug == 'new_property' or property_type_slug == 'student_housing':
                    <li class="menuItem"><a href="#propertyDetails_project">{{_('楼盘介绍')}}</a></li>
                %end
                % if property.get('historical_price') :
                    <li class="menuItem"><a href="#propertyDetails_price">{{_('价格趋势')}}</a></li>
                % end
                % if property.get('estimated_monthly_cost') and property.get('estimated_monthly_rent'):
                    <li class="menuItem"><a href="#propertyDetails_incoming">{{_('月收支分析')}}</a></li>
                % end
                 % if property.get('brochure') and len(property.get('brochure')) > 0:
                    <li class="menuItem"><a href="#propertyDetails_brochure">{{_('相关资料')}}</a></li>
                % end
                % if report :
                    <li class="menuItem"><a href="#regionReport">{{_('街区报告')}}</a></li>
                % end
        </ul>
        <div id="menu_button_phone" class="menu_button">
            <img src="/static/images/property_details/phone/property-menu.png"/>
        </div>
     </div>

    <ul class="floatBar_phone hiddenInClient">
        <li class="favorite"
            data-fn="addFav"
            data-property-id="{{property.get('id','')}}"
            style="{{ 'display:none' if is_favorited else ''}}"
            data-message-40090="{{_('已经收藏过了')}}"
            ><img src="/static/images/property_details/phone/unfavorite.png"></img></li>
        <li class="favorite"
            data-fn="removeFav"
            style="{{ 'display:none' if not is_favorited else ''}}"
            % if is_favorited:
            data-property-id="{{property.get('id','')}}"
            % end
            ><img src="/static/images/property_details/phone/favorite.png"></img></li>
        <li class="phone"><a href="tel:4000926433" >{{_('拨打400-0926-433')}}</a></li>
        <li class="requirement"><a href="/requirement?property={{property.get('id')}}"><img src="/static/images/property_details/phone/requirement.png"></img></a></li>
    </ul>

    % if property_type_slug == 'new_property' or property_type_slug == 'student_housing':
    <!--@@include=/static/templates/main_house_type_popup.tpl.html-->
    %end

    <!-- @@include=/static/templates/place_item.tpl.html-->
    <!-- @@include=/static/templates/property_video.tpl.html-->
    <textarea id="pythonProperty" style="display: none;">
        {{json_dumps(property)}}
    </textarea>
    <textarea id="pythonWeixin" style="display: none;">
        {{json_dumps(weixin)}}
    </textarea>
    % if property.get('historical_price') :
        <textarea id="python_historical_price" style="display: none;">
            {{json_dumps(sorted(property.get('historical_price'), key=lambda price:price['time']))}}
        </textarea>
        <script>
         window.historical_price = JSON.parse(document.getElementById('python_historical_price').innerHTML) || null
        </script>
    % end

    <!--@@include=partials/photoswipe.html-->
    <!--@@close-->

    <!--@@block = scripts-->

    <script>

     //just load after jquery
     window.initSlidesImages = function ($slides) {
         if ($slides.attr('data-init') === 'false') {
             $slides.find('li').each(function( index ) {
                 var url = $(this).attr('href')
                 if (team.isPhone()) {
                     url += '_thumbnail'
                 }
                 var r = new RegExp('<url>', 'g');
                 var style = $(this).attr('data-style').replace(r, url)
                 $(this).attr('style', style)
             });
             $slides.attr('data-init', 'true')
         }
     }
     // init the first slides
    initSlidesImages($('.pictures [data-tab-name]').first().find('.swiper-wrapper'))
    </script>

    <script src="/static/bower_components/Chart.js/Chart.min.js"></script>
    <!--build:js /static/scripts/property.html.js-->
    <script type="text/javascript" src="/static/bower_components/intro.js/minified/intro.min.js"></script>
    <script type="text/javascript" src="/static/scripts/property_introjs_init.js"></script>
    <script type="text/javascript" src="/static/bower_components/swiper/dist/js/swiper.jquery.min.js"></script>
    <script src="/static/bower_components/photoswipe/dist/photoswipe.js"></script>
    <script src="/static/bower_components/photoswipe/dist/photoswipe-ui-default.js"></script>
    <script src="/static/bower_components/jquery.easing/js/jquery.easing.min.js"></script>
    <script src="/static/vendors/jquery.stickynavbar/jquery.stickyNavbar.modified.js"></script>
    <script src="/static/vendors/iOSList/jquery.ioslist.js"></script>
    <script src="/static/scripts/property_gallery.js"></script>
    <script src="/static/scripts/show_historical_price.js"></script>
    <script src="/static/scripts/intention_form.js"></script>
    <script src="/static/scripts/mortgage_form.js"></script>
    <script src="/static/scripts/main_house_type_popup.js"></script>
    <script src="/static/scripts/bing_map.js"></script>
    <script src="/static/scripts/property_map.js"></script>
    <script src="/static/scripts/property_actions.js"></script>
    <script src="/static/vendors/jcarousel/jquery.jcarousel.min.js"></script>
    <script src="/static/vendors/jcarousel/jcarousel.responsive.js"></script>
    <script src="/static/bower_components/jquery.dotdotdot/src/js/jquery.dotdotdot.js"></script>
    <script src="/static/scripts/property_brochure.js"></script>
    <script src="/static/vendors/jweixin-1.0.0.js"></script>
    <!--endbuild-->
    <script>
        $(function () {
            $('.stickyNavbar').stickyNavbar({
                activeClass: "active",
                sectionSelector: "scrollto",
                selector: "li",
                animateCSS: false,
                jqueryEffects: false,
                zindex: 60,
                stickyModeFunction: function () {
                    if (!window.team.isPhone()) {
                        var scrollOffset = $(window).scrollTop()
                        var $contentNav = $('.propertyDetails .meta')
                        var contentNavTop = $contentNav.offset().top
                        return scrollOffset > contentNavTop - 200
                    }
                    return false
                }
            })


            $('#menu_button_phone').click(function (e) {
                if ($('#menu_content_phone').is(':visible')) {
                    $('#menu_content_phone').hide()
                }
                else {
                    $('#menu_content_phone').show()
                }
            })

            $('#menu_content_phone a').click(function (e) {
                $('#menu_content_phone').hide()
            })

            $('[data-fn=expendDescription]').on('click', function () {
                $(this).parent().hide()
                    .parent().find('[data-ui=description]').height('auto')
                $(this).parent().hide()
                    .parent().find('[data-ui=description]').toggleClass("no-after")
                ga('send', 'event', 'property_detail', 'click', 'extend-description')
            });

            $('.intentionTags').tabs({trigger: 'hover'})

            $(".regionReport .name").dotdotdot({
                // configuration goes here
            });
            $(".regionReport .des").dotdotdot({
                // configuration goes here
            });


            /*
            * Weixin share sdk
            * */
            var property = JSON.parse($('#pythonProperty').text())
            var weixin = JSON.parse($('#pythonWeixin').text())

            window.openWeChatShare = function (propertyId) {
                if (window.team.isWeChat()) {
                    if (window.team.isWeChatiOS()) {
                        $('.wechatPage_popup .buttonHolder').attr('src', '/static/images/property_details/wechat_share/phone/wechat_button_ios.png')
                    }
                    $('.wechatPage_popup').modal()
                    $('.wechatPage_popup').find('.close-modal').hide()
                }
                else {
                    location.href = '/wechat_share?property=' + propertyId
                }
            }

            $('.rmm-toggled .rmm-toggled-controls .rmm-toggled-share').on('click', function () {
                window.openWeChatShare(property.id)
                ga('send', 'event', 'property_detail', 'share', 'open-wechat-mobile')
            });

            if (typeof window.wx !== 'undefined') {
                window.wx.config({
                    debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                    appId: 'wx123992a4d173037b', // 必填，公众号的唯一标识
                    timestamp: weixin.timestamp, // 必填，生成签名的时间戳
                    nonceStr: weixin.noncestr, // 必填，生成签名的随机串
                    signature: weixin.signature,// 必填，签名，见附录1
                    jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage', 'onMenuShareQQ'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
                })

                window.wx.ready(function(){
                    var propertyTitle = property.name
                    if (property.city && property.city.name) {
                        propertyTitle += ', ' + property.city.name
                    }

                    var propertyImage = null
                    if (property.cover) {
                        propertyImage = property.cover
                    }else if (property.reality_images && property.reality_images.length) {
                        propertyImage = property.reality_images[0]
                    }else {
                        propertyImage = '/static/images/logo/logo_wechat.jpg'
                    }
                    var wechatShareData = {
                        title:property.name,
                        link: window.location.href,
                        imgUrl:propertyImage,
                        success:function(){
                            ga('send', 'event', 'property_detail', 'share', 'share-to-wechat-success')
                        },
                        cancel:function(){
                            ga('send', 'event', 'property_detail', 'share', 'share-to-wechat-cancel')
                        }
                    }
                    if (property.description) {
                        wechatShareData.desc = property.description.replace(/(\r\n|\n|\r)/gm,' ')
                    }

                    window.wx.onMenuShareTimeline(wechatShareData);
                    window.wx.onMenuShareAppMessage(wechatShareData);
                    window.wx.onMenuShareQQ(wechatShareData);
                })

                window.wx.error(function(res){
                    ga('send', 'event', 'property_detail', 'share', 'share-to-wechat-config-error', res.errMsg)
                })
            }
        })



    </script>
    <!-- @endif -->

    <!--@@close-->
%end
