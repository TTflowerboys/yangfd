<!--@@master = ./masters/master.html-->
<!--@@block = head-->
<!--build:css(dist) /static/styles/user_chat_details.html.css-->
<link rel="stylesheet" href="/static/styles/userChatDetails.css"/>
<link rel="stylesheet" href="/static/styles/dropload.css">
<!--endbuild-->

<!--@@close-->

<!--@@block = main-->

<div class="chatWrap">
	<textarea id="rentTicketData" style="display: none">
    {{json_dumps(rent_intention_ticket)}}
</textarea>
    <div class="main_container clearfix">
		<div class="chatUserInfo">
			%if (user and user.get('id') == rent_intention_ticket.get('interested_rent_tickets')[0].get('user').get('id')):
				<div class="userHeader userHeaderTenant">
                    <span class="userHeader_pic">
                        %if rent_intention_ticket.get('user').get('face'):
                            <img src="{{rent_intention_ticket.get('user').get('face')}}" alt="{{_('租客')}}">
                        %else:
                            <img src="/static/images/chat/placeholder_tenant.png" alt="{{_('租客')}}">
                        %end
                    </span>
					<div class="userHeader_type">
						{{_('租客')}}
					</div>
					<div class="userHeader_name">{{rent_intention_ticket.get('nickname')}}</div>
				</div>
			%else:
				<div class="userHeader">
                    <span class="userHeader_pic">
                        %if rent_intention_ticket.get('interested_rent_tickets')[0].get('user').get('face'):
                            <img src="{{rent_intention_ticket.get('interested_rent_tickets')[0].get('user').get('face')}}" alt="{{_('房东')}}">
                        %else:
                            <img src="/static/images/chat/placeholder_host.png" alt="{{_('房东')}}">
                        %end
                    </span>
					<div class="userHeader_type">
						{{_('房东')}}
					</div>
					<div class="userHeader_name">{{rent_intention_ticket.get('interested_rent_tickets')[0].get('user').get('nickname')}}</div>
				</div>
			%end

			<div class="chatDetails">
				<div class="chatRentMeta">
 				    <h1 class="title">
                                        % if rent_intention_ticket.get('interested_rent_tickets')[0] and rent_intention_ticket.get('interested_rent_tickets')[0].get('status') == 'rent':
                                            {{_('[已出租]')}}
                                        %elif rent_intention_ticket.get('interested_rent_tickets')[0] and rent_intention_ticket.get('interested_rent_tickets')[0].get('status') == 'draft':
                                            {{_('[已下架]')}}
                                        %end
 						<a href="/property-to-rent/{{rent_intention_ticket.get('interested_rent_tickets')[0].get('id')}}" target="_blank">{{rent_intention_ticket.get('interested_rent_tickets')[0].get('title')}}</a>
 					</h1>
 					<div class="meta">
 						<i class="icon-location_fill"></i>
 						{{rent_intention_ticket.get('interested_rent_tickets')[0].get('property').get('street')}}
 						{{rent_intention_ticket.get('interested_rent_tickets')[0].get('property').get('city',{}).get('name')}}
 						{{rent_intention_ticket.get('interested_rent_tickets')[0].get('property').get('zipcode')}}
 					</div>
 				</div>
		        <dl class="userDetailsList">
		            <dt>{{_('租期')}}</dt>
	            	% if 'rent_available_time' in rent_intention_ticket and rent_intention_ticket.get('rent_available_time',''):
	            		<dd>
	            		<span>{{_('租期开始日期')}}</span>
	            		<strong data-utc-time="{{rent_intention_ticket.get('rent_available_time','')}}"></strong>
	                    </dd>
	                % end
		            % if 'rent_deadline_time' in rent_intention_ticket and rent_intention_ticket.get('rent_deadline_time',''):
		            	<dd><span>{{_('租期结束日期')}}</span>
                        <strong data-utc-time="{{rent_intention_ticket.get('rent_deadline_time')}}"> </strong>
                        </dd>
                    % end
		            <dd><span>{{_('租期')}}</span>
		            % if 'minimum_rent_period' in rent_intention_ticket:
                        <strong>
                            {{_('最短租期')}}
                        </strong>
                    % else :
                        <strong>
                            {{_('租期不限')}}
                        </strong>
                    % end
                    </dd>
		        </dl>
		        <dl class="userDetailsList">
		            <dt>{{_('账单')}}</dt>
		            % if 'price' in rent_intention_ticket.get('interested_rent_tickets')[0] and rent_intention_ticket.get('interested_rent_tickets')[0].get('price'):
	            		<dd>
	            			<span>{{_('租金')}}</span>
	            			<strong>{{rent_intention_ticket.get('interested_rent_tickets')[0].get('price',{}).get('unit_symbol','')}} <b data-type="formatted_currency">
                                {{rent_intention_ticket.get('interested_rent_tickets')[0].get('price',{}).get('value','')}}
                            </b> {{_('/周')}}</strong>
	                    </dd>
	                % end

	                % if 'deposit' in rent_intention_ticket.get('interested_rent_tickets')[0] and rent_intention_ticket.get('interested_rent_tickets')[0].get('deposit',{}).get('value'):
	               		<dd>
	            			<span>{{_('押金')}}</span>
	            			<strong>
                            	{{rent_intention_ticket.get('interested_rent_tickets')[0].get('deposit',{}).get('unit_symbol','')}}<b data-type="formatted_currency">{{f_app.re.filter_zero(rent_intention_ticket.get('interested_rent_tickets')[0].get('deposit',{}).get('value'))}}</b>
		                        % if 'deposit' in rent_intention_ticket.get('interested_rent_tickets')[0] and rent_intention_ticket.get('interested_rent_tickets')[0].get('deposit',{}).get('localized_value'):
		                            <b>
		                                {{_('约')}}{{rent_intention_ticket.get('interested_rent_tickets')[0].get('deposit',{}).get('localized_unit_symbol')}}{{int(float(rent_intention_ticket.get('interested_rent_tickets')[0].get('deposit',{}).get('localized_value', 0)))}}
		                            </b>
		                        % end
	                        </strong>
	                    </dd>
                    % else :
                    	<dd>
	            			<span>{{_('押金')}}</span>
	                        <strong>
	                            {{_('面议')}}
	                        </strong>
	                    </dd>
                    % end
		        </dl>
		    </div>
		    
		    <a href="#showCardPopup" rel="modal:open" class="btn btn-primary">{{_('确认支付')}}</a>
		</div>
		<div class="chatCenter">
            % if rent_intention_ticket.get('interested_rent_tickets')[0] and rent_intention_ticket.get('interested_rent_tickets')[0].get('status') == 'to rent':
                <div class="box_hd">
                    <div class="fl">
                        <div class="content">
                        <textarea id="edit_area" class="edit_area" placeholder="{{_('消息')}}" maxlength="1000"></textarea>
                        <div class="toolbar"><a href="javascript:;"><i class="icon-art"></i></a></div>
                        </div>
                        <div class="requirementRentFormError"></div>
                        <div class="action"><button id="btn_send" class="btn btn_send ajaxButton">{{_('发送')}}</button></div>
                    </div>
                    <div class="fr">
                        <a href="/user-settings">
                        %if user.get('face'):
                            <img src="{{user.get('face')}}" class="avatar">
                        %else:
                            %if (user and rent_intention_ticket.get('interested_rent_tickets')[0].get('user') and user.get('id') == rent_intention_ticket.get('interested_rent_tickets')[0].get('user').get('id')):
                                <img src="/static/images/chat/placeholder_host_small.png" alt="{{_('房东')}}" class="avatar">
                            %else:
                                <img src="/static/images/chat/placeholder_tenant_small.png" alt="{{_('租客')}}" class="avatar">
                            %end
                        %end
                        </a>
                    </div>
                </div>
            % end
		    <div class="chatContent" id="chatContent"></div>
		    <div class="emptyPlaceHolder">{{_('没有最新留言')}}</div>
		    <img src="/static/images/common/ajax-loader.gif" id="loadIndicator" class="loadIndicator">
		</div>
    </div>
    % if rent_intention_ticket.get('interested_rent_tickets')[0] and rent_intention_ticket.get('interested_rent_tickets')[0].get('status') == 'to rent':
	<div class="floatChat_phone">
	    <div class="chat_center_phone">
		<a href="" class="chat_toolbar"><i class="icon-art"></i></a>
		<input type="text" class="chat_edit_area" id="chat_edit_area">
		<button id="btn_send_phone" class="btn_send_phone ajaxButton">{{_('发送')}}</button>
	    </div>
	</div>
    % end

</div>
	<!-- @@include =./partials/add_payment_popup.html -->

<!--@@close-->

<!--@@block = scripts -->
<script type="text/javascript" src="/static/bower_components/knockout/dist/knockout.js"></script>
<script src="/static/scripts/common_ko.js"></script>
<script src="/static/scripts/user_chat_details.js"></script>
<script src="/static/scripts/payment_popup.js"></script>
<script>
$(function(){
    if (window.location.href.match('addPaymentPopup=true')) {
        $('#add_payment_popup').show()
    }
    $('#add_payment_popup').on('click','.cancel',function(){
        $('#add_payment_popup').hide()
    })
})
</script>
<!--@@close -->
