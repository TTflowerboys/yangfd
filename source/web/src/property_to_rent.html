<!--@@master = masters/master.html-->

<!--@@block = custom_header-->
<div class="propertyHeader_phone  rmm" >
    <div class="rmm-toggled rmm-closed rmm-center-closed">
        <div class="rmm-toggled-controls">
            <div class="rmm-button">
                <img src="/static/images/common/header/phone/menu.png"/>
            </div>
            <div id="rmm-center-wrapper" class="rmm-center">
                <label id="newsHeader_title" class="title" for="">
                    %if rent:
                    {{rent.get('title',_('出租房详情'))}}
                    %end
                </label>
            </div>
            <div class="rmm-toggled-share">
                <img src="/static/images/property_details/phone/wechat_share.png" />
            </div>
        </div>
        <ul class="rmm-menu" style="display:none;">
            <li><a href="/">{{_('首页')}}</a></li>
            <li><a href="/property_list">{{_('海外房产')}}</a></li>
            <!-- @if ENV!='production' -->
            <li><a href="/crowdfunding-introduce">{{_('海外众筹')}}</a></li>
            <!-- @endif -->
            <!-- @if ENV!='production' -->
            <li><a href="/property_to_rent_list">{{_('海外租房')}}</a></li>
            <!-- @endif -->
            <li><a href="/news_list">{{_('投资资讯')}}</a></li>
        </ul>
    </div>
</div>

<!--@@close-->

%if rent:
<!--@@block = head-->
% from bottle import request

<!--build:css(dist) /static/styles/propertyToRent.html.css-->
<link rel="stylesheet" href="/static/vendors/jquery.stickynavbar/animate.min.css"/>
<link rel="stylesheet" href="/static/vendors/iOSList/jquery.ioslist.css"/>
<link rel="stylesheet" href="/static/styles/rentDetails.css"/>
<link rel="stylesheet" href="/static/styles/iconFont.css">
<link rel="stylesheet" href="/static/styles/project/tabbar.css"/>
<link rel="stylesheet" href="/static/styles/bingMap.css"/>
<link rel="stylesheet" href="/static/styles/phone/wechatSharePopup.css"/>
<link rel="stylesheet" href="/static/vendors/jcarousel/jcarousel.responsive.css"/>
<link rel="stylesheet" href="/static/styles/hostContactRequest.css"/>
<!--endbuild-->

<!-- minor change from original repo https://github.com/Fykec/excanvas, detail can check change log -->
<!--[if lte IE 8]>
<script type="text/javascript" src="/static/vendors/excanvas.min.js"></script>
<![endif]-->


<div id="stickyNavbar" class="stickyNavbar unsticky">
    <nav id="nav">
        <ul class="nav navbar-nav">
            <li class="menuItem">
                <a href="#rentDetails_description">{{_('出租房详情')}}</a>
            </li >
            %if (rent['property'].get('latitude') and rent['property'].get('longitude')) and rent['property'].get('country') and rent['property'].get('country').get('slug') in ['US', 'GB']:
            <li><a href="#propertyDetails_aroundMap">{{_('周边配套')}}</a></li>
            %end
            % if rent['property'].get('community_facility', []) and len(rent['property'].get('community_facility', [])):
            <li><a href="#propertyDetails_aroundMap">{{_('周边配套')}}</a></li>
            % end
        </ul>
        <a class="contact" href="tel:4000926433">
            {{!_('拨打 <strong>400-0926-433</strong>')}}
        </a>
    </nav>
</div>
<!--@@close-->

<!--@@block = main-->
<div class="propertyDetails">
    <div class="breadcrumb">
        % if rent['property'].get('country') and rent['property'].get('country').get('value'):
        <a class="parent" href="/property-to-rent-list?country={{rent['property'].get('country',{}).get('id')}}" target="_blank">{{rent['property'].get('country',{}).get('value','')}}</a> /
        % end
        % if rent['property'].get('city') and rent['property'].get('city').get('value'):
        <a class="parent" href="/property-to-rent-list?country={{rent['property'].get('country',{}).get('id')}}&city={{rent['property'].get('city',{}).get('id')}}" target="_blank">{{rent['property'].get('city',{}).get('value','')}}</a> /
        % end
        % if rent['property'].get('property_type') and rent['property'].get('property_type').get('value'):
        <a class="parent" href="/property-to-rent-list?country={{rent['property'].get('country',{}).get('id')}}&city={{rent['property'].get('city',{}).get('id')}}&property_type={{rent['property'].get('property_type').get('id')}}" target="_blank">{{rent['property'].get('property_type',{}).get('value','')}}</a> /
        %end
        <span class="current">{{rent.get('title','')}}</span>
    </div>
    <div class="content">
        <div class="pictures" >
            <div class="labels">
                %if rent['property'].get('property_type') and rent['property'].get('property_type').get('value'):
                <label class="type" for="">{{rent['property'].get('property_type').get('value')}}</label>
                %end
                %if rent.get('rent_type') and rent.get('rent_type').get('value'):
                <label class="rent" for="">{{rent.get('rent_type').get('value')}}</label>
                %end
            </div>

            <div class="big">
                <div class="item" data-tab-name="reality_images">
                    % if rent['property'].get('reality_images'):
                    <div class="rslides_wrapper">
                        <ul class="rslides" data-init="false">
                            % for image in rent['property'].get('reality_images'):
                            <li>
                                <div class="img" data-style="background:url('<url>') no-repeat;background-size: cover; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='<url>', sizingMethod='scale');" data-url="{{!fetch_image(image, property_id=rent['property'].get('id'))}}">
                                </div>
                            </li>
                            % end
                        </ul>
                        <div class="leftPressArea"></div>
                        <div class="rightPressArea"></div>
                    </div>
                    % else :
                    <img class="withPlaceholder" alt=""/>
                    % end
                </div>
            </div>
        </div>

        <div class="propertyCard_phone" >
            <div class="rentPrice row">
                <div class="title">
                    <h1 class="name">{{rent.get('title','')}}</h1>
                    <label class="publishDate">
                        % if publish_time:
                        <span>{{publish_time}}</span>{{_('发布')}}
                        % end
                    </label>
                </div>

                <div class="price_inner">
                    % if 'price' in rent and rent.get('price'):
                        <span>{{rent.get('price',{}).get('unit_symbol','')}}</span>
                        <span data-type="formatted_currency">
                            {{int(float(rent.get('price',{}).get('value','')))}}
                        </span>
                    % end
                    {{_('/周')}}
                    % if 'bill_covered' in rent and rent.get('bill_covered'):
                        <span>
                            {{_('包水电费')}}
                        </span>
                    % end
                </div>
            </div>
            % if 'country' in rent['property'] or 'city' in rent['property']:
            % country = rent['property'].get('country',{}).get('value')
            % city = rent['property'].get('city',{}).get('value')
            % city_string = ', '.join([x for x in [country,city] if x])
            <div class="tag row">
                <img src="/static/images/property_details/location-icon.png" alt=""/>
                <label>
                    {{city_string}}
                </label>
            </div>
            % end
            <div class="seperator"></div>
            <ul class="priceItems row">
                <li>
                    % if 'rent_period' in rent and rent.get('rent_period',{}).get('value',''):
                    <strong>
                        {{_('租期')}}{{rent.get('rent_period',{}).get('value','')}}
                    </strong>
                    % else :
                    <strong>
                        {{_('租期面议')}}
                    </strong>
                    % end
                    % if 'rent_available_time' in rent and rent.get('rent_available_time',''):
                    <span>
                        {{rent.get('rent_available_time').strftime("%Y-%m-%d")}}{{_('起')}}
                    </span>
                    % end
                </li>
                <li>

                    % if 'deposit_type' in rent and rent.get('deposit_type',{}).get('value',''):
                    <strong>
                        {{_('押金')}}{{rent.get('deposit_type',{}).get('value','')}}
                    </strong>
                    % else :
                    <strong>
                        {{_('面议')}}
                    </strong>
                    % end
                </li>
            </ul>
        </div>
        <div id="propertyDetails_description" class="meta scrollto">
            <ul class="numbers">
                % if rent.get('space'):
                <li>
                    {{_('房屋面积')}}
                    <strong>
                        {{float("{0:.2f}".format(float(rent.get('space',{}).get('value',0))))}}
                        <span class="unit">
                            {{!format_unit(rent.get('space',{}).get('unit',''))}}
                        </span>
                    </strong>
                </li>
                % end
                % if rent['property'].get('bedroom_count','') :
                <li>
                    {{_('卧室')}}
                    <strong>{{ rent['property'].get('bedroom_count','') }}</strong>
                </li>
                % end

                % if rent['property'].get('bathroom_count') :
                <li>
                    {{_('卫生间')}}
                    <strong>{{ rent['property'].get('bathroom_count') }}</strong>
                </li>
                % end

                % if rent['property'].get('living_room_count',''):
                <li>
                    {{_('客厅')}}
                    <strong>{{ rent['property'].get('living_room_count','') }}</strong>
                </li>
                % end
            </ul>
            <div class="seperator"></div>
            <ul class="numbersWithoutSeperator">
                % if 'street' in rent['property']:
                <li>
                    {{_('街区')}}
                    <strong>
                        {{rent['property'].get('street','')}}
                    </strong>

                </li>
                % end
                % if 'community' in rent['property']:
                <li>
                    {{_('小区')}}
                    <strong>{{ rent['property'].get('community','') }}</strong>
                </li>
                % end

                % if 'floor' in rent['property']:
                <li>
                    {{_('楼层')}}
                    <strong>{{ rent['property'].get('floor','') }}</strong>
                </li>
                % end

                % if 'house_name' in rent['property']:
                <li>
                    {{_('房间名')}}
                    <strong>{{ rent['property'].get('house_name','') }}</strong>
                </li>
                % end
            </ul>

            %if rent.get('description'):
            <div class="seperator"></div>
            <div class="description" data-ui="description">
                {{!rent.get('description')}}
            </div>
            <div class="clearfix expendDescription_wrapper">
                <button data-fn="expendDescription" class="ghostButton red" >{{_('展开')}}</button>
            </div>
            %end
        </div>

        % if 'indoor_facility' in rent['property'] or 'community_facility' in rent['property']:
        <div class="facilities_section scrollto">
            <div class="seperator"></div>
            % if rent['property'].get('indoor_facility'):
            <div class="facilities_wrapper">
                <h3 class="facility_title">{{_('房间设施')}}</h3>
                <!--<a class="more">{{_('更多')}}</a>
                <a class="ghostButton red more">{{_('更多')}}</a>-->
                <ul class="facilities">
                    % for facility in rent['property'].get('indoor_facility'):
                    %if facility.get('value'):
                    <li>
                        <i class="icon-{{facility.get('slug','')}}"></i>
                        <strong>
                            {{facility.get('value')}}
                        </strong>
                    </li>
                    %end
                    % end
                </ul>
            </div>
            % end

            % if rent['property'].get('community_facility'):
            <div class="facilities_wrapper">
                <h3 class="facility_title">{{_('小区设施')}}</h3>
                <!--<a class="more">{{_('更多')}}</a>
                <a class="ghostButton red more">{{_('更多')}}</a>-->
                <ul class="facilities">
                    % for facility in rent['property'].get('community_facility'):
                    %if facility.get('value'):
                    <li>
                        <i class="icon-{{facility.get('slug','')}}"></i>
                        <strong>
                            {{facility.get('value')}}
                        </strong>
                    </li>
                    %end
                    % end
                </ul>
            </div>
            % end
        </div>
        % end

        %if (rent['property'].get('latitude') and rent['property'].get('longitude')) and rent['property'].get('country'):
        <div id="propertyDetails_aroundMap" class="maps_wrapper scrollto">
            <div class="seperator"></div>
            <div class="staticMap">
                <img id="mapImg" class="mapImg" alt=""/>
                <div id="showMap" class="button red">
                    <label for="">
                        {{_('查看房产周边设施')}}
                    </label>
                    <img class="icons" alt="" src="/static/images/property_details/icon-static-map-category.png"/>
                </div>
            </div>
            <!--@@include partials/bing_map.html  -->
            <!--@@include partials/bing_map_icons.html -->
            <img src="/static/images/common/ajax-loader.gif" id="mapLoadIndicator" class="mapLoadIndicator" style="display:none;"/>
        </div>
        %end
    </div>

        <div class="aside">
            <div class="propertyCard">
                <h1>{{rent.get('title','')}}</h1>
                <label class="publishDate">
                    % if publish_time:
                        <span>{{publish_time}}</span>{{_('发布')}}
                    % end
                </label>
                % if 'country' in rent['property'] or 'city' in rent['property']:
                    % country = rent['property'].get('country',{}).get('value')
                    % city = rent['property'].get('city',{}).get('value')
                    % city_string = ', '.join([x for x in [country,city] if x])
                    <div class="tag">
                        <img src="/static/images/property_details/location-icon.png" alt=""/>
                        <label>
                            {{city_string}}
                        </label>
                    </div>
                % end

                % if 'price' in rent and rent.get('price'):
                <div class="rentPrice">
                    <div class="price_inner">
                        <span>{{rent.get('price',{}).get('unit_symbol','')}}</span>
                        <span data-type="formatted_currency">
                            {{int(float(rent.get('price',{}).get('value','')))}}
                        </span>
                        {{_('/周')}}
                        % if 'bill_covered' in rent and rent.get('bill_covered'):
                        <span>
                            {{_('，包水电费')}}
                        </span>
                        % end
                    </div>
                    <div class="seperator"></div>
                    <ul class="priceItems">
                        <li>
                            {{_('租期')}}
                            % if 'rent_period' in rent and rent.get('rent_period',{}).get('value',''):
                            <strong>
                                {{rent.get('rent_period',{}).get('value','')}}
                            </strong>
                            % else :
                            <strong>
                                {{_('面议')}}
                            </strong>
                            % end
                            % if 'rent_available_time' in rent and rent.get('rent_available_time',''):
                            <span>
                                {{rent.get('rent_available_time').strftime("%Y-%m-%d")}}{{_('起')}}
                            </span>
                            % end
                        </li>

                        <li>
                            {{_('押金')}}
                            % if 'deposit_type' in rent and rent.get('deposit_type',{}).get('value',''):
                            <strong>
                                {{rent.get('deposit_type',{}).get('value','')}}
                            </strong>
                            % else :
                            <strong>
                                {{_('面议')}}
                            </strong>
                            % end
                        </li>
                    </ul>
                </div>
                %end

                <div class="seperator"></div>
                    <table class="actions">
                        <tr>
                            <td style="text-align:left;">
                                % isFavorite = False
                                % favId = None
                                % for item in favorite_list:
                                    %if item.get('ticket') and item.get('ticket').get('id') == rent.get('id'):
                                        % isFavorite = True
                                        % favId = item.get('id')
                                    %end
                                % end
                                <button data-fn="addFav" data-rent-id="{{rent.get('id','')}}"
                                    class="flatButton ajaxButton"
                                    style="{{ 'display:none' if isFavorite else ''}}"
                                    data-message-40090="{{_('已经收藏过了')}}">
                                    <img src="/static/images/property_details/icon-star.png" alt=""/>
                                    <span class="text"> {{_('收藏')}} </span>
                                </button>
                                <button data-fn="removeFav"
                                    class="flatButton ajaxButton"
                                    style="{{ 'display:none' if not isFavorite else ''}}"
                                    % if isFavorite:
                                        data-favorite-id="{{favId}}"
                                    % end
                                    >
                                <img src="/static/images/property_details/icon-star.png" alt=""/>
                                <span class="text"> {{_('取消收藏') }} </span>
                                </button>
                            </td>
                            <td style="text-align:center;">
                                <button data-fn="shareToWeChat" class="flatButton green" data-id="{{rent.get('id','')}}">
                                    <img src="/static/images/property_details/icon-wechat.png" alt=""/>
                                    {{_('分享到微信')}}
                                </button>
                            </td>
                            <td style="text-align:right;">
                                % title = rent.get('title','')
                                <button class="flatButton orange" onclick="team.shareToWeibo({title:'{{title}}'}) ">
                                    <img src="/static/images/property_details/icon-weibo.png" alt=""/>
                                    {{_('分享到微博')}}
                                </button>
                            </td>
                        </tr>
                    </table>
                </div>

                <!--@@include=./partials/host_contact_request.html -->


            </div>
        </div>

</div>

<ul class="floatBar_phone hiddenInClient">
    <li class="phone">
        <a href="/host-contact-request/{{rent.get('id','')}}?requestContact=true" >
            {{_('联系房东')+':'}}
            <span>+{{rent.get('creator_user',{}).get('country_code','') }}</span>
            <span>{{rent.get('creator_user',{}).get('phone','')}}</span>
        </a>
    </li>
    <li class="favorite"
        data-fn="addFav"
        data-rent-id="{{rent.get('id','')}}"
        style="{{ 'display:none' if isFavorite else ''}}"
        data-message-40090="{{_('已经收藏过了')}}"
        ><img src="/static/images/property_details/phone/favorite.png"></img>
    </li>
    <li class="favorite"
        data-fn="removeFav"
        style="{{ 'display:none' if not isFavorite else ''}}"
        % if isFavorite:
            data-favorite-id="{{favId}}"
        % end
    ><img src="/static/images/property_details/icon-star.png"></img>
    </li>
</ul>

        <div id="popupShareToWeChat" style="display:none; text-align:center;font-size: 12px;">
            <img src="" alt="二维码" width="220" height="220"/>
            <p>{{_('打开微信，使用 “扫一扫” 即可将移动端主页分享到朋友圈')}}</p>
        </div>

        <div class="wechatPage_popup" style="display:none;">
            <h1 class="tip"> {{!_('点击右上角')}}</h1>
            <img class="buttonHolder"  alt="" src="/static/images/property_details/wechat_share/phone/wechat_button.png"/>
            <h1 class="tip"> {{!_('分享链接给微信好友')}}</h1>
            <div class="guide">
                <img  alt="" src="/static/images/property_details/wechat_share/phone/wechat_guide.png"/>
            </div>
            <a class="gotIt" href ="#close-modal" rel="modal:close">{{_('我知道了')}}</a>
        </div>

        <!-- @@include=/static/templates/place_item.tpl.html-->


        <!--@@close-->

        <!--@@block = scripts-->

        <script>

            //just load after jquery
            window.initSlidesImages = function ($slides) {
                if ($slides.attr('data-init') === 'false') {
                    $slides.find('li .img').each(function( index ) {
                        var url = $(this).attr('data-url')
                        if (team.isPhone()) {
                            url += '_thumbnail'
                        }
                        var r = new RegExp('<url>', 'g');
                        var style = $(this).attr('data-style').replace(r, url)
                        $(this).attr('style', style)
                    });
                    $slides.attr('data-init', 'true')
                }
            }
            // init the first slides
            initSlidesImages($('.pictures [data-tab-name]').first().find('.rslides'))
        </script>

        <!--build:js /static/scripts/property-to-rent.html.js-->
        <script src="/static/vendors/jquery.easing.min.js"></script>
        <script src="/static/vendors/jquery.stickynavbar/jquery.stickyNavbar.modified.js"></script>
        <script src="/static/vendors/iOSList/jquery.ioslist.js"></script>
        <script src="/static/scripts/property_gallery.js"></script>
        <script src="/static/scripts/bing_map.js"></script>
        <script src="/static/vendors/jcarousel/jquery.jcarousel.min.js"></script>
        <script src="/static/vendors/jcarousel/jcarousel.responsive.js"></script>
        <script src="/static/vendors/jquery.dotdotdot.js"></script>
        <script src="/static/vendors/jweixin-1.0.0.js"></script>
        <script src="/static/scripts/host_contact_request.js"></script>
        <script src="/static/scripts/property_to_rent_actions.js"></script>
        <!--endbuild-->
        <script>
            $(function () {
                //Format publish time
                $('.publishDate span').text(team.parsePublishDate($($('.publishDate span')[0]).text()))

                $('#menu_button_phone').click(function (e) {
                    if ($('#menu_content_phone').is(':visible')) {
                        $('#menu_content_phone').hide()
                    }
                    else {
                        $('#menu_content_phone').show()
                    }
                })

                $('#menu_content_phone a').click(function (e) {
                    $('#menu_content_phone').hide()
                })

                $('[data-fn=expendDescription]').on('click', function () {
                    $(this).parent().hide()
                        .parent().find('[data-ui=description]').height('auto')
                    $(this).parent().hide()
                        .parent().find('[data-ui=description]').toggleClass("no-after")
                    ga('send', 'event', 'property_detail', 'click', 'extend-description')
                });

                window.openWeChatShare = function (rentId) {
                    if (window.team.isWeChat()) {
                        if (window.team.isWeChatiOS()) {
                            $('.wechatPage_popup .buttonHolder').attr('src', '/static/images/property_details/wechat_share/phone/wechat_button_ios.png')
                        }
                        $('.wechatPage_popup').modal()
                        $('.wechatPage_popup').find('.close-modal').hide()
                    }
                    else {
                        location.href = '/wechat-poster/' + rentId
                    }
                }

                $('.rmm-toggled .rmm-toggled-controls .rmm-toggled-share').on('click', function () {
                    window.openWeChatShare('{{rent.get('id','')}}')
                    //ga('send', 'event', 'property_to_rent_detail', 'share', 'open-wechat-mobile')
                });

                //Map Part
                %if rent['property'].get('latitude') and rent['property'].get('longitude'):
                if ($('.maps_wrapper')) {
                    var location = {latitude:{{rent['property'].get('latitude')}}, longitude:{{rent['property'].get('longitude')}}}
                    window.setupMap(location, function () {

                        $('#mapImg, #showMap').click(function (e) {
                            if (!$('#mapLoadIndicator').is(':visible')) {
                                window.showMapIndicator()
                                var scriptString = '<script src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0&onscriptload=onBingMapScriptLoad"></' + 'script>'
                                window.onBingMapScriptLoad = function () {
                                    //showMap
                                    $('.staticMap').hide()
                                    $('.maps').show()
                                    //setUp Map Tabs
                                    $('.maps').tabs({trigger: 'click'}).on('openTab', function (event, target, tabName){
                                        $('[data-tab-name=' + tabName + ']').show()
                                    })

                                    //TODO: find why need get region for different map, may because for the delay after bing map load, or load bing map module for different map
                                    window.showMapIndicator()
                                        window.showTransitMap(location, null, true, 14, '{{rent['property'].get('country').get('slug')}}', function () {
                                        window.hideMapIndicator()
                                    })
                                    window.showMapIndicator()
                                        window.showSchoolMap(location, null, true, 14, '{{rent['property'].get('country').get('slug')}}', function () {
                                        window.hideMapIndicator()
                                    })
                                    window.showMapIndicator()
                                        window.showFacilityMap(location, null, true, 14, '{{rent['property'].get('country').get('slug')}}', function () {
                                        window.hideMapIndicator()
                                    })
                                    window.hideMapIndicator()
                                }
                                $('body').append(scriptString)
                            }
                        })
                    })
                }
                %end
            })
        </script>

        <!--@@close-->
%end
