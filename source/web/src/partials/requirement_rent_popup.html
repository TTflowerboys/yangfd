<textarea id="fullCountryData" style="display: none;">
    {{json_dumps(full_country_list)}}
</textarea>
%if not ('rent_intention_ticket' in vars() or 'rent_intention_ticket' in globals()):
%    rent_intention_ticket = {}
%end
<div id="requirement_rent_popup" class="requirement_popup requirement_rent_popup"  style="display:none">
    <div class="requirement_popup_shadow"></div>
    <div class="requirement_wrapper">
        <div class="requirement">
            <div class="info">
                <div class="requirement_title">
                    <h2 class="title">{{_('求租意向单')}}</h2>
                    <h3 class="hint" data-show="normal" style="display: none">{{_('洋房东致力于提供最精准最优质的服务给我们每一位客户，提交您的求租需求，当平台有满足您需求的房源出现时，可以第一时间通知您。')}}</h3>
                    <h3 class="hint" data-show="requestContact" data-hide="delegateRent" style="display: none">{{_('洋房东致力于提供最精准最优质的服务给我们每一位客户，请您填写求租需求后继续联系此房东。同时当平台有满足您需求的房源出现时，会第一时间邮件通知您。')}}</h3>
                    <h3 class="hint" data-show="delegateRent" data-hide="requestContact" style="display: none">{{_('洋房东致力于提供最精准最优质的服务给我们每一位客户，请您填写求租需求后等待平台租房顾问与您取得联系。同时当平台有满足您需求的房源出现时，会第一时间邮件通知您。')}}</h3>
                </div>
                <!--<div class="contact">
                    <label class="hint">{{_('联系我们')}}</label>
                    <a href="tel:{{get_phone_numbers('link')[0]}}"><i></i>{{get_phone_numbers('display')[0]}}</a>
                </div>-->
            </div>
            <div class="formWrap">
                <div class="stepWrap ">
                    <div class="step step1">1<p class="info">{{_('选择求租地址')}}</p></div>
                    <div class="step step2">2<p class="info">{{_('填写求租详情')}}</p></div>
                    <div class="step step3">3<p class="info">{{_('求租者联系方式')}}</p></div>
                </div>
                <form class="requirement_rent_form">
                    <div class="step1" data-show-step="1">
                    <table >
                        <tr>
                            <td>
                                <select class="select-chosen country-select" data-placeholder="{{_('请选择国家')}}" data-validator="required" data-name="{{_('国家')}}" data-serialize="country" data-value="{{rent_intention_ticket.get('country',{}).get('code','')}}">

                                </select>
                                <select class="select-chosen city-select" data-placeholder="{{_('请选择城市')}}" data-change-title data-validator="required" data-name="{{_('城市')}}" data-serialize="city" data-value="{{rent_intention_ticket.get('city',{}).get('name','')}}">
                                </select>
                            </td>
                        </tr>                        
                    </table>
                    <div class="row">
                        
                            <p class="title">{{_('您希望租住在哪些地点附近？可以填写您的工作地点或者所读学校等')}}</p>
                            <div search-box-control data-serialize="featured_facility" data-bind="">
                                <ul class="featuredFacilityList" data-bind="foreach: featuredFacility">
                                    <li>
                                        <featured-facility-search-box params="parentVM: $parent, featuredFacilityType: ['hesa_university', 'doogal_station', 'custom_featured_facility'], placeholder: '{{_('地点')}}'" data-bind="">
                                        </featured-facility-search-box>
                                        <button class="delete" type="button" data-bind="click: function (data, event) {$parent.removeFeaturedFacility(data, $index())}, visible: $index"><i class="icon-delete"></i></button>
                                    </li>
                                </ul>
                                <button class="button red featuredFacilityAdd" type="button" data-bind="click: addFeaturedFacility, visible: featuredFacility().length < 5" >
                                    {{_('新增地点')}}
                                </button>
                            </div>                        
                    </div>
                    </div>
                    <div class="step2" data-show-step="2">
                        <div class="row">
                            <div class="col rentType">
                                <p class="title">{{_('求租类型')}}</p>
                                <select class="select-chosen rentType" data-change-title data-validator="required" data-name="{{_('求租类型')}}" data-serialize="rent_type">
                                    %for index, rent_type in enumerate(rent_type_list):
                                    <option value="{{rent_type.get('id')}}"
                                        %if rent_intention_ticket.get('rent_type',{}).get('id','') == rent_type.get('id') or ((not rent_intention_ticket.get('rent_type',{}).get('id','')) and index == 0):
                                        selected
                                        %end
                                        >
                                        {{rent_type.get('value')}}
                                    </option>
                                    %end
                                </select>
                            </div>
                            <div class="col bedroomCount" toggle-control data-serialize="bedroom_count" data-bind="">
                                <p class="title">{{_('居室数')}}</p>
                                % for bedroom_count in bedroom_count_list:
                                    <div class="toggleTag" data-id="{{bedroom_count.get('id')}}">{{bedroom_count.get('value')}}</div>
                                % end
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <p class="title">{{_('预算')}}(
                                    <!--@@include=./current_currency.html -->
                                    {{_('/周')}}
                                    )</p>
                                <!--<select class="select-chosen rentBudget" data-change-title data-validator="required" data-name="{{_('预算')}}" data-serialize="rent_budget">
                                    %for index, rent_budget in enumerate(rent_budget_list):
                                    %if rent_budget.get('currency') == _.currency:
                                    <option value="{{rent_budget.get('id')}}" data-index="{{index}}"
                                    %if rent_intention_ticket.get('rent_budget',{}).get('id','') == rent_budget.get('id') or ((not rent_intention_ticket.get('rent_budget',{}).get('id','')) and index == 0):
                                    selected
                                    %end
                                        >{{rent_budget.get('value')}}</option>
                                    %end
                                    %end
                                </select>-->
                                <div class="selectWrapper">
                                    <select class="select-chosen rentBudget" name="rentBudgetMin" data-change-title data-name="{{_('预算下限')}}" data-disable-chosen-search="true">
                                        <option value="">{{_('无下限')}}</option>
                                        %for index, rent_budget in enumerate(rent_budget_item_list):
                                        %if rent_budget.get('currency') == _.currency:
                                        <option value="{{rent_budget.get('slug')}}"
                                            %if rent_intention_ticket.get('rent_budget_min',{}).get('value','') == rent_budget.get('slug').split(':')[0] and rent_intention_ticket.get('rent_budget_min',{}).get('unit','') == rent_budget.get('slug').split(':')[1]:
                                            selected
                                            %end
                                            >{{rent_budget.get('value')}}</option>
                                        %end
                                        %end
                                    </select>
                                </div>
                                <span class="bridge">{{_('至')}}</span>
                                <div class="selectWrapper">
                                    <select class="select-chosen rentBudget" name="rentBudgetMax" data-change-title data-name="{{_('预算上限')}}" data-disable-chosen-search="true">
                                        <option value="">{{_('无上限')}}</option>
                                        %for index, rent_budget in enumerate(rent_budget_item_list):
                                        %if rent_budget.get('currency') == _.currency:
                                        <option value="{{rent_budget.get('slug')}}"
                                            %if rent_intention_ticket.get('rent_budget_max',{}).get('value','') == rent_budget.get('slug').split(':')[0] and rent_intention_ticket.get('rent_budget_max',{}).get('unit','') == rent_budget.get('slug').split(':')[1]:
                                        selected
                                        %end
                                        >{{rent_budget.get('value')}}</option>
                                        %end
                                        %end
                                    </select>
                                </div>
                            </div>
                            <div class="col">
                                <p class="title">{{_('租期')}}</p>
                                <input type="text" class="startDate dateInput" placeholder="{{_('开始日期')}}" data-validator="date" data-name="{{_('开始日期')}}" data-serialize="rent_available_time|time" data-value="{{rent_intention_ticket.get('rent_available_time','')}}"/>
                                <span class="bridge">{{_('至')}}</span>
                                <input type="text" class="endDate dateInput" placeholder="{{_('结束日期')}}" data-validator="date"  data-name="{{_('结束日期')}}" data-serialize="rent_deadline_time|time" data-value="{{rent_intention_ticket.get('rent_deadline_time','')}}"/>
                            </div>
                        </div>
                        <div class="row">
                            <p class="title">{{_('入住人数')}}</p>
                            <select class="select-chosen male" id="" data-name="{{_('男生人数')}}" data-serialize="male_roommates"  data-disable-chosen-search="true">
                                 %for index in [0, 1, 2, 3, 4, 5, 6, 7, 8]:
                                    <option value="{{index}}"
                                        >
                                        {{index}}{{_('男')}}
                                    </option>
                                 %end
                            </select>
                            <select class="select-chosen female" id="" data-name="{{_('女生人数')}}" data-serialize="female_roommates" data-disable-chosen-search="true">
                                %for index in [0, 1, 2, 3, 4, 5, 6, 7, 8]:
                                    <option value="{{index}}"
                                        >
                                        {{index}}{{_('女')}}
                                    </option>
                                 %end
                            </select>
                        </div>
                        <div class="row" radio-control data-serialize="smoke"  data-bind="false">
                            <span class="title radioTitle">{{_('是否吸烟')}}</span>
                            <label class="radioWrap" data-bind="true">
                                <input class="currantRadio" type="radio" name="smoke"/><label>{{_('是')}}</label>
                            </label>
                            <label class="radioWrap" data-bind="false">
                                <input class="currantRadio" type="radio" name="smoke" checked/><label>{{_('否')}}</label>
                            </label>
                        </div>
                        <div class="row" radio-control data-serialize="baby" data-bind="false">
                            <span class="title radioTitle">{{_('是否会带小孩一同入住')}}</span>
                            <label class="radioWrap" for="" data-bind="true">
                                <input class="currantRadio" type="radio" name="baby"/><label >{{_('是')}}</label>
                            </label>
                            <label class="radioWrap" for="" data-bind="false">
                                <input class="currantRadio" type="radio" name="baby" checked/><label >{{_('否')}}</label>
                            </label>
                        </div>
                        <div class="row" radio-control data-serialize="pet" data-bind="false">
                            <span class="title radioTitle">{{_('是否携宠物入住')}}</span>
                            <label class="radioWrap" for=""  data-bind="true">
                                <input class="currantRadio" type="radio" name="pet"/><label>{{_('是')}}</label>
                            </label>
                            <label class="radioWrap" for=""  data-bind="false">
                                <input class="currantRadio" type="radio" name="pet" checked/><label>{{_('否')}}</label>
                            </label>
                        </div>
                        <div class="row">
                            <textarea name="requirementRentDesc" id="" rows="3" placeholder="{{_('写下您的其他需求和描述，方便我们在挑选房源时作为参考')}}" data-validator="trim,maxLength(300)" data-name="{{_('求租描述')}}" data-serialize="description">{{rent_intention_ticket.get('description','')}}</textarea>
                        </div>
                    </div>
                    <div class="step3" data-show-step="3">
                        <div class="row">
                            <p class="title">{{_('姓名')}}</p>
                            <input type="text" class="requirementRentName" name="requirementRentName" placeholder="{{_('姓名')}}" data-validator="required,trim,maxLength(20)"  data-name="{{_('姓名')}}" data-serialize="nickname"/>
                            <select class="select-chosen gender" id="" data-name="{{_('性别')}}" data-serialize="gender">
                                <option value="male">
                                    {{_('男')}}
                                </option>
                                <option value="female">
                                    {{_('女')}}
                                </option>
                            </select>
                            <select class="select-chosen occupation" id="" data-name="{{_('职业')}}" data-serialize="occupation">
                                % for occupation in occupation_list:
                                    <option value="{{occupation.get('id')}}"
                                            % if occupation.get('slug') == 'student':
                                            selected
                                            %end
                                            >
                                            {{occupation.get('value')}}
                                    </option>
                                %end
                            </select>
                        </div>
                        <div class="row">
                            <p class="title">{{_('联系方式')}}</p>
                            <!-- @@include =country_code_select.html -->
                            <input type="text" class="requirementRentPhone" name="requirementRentPhone" placeholder="{{_('电话')}}" data-validator="required,trim,phone"  data-name="{{_('电话')}}"/>
                        </div>
                        <div class="row">
                            <input type="text" class="requirementRentEmail" name="requirementRentEmail" placeholder="{{_('邮箱')}}" data-validator="required,trim,email"  data-name="{{_('邮箱')}}" data-serialize="email"/>
                        </div>
                        <div class="row">
                            <input type="text" class="requirementWechat" name="requirementWechat" placeholder="{{_('微信（选填）')}}" data-validator="trim"  data-name="{{_('微信（选填）')}}" data-serialize="wechat"/>
                        </div>
                        % if not user:
                        <div class="row">
                            <input type="text" class="referral" name="referral" placeholder="{{_('推荐码（选填）')}}" data-validator="trim"  data-name="{{_('推荐码（选填）')}}" data-serialize="referral"/>
                        </div>
                        % end
                        <div class="row requirementRentAgreeWrap">
                            <input type="checkbox" class="requirementRentAgree currantCheckbox" name="requirementRentAgree" id="requirementRentAgree" data-serialize="noregister|reverse"/>
                            <label for="requirementRentAgree">{{_('我希望注册为会员以便以后能够更新我的求租需求')}}</label>
                        </div>

                    </div>
                    <div class="requirementRentFormError"></div>
                </form>
                <div class="actionWrap">
                    <div data-show-step="1">
                        <button class="actionButton ghostButton red" data-action="gotoNext">{{_('下一步')}}</button>
                    </div>
                    <div data-show-step="2">
                        <button class="actionButton ghostButton red" data-action="gotoPrev">{{_('上一步')}}</button>
                        <button class="actionButton ghostButton red" data-action="gotoNext">{{_('下一步')}}</button>

                    </div>
                    <div data-show-step="3">
                        <button class="actionButton ghostButton red" data-action="gotoPrev">{{_('上一步')}}</button>
                        <button class="actionButton button red ajaxButton" type="submit">{{_('提交')}}</button>
                    </div>
                </div>
            </div>
            <div class="successWrap">
                <h2 data-show="normal" style="display: none">{{_('提交成功')}}</h2>
                <h2 data-show="delegateRent" data-hide="requestContact" style="display: none">{{_('提交成功，我们会在24小时内与您联系')}}</h2>
                <p class="hint">您的求租意向单已经提交成功，您可以：</p>
                <p class="item" data-show="delegateRent" data-hide="requestContact">{{_('负责该房源的租房顾问会在24小时内与您取得联系')}}</p>
                <p class="item" data-show="requestContact" data-hide="delegateRent">{{_('已获取到当前房东的联系方式')}}</p>
                <p class="item">{{_('让满足您求租需求的房源第一时间主动找到你，找房再也不用临时抱佛脚')}}</p>
                <p class="item">{{_('在个人中心在中查看自己的')}}<a href="/user-intentions#rent">{{_('求租意向单')}}</a> {{_('，便捷地查看已联系过房东的联系方式，当您已经租到房子时可以修改求租单状态，平台将停止向您推荐')}}</p>
                <p class="item">{{_('还想订阅其他合适的出租房源？')}}<a href="javascript:window.openRequirementRentForm()">{{_('提交新的求租意向单 ')}}</a></p>
                <!--<div class="contact">
                    <label class="hint">{{_('联系我们')}}</label>
                    <a href="tel:{{get_phone_numbers('link')[0]}}"><i></i>{{get_phone_numbers('display')[0]}}</a>
                </div>-->

                <div data-show="requestContact"  data-hide="delegateRent" class="hostContactWrap">
                    <p class="hint">{{_('正在为您加载您要查看的房东联系方式...')}}</p>
                    <div class="host" style="display: none">
                        <img class="avatar" src="/static/images/property_details/ico_phoneowner.png"></img>
                        <label class="hostName"></label>
                        <!--<label class="hostType"></label>-->
                        <div class="hostPhone hostContact">
                            <a>
                                <i class="ico icon-phone_icon"></i>
                                <span></span> <span></span>
                            </a>
                        </div>
                        <div class="hostEmail hostContact">
                            <a class="clearfix">
                                <i class="ico icon-email"></i>
                                <span class="email"></span>
                            </a>
                        </div>
                        <div class="hostWechat hostContact">
                            <i class="ico icon-wechat"></i>
                            <span></span>
                        </div>
                    </div>
                </div>
                <div class="qrcodeWrap" style="display: none;">
                    <div class="imageWrap">
                        <img class="qrcode" width="192" height="192" alt="{{_('二维码')}}"/>
                    </div>
                    <p>
                        {{_('扫一扫分享“洋房动App”')}}<br>
                        {{_('转发就获取1个额外联系房东机会')}}
                    </p>
                </div>
            </div>
        </div>
        <button name="cancel" class="cancel"><i class="icon-delete"></i></button>
    </div>
</div>
