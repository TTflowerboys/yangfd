<form name="signin" class="signinForm" autocomplete="on">
    <div class="form bordered">
        <!-- @@include=phone_row.html -->
        <hr>
        <div class="form_row">
            <img src="/static/images/icon/lock.png" alt=""/>
            <input name="password" type="password" placeholder={{_('密码')}} size=10 data-validator="required, trim">
            <a id="forgotPassword" href="#" onclick="project.goToResetPassword()"
                style="position:absolute; right:0;font-size:12px; color:#aaa;">{{_('忘记密码')}}</a>
        </div>
    </div>
    <button type="submit" class="signin button gray">{{_('登录')}}</button>
    <p class="errorMessage" style="display:none"></p>
    <h3 class="notHaveAccountHint">{{_('还没有账号？请')}}<a href="#" onclick="project.goToSignUp()">{{_('注册')}}</a></h3>
</form>

<script>
    $('form[name=signin]').submit(function (e) {
        e.preventDefault()
        var valid = $.validate(this, {onError: function (dom, validator, index) {
            alert(dom.name + " validate error " + validator)
        }})
        if (!valid) {return}
        var params = $(this).serializeObject()
        params.password = Base64.encode(params.password)
        $.post("/api/1/user/login",
            params,
            function (data, status) {
                if (data.ret != 0) {
                    alert("Data: " + data.msg + "\nStatus: " + status);
                }
                else {
                    project.goBackFromURL()
                }
            });
    })
</script>
