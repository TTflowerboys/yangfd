<!--@@master = ./masters/master.html-->
<!--@@block = head-->
<!--build:css(dist) /static/styles/how_it_works.html.css-->
<link href="/static/styles/howItWorks.css" rel="stylesheet"/>
<link rel="stylesheet" href="/static/styles/project/processCard.css"/>
<!--endbuild-->

<!--@@close-->


<!--@@block = custom_header-->
<div class="howItWorksHeader_phone  rmm" >
    <div class="rmm-toggled rmm-closed rmm-center-closed">
        <div class="rmm-toggled-controls">
            <div class="rmm-button">
                <img src="/static/images/common/header/phone/menu.png"/>
            </div>
            <div id="rmm-center-wrapper" class="rmm-center">
                <label id="howItWorks_title" class="title" for="">
                    {{current_intention.get('value')}}
                </label>
                <img class="rmm-center-indicator" alt="" src="/static/images/common/header/phone/indicator.png"/>
            </div>
            <div class="rmm-toggled-title">
                <img src="/static/images/common/header/phone/user_phone.png" />
            </div>
        </div>
        <ul class="rmm-menu" style="display:none;">
            <li><a href="/">{{_('首页')}}</a></li>
            <li><a href="/property_list">{{_('海外房产')}}</a></li>
            <!-- @if ENV!='production' -->
            <li><a href="/crowdfunding-introduce">{{_('海外众筹')}}</a></li>
            <!-- @endif -->
            <!-- @if ENV!='production' -->
            <li><a href="/property_to_rent_list">{{_('海外租房')}}</a></li>
            <!-- @endif -->
            <li><a href="/news_list">{{_('投资资讯')}}</a></li>
        </ul>
        <ul class="rmm-center-menu" style="display:none;">
            %for index, intention in enumerate(intention_list):
                <li><a data-slug={{intention.get('slug')}} href="#" onclick=javascript:window.updatePage("{{intention.get('slug')}}")>{{intention.get('value')}}</a></li>
            %end
        </ul>
    </div>
</div>

<!--@@close-->


<!--@@block = main-->
<textarea  id="dataIntentionList" style="display:none">{{json_dumps(intention_list)}}</textarea>
<div class="category_wrapper">
    <div class="category">
        <span>{{_('投资意向：')}} </span>
        <select class="ghostSelect" name="intentionSelect">
            %for index, intention in enumerate(intention_list):
                %if intention.get('slug') == current_intention.get('slug'):
                    <option value="{{intention.get('slug')}}" selected="selected">{{intention.get('value')}}</option>
                % else :
                    <option value="{{intention.get('slug')}}">{{intention.get('value')}}</option>
                % end
            %end
        </select>
    </div>
</div>
<div class="mainContainer">
    <p class="description">
        {{current_intention.get('description')}}
    </p>

    <button class="textButton view_guide">
        <label for="">{{_('查看购房相关流程')}}</label>
        <img alt="" src="/static/images/property_list/tags-indicator-phone.png"/>
    </button>
    <div class="guide">
        <!-- @@include=./partials/intention_processCards.html -->
    </div>
    <a class="button red view_property" href="{{'/property_list?intention=' + current_intention.get('slug')}}">
        <img alt="" src="{{'/static/images/intention/icon/' + current_intention.get('slug') + '-grey.png'}}" height="14"/>
        <label for="">{{_('查看平台上的')}}{{current_intention.get('value')}}</label>
    </a>

</div>
<!--@@close-->

<!--@@block = scripts -->

<script>
 window.getTitle = function (slug) {
     var array = JSON.parse($('#dataIntentionList').text())
     var ret = ''
     _.each(array, function (item) {
         if (item.slug === slug) {
             ret = item.value;
         }
     })
     return ret
 }

 window.getId = function (slug) {
     var array = JSON.parse($('#dataIntentionList').text())
     var ret = ''
     _.each(array, function (item) {
         if (item.slug === slug) {
             ret = item.id;
         }
     })
     return ret
 }

 window.loadIntentionDescription = function (callback) {
     $.betterGet('/api/1/enum?type=intention', {})
                     .done(function (data) {
                         window.intentionDescription = data
                         callback()
                     })
                     .fail(function (ret) {
                     })
                     .always(function () {

                     })
 }

 window.updateIntentionDescription = function(slug) {
     var callback = function () {
         var description = ''
         _.each(window.intentionDescription, function (oneDes) {
             if (oneDes.slug === slug) {
                 description = oneDes.description
             }
         })
         if (!description) {description = ''}
         $('p.description').text(description)
     }

     if (window.intentionDescription) {
         callback()
     }
     else {
         loadIntentionDescription(callback)
     }
 }

 window.showGuide = function (slug) {
     $('html, body').animate({scrollTop: $('.view_guide').offset().top + 30 }, 'fast')
 }

 window.updatePage = function (slug) {
     $('.rmm-toggled .rmm-toggled-controls .rmm-center #howItWorks_title').click()
     $('#howItWorks_title').text(window.getTitle(slug))

     $(document).prop('title', window.getTitle(slug))

     $('.view_property label').text(window.i18n('查看平台上的') + window.getTitle(slug))
     $('.view_property img').attr('src', '/static/images/intention/icon/' + slug + '-grey.png')
     //$('.view_property img').attr('height', '14')
     $('.view_property').attr('href', '/property_list?intention=' + window.getId(slug))
     $('.view_guide').attr('onclick', 'window.showGuide(\'' + slug + '\')')
     window.updateIntentionDescription(slug)
     $('.guide').children().hide()
     $('div[data-tab-name=' + slug + ']').show()
 }

 var $intentionSelect = $('select[name=intentionSelect]')
 $intentionSelect.change(function (event) {
     window.updatePage(this.value)
 })

 %if intention_list:
 var slugFromURL = window.team.getQuery('slug', location.href)
 if (slugFromURL) {
     window.updatePage(slugFromURL)
 }
 else {
     window.updatePage("{{intention_list[0].get('slug')}}")
 }
 %end
</script>


<!--@@close -->
