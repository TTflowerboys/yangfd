<!--@@master = ./masters/master.html-->
<!--@@block = head-->
<!--build:css(dist) /static/styles/requirement-rent-phone.html.css-->
<link rel="stylesheet" href="/static/styles/requirementRentPage.css"/>
<!--endbuild-->

<!--@@close-->

<!--@@block = main-->
<!-- @@include = ./static/templates/featured_facility_search_box.tpl.html-->
<!-- ko with: requirementRentViewModel -->
<!-- @@include= ./partials/requirement_rent_phone.html-->
<!-- /ko-->
<!--@@close-->

<!--@@block = scripts -->
<script type="text/javascript" src="/static/bower_components/knockout/dist/knockout.js"></script>
<script src="/static/scripts/common_ko.js"></script>
<script src="/static/scripts/featured_facility_ko.js"></script>
<script src="/static/scripts/requirement_rent_popup.js"></script>

<script>
function getOptionFromQurey(str) {
    if(!str) {
        return
    }
    var arr = str.slice(1).split('&')
    var option = {}
    _.each(arr, function (val) {
        option[val.split('=')[0]] = val.split('=')[1]
    })
    return option
}
 if (window.team.isPhone()) {
     var requirementRentContainer = $('main')
     var option = getOptionFromQurey(location.search)
     window.resetRequirementRentForm(requirementRentContainer, option)
     var oldUser = window.user
     window.setupRequirementRentForm(requirementRentContainer, option, function () {
        //here submit rent intention ticket has created a new user
         if (!oldUser) {
             $.betterGet('/api/1/user', {})
                  .done(function (data) {
                      window.user = data
                      if (window.bridge !== undefined) {
                    	  window.bridge.callHandler('updateUser', data, function () {});
                      }
                  })
                  .fail(function (ret) {
                  })
                  .always(function () {

                  })
         }
     })
 } else {
     window.location.href = '/?rent_intention_ticket=true'
 }


</script>


<!--@@close -->
