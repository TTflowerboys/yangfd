<!--@@master=masters/master.html -->
<!--@@block=head -->
<!--build:css(dist) /static/styles/news.html.css-->
<link rel="stylesheet" href="/static/styles/news.css"/>
<!--endbuild-->

<!--@@close-->

<!--@@block=main -->
%if news:
    <textarea id="newsData" style="display:none;">{{json_dumps(news)}}</textarea>
    <div class="container">
        % from urllib import quote_plus
        
        %if 'title' in news:
            <h1 class="title">{{news.get('title')}}</h1>
        %end

        <div class="button-group">
            %if 'time' in news:
                <label class="date" for=""> <i class="hint">{{news.get('time').strftime('%Y-%m-%d')}}</i></label>
            %end

            %for cate in news.get('category',{}):
            %if cate.get('slug') == 'announcement':
                <label class="category" for=""> | <a href="/notice_list">{{cate.get('value','')}}</a></label></label>
            %elif cate.get('slug') == 'legal_resource':
                <label class="category" for=""> | <a href="/laws">{{cate.get('value','')}}</a></label></label>
            %elif cate.get('slug') == 'purchase_process':
                <label class="category" for=""> | <a href="/guides">{{cate.get('value','')}}</a></label></label>
            %else :
                <label class="category" for=""> | <a href="/news_list">{{_('房产资讯')}}</a></label></label>
            %end

            %if 'link' in news :
                <label class="source" for=""> <i class="hint">{{_('来源：')}}</i>
                    <a href={{news.get('link')}}>{{_('原文地址')}}</a></label>
            %end

            <div class="share">
                <a data-fn="shareToWeChat" class="shareButton">
                    <img class="wechat" src="/static/images/news/share/wechat.png" height=20 alt=""/>
                </a>
                <a data-fn="shareToWeibo" class="shareButton">
                    <img src="/static/images/news/share/weibo.png" height=20 alt=""/>
                </a>
            </div>
        </div>
        <div class="content">
            % from urllib import quote_plus
            %if ('images' in news) and news.get('images'):
                <img alt="{{news.get('title',_('洋房东'))}}" src="/image/fetch?link={{ quote_plus(news.get('images')[0].encode('utf-8'))}}&news_id={{news.get('id','')}}"/>
            %end
            %if 'content' in news:
                <div class="fullText">
                    {{!news.get('content')}}
                </div>
            %end
        </div>

        %if ('related_news_list' in vars() and related_news_list):
            <div class="relatedNews">
                <h2 class="title">
                    {{_('相关新闻')}}
                </h2>
                <ul>
                     % for news_item in related_news_list:
                         <li class="newsItem">
                             <a href="/news/{{news_item.get('id')}}">
                                 %if (news_item.get('images')):
                                     <img src="/image/fetch?link={{quote_plus(news_item.get('images')[0].encode('utf-8')) + '_thumbnail'}}&news_id={{news_item.get('id','')}}" onerror="window.onImgError(this);"/>
                                 %end
                                 <div class="img_shadow"></div>
                                 <h3 class="title">
                                         {{news_item.get('title')}}
                                 </h3>
                             </a>
                         </li>
                     % end
                 </ul>
            </div>
        %end
    </div>
%end

<div id="popupShareToWeChat" style="display:none; text-align:center;font-size: 12px;">
    <img src="" alt="二维码" width="220" height="220"/>
    <p>{{_('打开微信，使用 “扫一扫” 即可将网页分享到朋友圈')}}</p>
</div>

<!--@@close-->

<!--@@block=scripts -->

<script>
 $('[data-fn=shareToWeChat]').on('click', function () {
     $('#popupShareToWeChat')
            .find('img').prop('src', '/qrcode/generate?content=' + encodeURIComponent(location.href)).end()
            .modal()
     ga('send', 'event', 'news', 'share', 'open-wechat')
 })

 $('[data-fn=shareToWeibo]').on('click', function () {
     var news = JSON.parse($('#newsData').text())
     var params = {'title': news.title, 'url': location.href}
     if (news.images && news.images.length > 0) {
         params.pic = news.images[0]
     }
     team.shareToWeibo(params)
     ga('send', 'event', 'news', 'share', 'open-weibo')
 })
</script>

<!--@@close-->

