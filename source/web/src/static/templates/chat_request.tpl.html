<!--@@include chose_referrer.tpl.html  -->
<!--@@include featured_facility_search_box.tpl.html-->
<script type="text/template" id='chat-request-tpl'>
    <div id="chat_request_popup" class="requirement_popup rentRequestContainer"  data-bind="css: 'inStep' + step(), visible: formWrapVisible">
        <div class="requirement_popup_shadow" data-bind="click: close"></div>
        <div class="requirement_wrapper">
            <div class="chatWrap clearfix">
                <div class="chatUserInfo">
                    <div class="userHeader">
                        <span class="userHeader_pic"><img src="/static/images/chat/hostHeader.jpg" alt=""></span>
                        <div class="userHeader_type" data-bind="text: rentusertype"></div>
                        <div class="userHeader_name" data-bind="text: rentnickname"></div>
                    </div>
                    <div class="chatDetails">
                        <div class="chatRentMeta">
                            <h1 class="title" data-bind="text: renttitle"></h1>
                            <div class="meta">
                                <i class="icon-location_fill"></i>
                                <span data-bind="text: rentmeta"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chatCenter">
                    <div class="box_hd">
                        <div class="step1" data-bind="visible: step() === 1">
                            <div class="fl">                            
                                <div class="chatMeta">
                                    <div class="chatTimer">
                                        <div class="date inputWrapper" data-bind="dateRangePicker: {value: rentAvailableTimeFormated, timeEnabled: true}">
                                            <input data-bind="value: rentAvailableTimeFormated" type="text" class="" placeholder="{{_('选择起租日期')}}" autocomplete="off"/>
                                        </div>
                                        <i class="icon-nav-arrow-right"></i>
                                        <div class="date inputWrapper" data-bind="dateRangePicker: {value: rentDeadlineTimeFormated, timeEnabled: true}">
                                            <input data-bind="value: rentDeadlineTimeFormated" type="text" class="" placeholder="{{_('选择结束日期')}}" autocomplete="off"/>
                                        </div>                                    
                                    </div>
                                    <div class="chatUserType">
                                        % if _.lang == "en_GB":
                                        <select data-bind="chosen: tenantCountList,
                                                optionsText: function(item){return item},
                                                value: tenantCount
                                                "></select>
                                        %else:
                                        <select data-bind="chosen: tenantCountList,
                                                optionsText: function(item){return item + window.i18n('人入住')},
                                                value: tenantCount
                                                "></select>
                                        %end
                                    </div>
                                </div>
                                <div class="content">
                                    <textarea class="edit_area" style="height: 5em;" rows="3" data-bind="value: description" placeholder="{{_('请填写您入住的原因和对房东的问题，比如: 我是来自中国北京的李雷，来London的ISE读Master。')}}"></textarea>
                                    <div class="toolbar"><a href="javascript:;"><i class="icon-art"></i></a></div>
                                </div>
                            </div>
                            <div class="fr">
                                <img src="/static/images/chat/hostHeader.jpg" alt="" class="avatar">
                            </div>
                        </div>

                        <div class="step2" data-bind="visible: step() === 2">
                            <div class="row">
                                <p class="title">{{_('姓名')}}</p>
                                <input class="name" type="text" data-bind="value: nickname"/><!--
                                --><select class="gender" data-bind="chosen: genderList,
                                    optionsText: 'text',
                                    optionsValue: 'value',
                                    value: gender,
                                    optionsCaption: '{{_('性别')}}'"></select><!--
                                --><select class="occupation" data-bind="chosen: occupationList,
                                    optionsText: 'value',
                                    optionsValue: 'id',
                                    value: occupation,
                                    optionsCaption: '{{_('职业')}}'"></select>
                                    <featured-facility-search-box params="parentVM: $data, featuredFacilityType: 'hesa_university', placeholder: '{{_('请输入大学名称')}}'" data-bind="visible: getOccupationSlug(occupation()) === 'student'"></featured-facility-search-box>                                
                            </div>
                            <div class="row">
                                <p class="title">{{_('生日')}}</p>
                                % if _.lang != "en_GB":
                                <select class="birthYear" data-bind="chosen: birthYearList,
                                    optionsText: function(item){return item + window.i18n('年')},
                                    value: birthYear"></select><!--
                                --><select class="birthMonth" data-bind="chosen: birthMonthList,
                                    optionsText: function(item){return item + window.i18n('月')},
                                    value: birthMonth"></select><!--
                                --><select class="birthDate" data-bind="chosen: birthDateList,
                                    optionsText: function(item){return item + window.i18n('日')},
                                    value: birthDate"></select>
                                % else:
                                    <select class="birthYear" data-bind="chosen: birthYearList,
                                    optionsText: function(item){return item},
                                    value: birthYear"></select><!--
                                --><select class="birthMonth" data-bind="chosen: birthMonthList,
                                    optionsText: function(item){return item},
                                    value: birthMonth"></select><!--
                                --><select class="birthDate" data-bind="chosen: birthDateList,
                                    optionsText: function(item){return item},
                                    value: birthDate"></select>
                                % end
                                <p class="hint">{{_('仅用作向房东展示年龄，不向任何人泄露生日信息')}}</p>
                            </div>
                            <chosen-referrer params="vm: $data"></chosen-referrer>
                            <div class="row">
                                <p class="title">{{_('联系方式')}}</p>
                                <textarea id="countryData" style="display: none;">
                                    {{json_dumps(country_list)}}
                                </textarea>
                                <select class="countryCode" data-bind="chosen: countryCodeList,
                                    optionsText: function(item){return item.name + '(+' + item.countryCode + ')'},
                                    value: country,
                                    css: {readonly: !!user()}"></select><!--
                                --><input class="phone" type="text" data-bind="value: phone, attr: {readonly: !!user()}" placeholder="{{_('电话')}}"><!--
                                --><input class="email" type="text" data-bind="value: email, attr: {readonly: !!user()}" placeholder="{{_('邮箱')}}"/>
                            </div>
                            <div class="row" data-bind="visible: !user()">
                                <p class="title">{{_('推荐码（选填）')}}</p>
                                <input class="referral" type="text" data-bind="value: referral" placeholder=""/>
                            </div>
                            <div class="row" data-bind="visible: !user()">
                                <p class="title"></p>
                                <div id="captcha_div" class="captchaCode"></div><!--
                                --><button class="registerUser button red ajaxButton" data-bind="click: registerUser, disable: registerUserDisabled">{{_('注册')}}</button>
                            </div>
                            <div class="row" data-bind="visible: !phoneVerified() && user() && useSmsVerification()">
                                <p class="title"></p>
                                <input type="text" class="smsCode" data-bind="value: smsCode" placeholder="{{_('短信验证码')}}"/><!--
                                --><button class="getSmsCode button red ajaxButton" data-bind="click: getSmsCode, text: getSmsCodeText, disable: getSmsCodeDisabled"></button>
                                <p class="tryVoiceVerification" data-bind="visible: verificationCount() > 1">
                                    {{_('还未没有收到短信，试试')}} <a id="tryVoiceVerificationButton" style="color:red;font-weight: bold;" data-bind="click: tryVoiceVerification">{{_('语音验证')}}</a>
                                </p>
                            </div>
                            <div class="row" data-bind="visible: !phoneVerified() && user()  && !useSmsVerification()">
                                <p class="voiceHint" id="voiceHint" data-bind="html: voiceHint"></p>
                                <button class="getSmsCode button red ajaxButton" data-bind="click: voiceVerifyButtonAction, text: voiceVerifyButtonText, disable: voiceVerifyButtonDisabled"></button>
                            </div>
                
                        </div>
                        <div class="step1" data-bind="visible: step() === 1">
                            <div class="action">
                                <a href="javascript:;" class="btn btn_book">Ask to book</a>
                                <button class="btn btn_send ajaxButton" data-bind="click: !user() ? goNext : submit">send</button>
                            </div>
                        </div>
                        <div class="step2" data-bind="visible: step() === 2">
                            <div class="action">
                                <button class="actionButton ghostButton btn_book" data-bind="click: goPrev">{{_('上一步')}}</button>
                                <button class="actionButton btn btn_send ajaxButton" data-bind="click: submit, disable: !user() ? true : submitDisabled()">{{_('提交')}}</button>
                            </div>                            
                        </div>                       
                        
                    </div>
                </div>
            </div>
            <button name="cancel" class="cancel" data-bind="click: close"><i class="icon-delete"></i></button>
        </div>
    </div>
</script>
