<!doctype html>
<html>
    <head>
        <!-- @@include = partials/meta.html -->

        <!-- @@include =partials/css_import.html -->

        <link rel="stylesheet" href="/static/styles/comingSoon.css"/>

        <!--[if lte IE 8]>
        <script src="/static/vendors/html5shiv.min.js"></script>
        <![endif]-->

        <link rel="icon" href="/static/images/icon/favicon.ico" type="image/x-icon" />
        <link rel="shortcut icon" href="/static/images/icon/favicon.ico" type="image/x-icon" />
        <title>{{_('洋房东')}}</title>

    </head>
    <body>
        <div id="data_localization" style="display:none">
          <span id="notEmpty">{{_('不为空')}}</span>
          <span id="badNumber">{{_('格式不正确')}}</span>
          <span id="badEmail">{{_('格式不合法')}}</span>
          <span id="Email">{{_('邮箱')}}</span>
          <span id="subscriptionFailure">{{_('订阅失败')}}</span>
          <span id="submitRequirementFailure">{{_('提交需求失败')}}</span>
        </div>
      
        <div class="opening">
            <div class="opening_inner">
                <img class="logo" src="/static/images/logo-yfd.png" alt=""/>
                <h1 class="hint">{{_('金秋十月，即将开放！')}}</h1>
                <form name="subscription" class="subscription">
                    <input class="email" name="email" type="text" placeholder="{{_('请填写邮箱订阅网站上线通知')}}" data-validator="required, trim email"/>
                    <button type="submit" class="button red">{{_('订阅')}}</button>
                    <p class="errorMessage"></p>
                </form>
                <h2 class="successMessage">{{_('谢谢你的订阅!')}} <br>{{_('在网站开放后，我们将第一时间告知您！')}}</h2>
                <img class="wechat" src="/static/images/media/wechat.png" alt=""/>
            </div>
        </div>
        <div class="whatWeDo_wrapper">
            <div class="whatWeDo">
                <h2 class="title">{{_("我们做什么？")}}</h2>
                <p class="description">{{_("我们专注于为投资人提供多样化的海外投资置业机会，以丰富的投资分析报告和专业的置业顾问助推您的海外投资之路。")}}<br>
                    <br>
                    {{_("洋房东将首先在中国和英国上线，为您提供英国的楼盘、公寓、别墅、学区房等多样化的海外置业机会，同时可以根据您的投资意向和预算为您推荐最合适的投资机会，辅以详细的房产信息和街区投资分析报告帮助您决策，当您确定投资意向时，联系平台的职业顾问，协助您完成投资流程，轻松当洋房东。")}}
                </p>
            </div>
        </div>
        <div class="requirement">
            <div class="requirement_title">
                <H2 class="title">{{_('提交置业需求')}}</h2>
                <h3 class="subtitle">{{_('如果您有购买房子的意向，请告诉我们，我们将收集相应的资源并且及时反馈给您')}}
                </h3>
            </div>
            <form class="requirement_form"  name="requirement">
                <div class="form_row">
                    <input class="name ghostInput" name="nickname" type="text" placeholder="{{_('姓名')}}" data-validator="required, trim"/>
                </div>
                <div class="form_row">
                    <select name="country" class="coutry ghostSelect" style="color:#4d4d4d;">
                        <option value="CN">{{_('中国 +86')}}</option>
                        <option value="HK">{{_('香港 +85')}}</option>
                        <option value="UK">{{_('英国 +44')}}</option>
                        <option value="US">{{_('美国 +1')}}</option>
                    </select>
                    <span class=vr></span>
                    <input class="phone ghostInput" name="phone" type="text" placeholder="{{_('电话')}}"  data-validator="required, trim number"/>
                </div>
                <div class="form_row">
                    <input class="email ghostInput" name="email" type="text" placeholder="{{_('邮箱')}}"  data-validator="required, trim email"/>
                </div>
                <div class="form_row">
                    <p class="budgetHint">{{_('您的预算')}}</p>
                </div>
                <div class="form_row">
                    <select class="budget ghostSelect" name="budget" style="color:#4d4d4d;">
                    </select>
                </div>
                <div class="form_row">
                    <textarea class="detail ghostTextArea" name="description" placeholder="{{_('写下您的其他需求和描述，方便我们在挑选房源时作为参考')}}"></textarea>
                </div>
                <div class="form_row">
                    <button type="submit" class="button red">{{_('提交')}}</button>
                </div>
                <p class="errorMessage"></p>
            </form>
            <h2 class="successMessage">{{_('置业需求已提交，稍后我们的工作人员会联系你')}}</h2>
        </div>

        <div id="copyright" class="copyright_wrapper">
                <div class="copyright">
                    <p>&copy;<script>document.write(new Date().getFullYear())</script>
                        {{_('洋房东')}}
                    </p>
                    <ul class="navbar">
                         <li>
                            <select name="language" class="ghostSelect" style="min-width: 140px;">
                                <option value="zh_Hans_CN" selected>中文（中国）</option>
                                <option value="en_GB">English, UK</option>
                            </select>
                            <span id="current_Language" style="display:block">{{_.lang}}</span>       
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- @@include =partials/js_import.html -->
        <script>
            $(window).on('resize', function () {
                $('#main').css({minHeight: $(window).height() - $('#copyright').height()})
            })
            $(function () {
                $('#main').css({minHeight: $(window).height() - $('#copyright').height()})
                
                //setup language select
                var language = $('#current_Language').text()
                $('select[name=language]').find('option[value='+language+']').prop('selected',true)
                $.get("/api/1/enum?type=budget&_i18n=" + language,
                        null,
                        function (data, status) {
                            if (data.ret != 0) {
                            }
                            else {
                                var budgetSelect = $('select[name=budget]')
                                for (var i= 0, len = data.val.length; i < len; i++)
                                {
                                    budgetSelect.append('<option value='+ data.val[i]["id"] +'>'+ data.val[i]["value"] +'</option>')
                                }
                            }
                        }
            )
            })
            
            $('select[name=language]').change(function(){
                var language=$(this).children('option:selected').val();
                team.setLocationHrefParam("_i18n", language)
            })
        </script>        
        <script>
          var localization = $('#data_localization')
          
            function errorMessageFormValidatorType(validator) {
                if (validator == "required") {
                    return localization.find('#notEmpty').text()
                }
                else if (validator == "number")
                {
                    return localization.find('#badNumber').text()
                }
                else if (validator == "email")
                {
                    return localization.find('#badEmail').text()
                }
            }

            $('form[name=subscription]').submit(function (e) {
                e.preventDefault()
                var errorArea =  $(this).find(".errorMessage")
                errorArea.hide()
                var successArea = $('.opening .successMessage')

                var valid = $.validate(this, {onError: function (dom,validator,index) {
                    errorArea.text(localization.find('#Email').text() + " " + errorMessageFormValidatorType(validator))
                    errorArea.show()
                }})
                if(!valid){return}
                var params = $(this).serializeObject()
                $.post("/api/1/subscription/add",
                        params,
                        function (data, status) {
                            if (data.ret != 0) {
                                errorArea.text(localization.find('#subscriptionFailure').text())
                                errorArea.show()
                            }
                            else {
                              successArea.show()
                                $('form[name=subscription]').hide()
                            }
                        });
            })

          $('form[name=requirement] input[name=phone]').on('change',function(){
              var params =  $('form[name=requirement]').serializeObject()
              var theParams = {}
              theParams["country"] = params["country"]
              theParams["phone"] = params["phone"]
              var errorArea= $('form[name=requirement]').find(".errorMessage")
              errorArea.hide()
              $.post("/api/1/user/phone_test",
                      theParams,
                      function (data, status) {
                          if (data.ret != 0) {
                              var dom = $('form[name=requirement] input[name=phone]')[0]
                              errorArea.text(dom.placeholder + " "  + localization.find('#badNumber').text())
                              errorArea.show()
                              $(dom).css('border', '2px solid red')
                          }
                      });
          })

            $('form[name=requirement]').submit(function (e) {
                e.preventDefault()
                var errorArea= $(this).find(".errorMessage")
                errorArea.hide()
                var successArea = $('.requirement .successMessage')
               $('form[name=requirement] input, form[name=requirement] textarea').each(
                 function(index){  
                   $(this).css('border', '2px solid #ccc')
                 }
               )
                 
                var valid = $.validate(this, {onError: function (dom,validator,index) {
                    errorArea.text(dom.placeholder + " " + errorMessageFormValidatorType(validator))
                    errorArea.show()
                    $(dom).css('border', '2px solid red')
                }})
                if(!valid){return}
                var params = $(this).serializeObject()

                var language = $('#current_Language').text()
                params["locales"] = language
                $.post("/api/1/intention_ticket/add",
                        params,
                        function (data, status) {
                            if (data.ret != 0) {
                                errorArea.text(localization.find('#submitRequirementFailure').text())
                                errorArea.show()
                            }
                            else {
                                successArea.show()
                                $('.requirement_title').hide()
                                $('.requirement_form').hide()
                            }
                        });
            })

        </script>

    </body>
</html>

