<!--@@master = masters/wechat_poster_master.html-->

<!--@@block =head -->
<!--build:css(dist) /static/styles/wechat_poster.html.css-->
<link rel="stylesheet" href="/static/styles/phone/wechatPoster.css">
<!--endbuild-->
<!--@@close-->

<!--@@block =main -->
<script type="text/javascript">
    window.viewStartTime = new Date()
    window.durationArray = []
    window.isInit = false
    var process = new Process({
        canvasId: 'procanvas',
        textId: 'proText',
        outerWidth: '100',
        innerWidth: '94',
        backColor: 'rgba(51,51,51,1)',
        underColor: '#3f3f3f',
        activeColor: '#aec227'
    })
    process.moveTo(75, 10000, function(){
        process.moveTo(90, 5000, function(){
            process.moveTo(95, 5000, function() {
                $(window).trigger('ownLoadEvent')
            })
        })
    })
</script>
<div class="swiper-container mainSwiper" style="">
    <div class="swiper-wrapper" style="">
        <div class="swiper-slide swiper-slide-bg commen" style="">
            <div class="page pageCover">
                <div class="topTitleNav animate">
                    <p class="location animate">{{get_country_name_by_code(rent['property'].get('country',{}).get('code',''))}}, {{rent['property'].get('city',{}).get('name','')}}, {{rent['property'].get('street','')}}</p>
                    <p class="title animate fixFontSize" data-maxHeight="8vh">{{rent.get('title','')}}</p>
                    % if not rent.get('status')=='rent':
                    <p class="titleEn animate">Letting!</p>
                    % elif rent.get('status') == 'rent':
                    <p class="rentOut animate">{{_('抱歉，房屋已租出')}}</p>
                    % end
                </div>
            </div>
            <div class="bottomBox animate">
                <div class="scrollUp">{{_('继续')}}</div>
            </div>


        </div>
        <div class="swiper-slide swiper-slide-bg commen" style="">
            <div class="page pageRental">
                <p class="line1 animate">{{_('仅需')}}</p>
                <p class="line2 animate">
                    % if 'price' in rent and rent.get('price'):
                    <span class="price_original">
                        {{rent.get('price',{}).get('unit_symbol','')}}
                        <span data-type="formatted_currency">{{f_app.re.filter_zero(rent.get('price',{}).get('value',''))}}</span>
                        {{_('/周')}}
                        % if 'bill_covered' in rent and rent.get('bill_covered'):
                        <span class="sub">
                            {{_(', 包Bill')}}
                        </span>
                        % end
                    </span>
                    % end
                    % if 'localized_unit_symbol' in rent.get('price',{}) and rent.get('price',{}).get('localized_unit_symbol','') != rent.get('price',{}).get('unit_symbol',''):
                    <span class="price_reference">
                        {{_('约')}}
                        {{rent.get('price',{}).get('localized_unit_symbol','')}}
                        {{int(float(rent.get('price',{}).get('localized_value','')))}}
                        {{_('/周')}}
                    </span>
                    % end
                </p>
                <p class="line3 animate">{{_('您就可以租到')}}</p>
                <ul class="itemBox clearfix">
                    %if rent.get('space',{}).get('value'):
                    <li class="animate size">
                        <div>
                            <i class="icon-size"></i>
                            %if float(rent.get('space',{}).get('value',0)) < 1000:
                            {{"{0:.2f}".format(float(rent.get('space',{}).get('value',0)))}}
                            %else:
                            {{"{0:.0f}".format(float(rent.get('space',{}).get('value',0)))}}
                            %end
                            {{!format_unit(rent.get('space',{}).get('unit',''))}}
                        </div>
                    </li>
                    %end
                    <li class="animate rooms"
                        %if not rent.get('space',{}).get('value'):
                    style="width:100%;"
                    %end
                    >
                    <div>
                        <i class="icon-rooms"></i>
                        % if 'bedroom_count' in rent['property'] and rent['property'].get('bedroom_count') == 0 :
                        <span>studio</span>
                        %else:
                        {{rent['property'].get('bedroom_count',0)}}<span>{{_('室')}}</span>{{rent['property'].get('living_room_count',0)}}<span>{{_('厅')}}</span>{{rent['property'].get('bathroom_count',0)}}<span>{{_('卫')}}
                        %end
                    </span>
                    </div>
                    </li>
                    <li class="animate rental"><div><i class="icon-house"></i>{{rent.get('rent_type',{}).get('value', '')}}</div></li>
                    <li class="animate street"><div><i class="icon-block_line"></i>{{rent['property'].get('zipcode','')}}</div></li>
                    <!--<li class="animate estate"
                        %if not rent['property'].get('floor',''):
                    style="width:100%;"
                    %end
                    >
                    <div><i class="icon-building"></i>
                        %if rent['property'].get('community',''):
                        {{rent['property'].get('community','')}},
                        %end
                        %if rent['property'].get('street',''):
                        {{rent['property'].get('street','')}},
                        %end
                        {{rent['property'].get('city',{}).get('name','')}}
                    </div>
                    </li>-->
                    <li class="animate deposit"
                        % if not ('floor' in rent['property'] and rent['property'].get('floor','')):
                        style="width:100%;"
                        %end
                        >
                        <div>
                            <i class="icon-coin_line"></i>
                            {{_('押金:')}}{{rent.get('deposit',{}).get('unit_symbol','')}}
                            <span data-type="formatted_currency">{{f_app.re.filter_zero(rent.get('deposit',{}).get('value',_(u'面议')))}}</span>
                        </div>
                    </li>
                    % if 'floor' in rent['property'] and rent['property'].get('floor',''):
                    <li class="animate door">
                        <div>
                            <i class="icon-door"></i>
                            {{rent['property'].get('floor','')}}
                            % if 'house_name' in rent.get('property',{}) and 'floor' in rent.get('property',{}):
                            {{'-'}}
                            % end
                            {{rent['property'].get('house_name','')}}
                        </div>
                    </li>
                    % end
                    % if 'rent_available_time' in rent and rent.get('rent_available_time',''):
                    <li class="animate time">
                        <div>
                            <i class="icon-clock"></i>
                            % if 'rent_available_time' in rent and rent.get('rent_available_time',''):
                            % string1 = """<span data-utc-time='""" + str(rent.get('rent_available_time','')) + """'></span>"""
                            % end
                            % if 'rent_deadline_time' in rent and rent.get('rent_deadline_time',''):
                            % string2 = string1 + """ <span data-utc-time='""" + str(rent.get('rent_deadline_time')) + """'> """
                            {{!_('%s至 ') %string2}}</span>
                            % else :
                            {{!_('%s起 ') %string1}}
                            % end
                        </div>
                    </li>
                    % end
                    % if 'minimum_rent_period' in rent:
                    <li class="animate time">
                        <div>
                            <i class="icon-clock"></i>
                            {{_('最短租期')}}
                            <!--@@include=partials/get_rent_min_period.html  -->
                        </div>
                    </li>
                    % end
                </ul>
            </div>
            <div class="bottomBox animate">
                <div class="scrollUp">{{_('继续')}}</div>
            </div>
        </div>
        <div class="swiper-slide swiper-slide-bg commen
                % if 'description' in rent and rent.get('description') or len(rent['property'].get('indoor_facility',[]))>0 or len(rent['property'].get('community_facility',[]))>0:
                show
                % else:
                hideInWechat
                % end
                " style="">
            <div class="page pageDescription">
                %if 'description' in rent and rent.get('description'):
                <h2 class="animate">&nbsp;</h2>
                <p class="description animate">
                    {{rent.get('description','')}}
                </p>
                %else:
                <h2 class="animate hideInWechat">&nbsp;</h2>
                <p class="description animate hideInWechat">
                    {{_('统计表明填写更多房产的描述和配套设施能缩短出租用时')}}
                </p>
                %end
                %if 'description' in rent and rent.get('description'):
                <a class="btn btnModal animate viewMoreBtn" id="viewMoreBtn">{{_('查看更多')}}</a>
                % end
                <!--% if 'indoor_facility' in rent['property'] or 'community_facility' in rent['property']:-->
                <ul class="facilities clearfix">
                    % for item in rent['property'].get('indoor_facility',[]):
                    <li class="animate"><i class="icon-{{item.get('slug','')}}"></i><span>{{item.get('value','')}}</span></li>
                    % end
                    % for item in rent['property'].get('community_facility',[]):
                    <li class="animate"><i class="icon-{{item.get('slug','')}}"></i><span>{{item.get('value','')}}</span></li>
                    %end
                </ul>
                <!-- 只有上面的设施条数大于6时展示，js控制-->
                <a class="btn btnModal animate morefacilitiesBtn" id="morefacilitiesBtn">{{_('更多设施')}}</a>
                <!--% end-->

            </div>
            <div class="bottomBox animate">
                <div class="scrollUp">{{_('继续')}}</div>
            </div>
        </div>
        <div class="swiper-slide swiper-slide-bg commen" style="">
            <div class="page pageMap needblurWhenModalShow">
                <!--<img id="mapImage" src="" alt=""/>-->
                <div class="mapImage" id="mapImage">
                    <div class="pushpin animate needHideWhenModalShow"></div>
                </div>
            </div>
            <div class="bottomBox mapBottom animate needHideWhenModalShow
            % if rent['property'].get('featured_facility'):
                % if len(rent['property'].get('featured_facility')) > 3:
                large
                % else:
                medium
                % end
            % end
            ">
                <div class="location">
                    <p>
                        <i class="icon-location"></i>
                        <span>
                            {{rent['property'].get('floor','')}}
                            % if rent.get('property',{}).get('house_name') and rent.get('property',{}).get('floor'):
                            -
                            % end
                            {{rent['property'].get('house_name','')}}
                            % if rent.get('property',{}).get('house_name') or rent.get('property',{}).get('floor'):
                            ,
                            %end
                            % if rent['property'].get('community',''):
                            {{rent['property'].get('community','')}},
                            % end
                            % if rent['property'].get('street',''):
                            {{rent['property'].get('street','')}},
                            % end
                            {{rent['property'].get('city',{}).get('name','')}},
                            {{get_country_name_by_code(rent['property'].get('country',{}).get('code',''))}},
                            {{rent['property'].get('zipcode','')}}
                        </span>
                    </p>
                </div>
                % if rent['property'].get('featured_facility'):
                <div class="surrouding">
                    <ul class="content clearfix">
                        % for item in rent['property'].get('featured_facility')[:3] :
                        <li>
                            <p class="title">{{item.get(item.get('type',{}).get('slug'),{}).get('name','')}}</p>
                            <p class="facilityType">{{item.get('type',{}).get('value')}}</p>
                            % matches = [time_item for time_item in item.get('traffic_time') if time_item.get('default') == True]
                            % if len(matches) == 0:
                            % time_item = item.get('traffic_time')[0]
                            % else:
                            % time_item = matches[0]
                            % end
                            <p class="time">
                                <i class="{{time_item.get('type',{}).get('iconfont')}}"></i>
                                %if time_item.get('time',{}).get('unit') == 'minute':
                                <span>{{time_item.get('time',{}).get('value')}}min</span>
                                %elif time_item.get('time',{}).get('unit') == 'second':
                                <span>{{1 if int(float(time_item.get('time',{}).get('value'))/60) == 0 else int(float(time_item.get('time',{}).get('value'))/60)}}min</span>
                                %end
                            </p>
                        </li>
                        % end
                    </ul>
                    % if len(rent['property'].get('featured_facility')) > 3:
                    <a class="btn btnModal animate viewMoreBtn" id="moreFeaturedFacilitiesBtn">{{_('查看更多周边设施')}}</a>
                    % end
                </div>
                % end
                <div class="scrollUp">{{_('继续')}}</div>
            </div>
        </div>
        % if rent['property'].get('reality_images', []) and len(rent['property'].get('reality_images', [])):
        <div class="swiper-slide swiper-slide-bg commen" style="">
            <div class="page pagePhoto swiper-container">
                <ul class="swiper-wrapper photoList">
                    % for item in rent['property'].get('reality_images'):
                    <li class="swiper-slide" style="background-image: url('{{item}}')"></li>
                    %end

                </ul>
            </div>

            <div class="bottomBox photoBottom animate">
                <div class="photoThumbsBox">
                    <div class="photoThumbs swiper-container">
                        <ul class="swiper-wrapper thumbList">
                            % for item in rent['property'].get('reality_images'):
                            <li class="swiper-slide" style="background-image: url('{{item}}')"></li>
                            %end
                        </ul>
                    </div>
                    <div class="arrowButton prevButton" data-action="Prev"></div>
                    <div class="arrowButton nextButton" data-action="Next"></div>
                </div>

                <div class="scrollUp
                        % if not report:
                        hideOutsideWechat
                        %end
                        ">{{_('继续')}}</div>
            </div>
        </div>
        % else:
        <div class="swiper-slide swiper-slide-bg commen hideInWechat" style="">
            <div class="page pagePhoto">
                <p>{{_('暂无图片，上传您的房屋实景图片能极大增加租客联系您的几率')}}</p>
            </div>
            <div class="bottomBox animate">
                <div class="scrollUp">{{_('继续')}}</div>
            </div>
        </div>
        %end
        % if report:
        <div class="swiper-slide swiper-slide-bg commen " style="">
            <div class="page pageRegion">
                <h2 class="animate">{{_('街区报告：')}}<span>{{report.get('name','')}}</span></h2>
                <div class="description animate">
                    {{!report.get('description','')}}
                </div>
                <a class="btn siteLink animate" href="/region-report/{{report.get('id','')}}">{{_('查看更多')}}</a>
                <!--<p class="tag animate">-->
                <!-- todo -->
                <!--华人多, 学生多, 美食, 中国城-->
                <!--暂无内容-->
                <!--</p>-->
            </div>
            <div class="bottomBox animate hideOutsideWechat">
                <div class="scrollUp">{{_('继续')}}</div>
            </div>
        </div>
        % end
        <div class="swiper-slide swiper-slide-bg commen hideOutsideWechat" style="">
            <div class="page pageCoverBack">
                <div class="topTitleNav animate">
                    <p class="location animate">{{rent['property'].get('street','')}} {{rent['property'].get('city',{}).get('name','')}} {{get_country_name_by_code(rent['property'].get('country',{}).get('code',''))}}</p>
                    <p class="title animate fixFontSize" data-maxHeight="8vh">{{rent.get('title','')}}</p>

                    % if not rent.get('status')=='rent':
                    <p class="contact animate">
                        <a href="/host-contact-request/{{rent.get('id','')}}?requestContact=true" class="btn">{{_('我要咨询')}}</a>
                    </p>
                    % elif rent.get('status') == 'rent':
                    <p class="rentOut animate">
                        <a href="/property-to-rent-list?country={{rent['property'].get('country',{}).get('code','')}}&city={{rent['property'].get('city',{}).get('id','')}}" class="btn siteLink">{{_('此房源已租出，查看其他房源')}}</a>
                    </p>
                    % end
                    % if 'short_id' in rent['property'] and rent.get('property',{}).get('short_id',''):
                    <p class="shortid animate">
                        <span class="label">{{_('房源编号: ')}}</span><span class="id">{{rent.get('property',{}).get('short_id','')}}</span>
                    </p>
                    %end
                </div>

            </div>
            <div class="bottomBox coverBackBottom animate">

                <div class="linkWrap clearfix">

                    % if not rent.get('status')=='rent':
                    <div class="siteLinkBox">
                        <a href="/app-download" class="btn siteLink">{{_('我也要发布')}}</a>
                    </div>
                    <div class="siteLinkBox">
                        <a href="/property-to-rent-list?country={{rent['property'].get('country',{}).get('code','')}}&city={{rent['property'].get('city',{}).get('id','')}}" class="btn siteLink">{{_('查看更多房源')}}</a>
                    </div>
                    % elif rent.get('status') == 'rent':
                    <div class="rentOut">
                        <a href="/app-download" class="btn siteLink">{{_('我有出租需求')}}</a>
                    </div>
                    % end

                </div>
                <div class="copyright clearfix">
                    <div class="poweredBy">POWERED BY</div>
                    <div class="logoBox">
                        <div class="logo"></div>
                    </div>
                </div>

                <!--避免在iOS微信中最后一页动画结束后上半部分消失的bug-->
                <div class="scrollUp">{{_('继续')}}</div>
            </div>
        </div>
    </div>
</div>

<!--更多描述弹出层 start-->
<div class="descriptionMore hide modal" data-trigger="viewMoreBtn">
    <p>
        {{rent.get('description','')}}
    </p>
    <a class="btn btnCloseModal" id="closeViewMoreBtn">{{_('收起')}}</a>
</div>
<!--更多描述弹出层 end-->
<!--更多设施弹出层 start-->
<div class="facilitiesMore hide modal" data-trigger="morefacilitiesBtn">
    <h2 class="animate">{{_('居家设施')}}</h2>
    <!-- 等图标设计完成后再做sprites-->
    <ul class="facilities clearfix">
        % for item in rent['property'].get('indoor_facility',[]):
        <li class="animate"><i class="icon-{{item.get('slug','')}}"></i><span>{{item.get('value','')}}</span></li>
        % end
        <!--<li class="animate"><i class="tvIcon"></i><span>电视机</span></li>
        <li class="animate"><i class="fireIcon"></i><span>天然气</span></li>
        <li class="animate"><i class="iceIcon"></i><span>电冰箱</span></li>
        <li class="animate gray"><i class="heaterIcon gray"></i><span>热水器</span></li>
        <li class="animate"><i class="washerIcon"></i><span>洗衣机</span></li>
        <li class="animate"><i class="warmIcon"></i><span>暖气</span></li>-->
    </ul>
    <h2 class="animate">{{_('社区设施')}}</h2>
    <ul class="facilities clearfix">
        % for item in rent['property'].get('community_facility',[]):
        <li class="animate"><i class="icon-{{item.get('slug','')}}"></i><span>{{item.get('value','')}}</span></li>
        %end
    </ul>
    <a class="btn btnCloseModal" id="closeFacilitiesMoreBtn">{{_('收起')}}</a>
</div>
<!--更多设施弹出层 end-->
<!--更多周边弹出层 start-->
% if rent['property'].get('featured_facility') and len(rent['property'].get('featured_facility')) > 3:
<div class="featuredFacilitiesMore hide modal" data-trigger="moreFeaturedFacilitiesBtn">
    <div class="location">
        <p>
            <i class="icon-location"></i>
            <br/>
            <span>
                {{rent['property'].get('floor','')}}
                % if rent.get('property',{}).get('house_name') and rent.get('property',{}).get('floor'):
                -
                % end
                {{rent['property'].get('house_name','')}}
                % if rent.get('property',{}).get('house_name') or rent.get('property',{}).get('floor'):
                ,
                %end
                % if rent['property'].get('community',''):
                {{rent['property'].get('community','')}},
                % end
                % if rent['property'].get('street',''):
                {{rent['property'].get('street','')}},
                % end
                {{rent['property'].get('city',{}).get('name','')}},
                {{get_country_name_by_code(rent['property'].get('country',{}).get('code',''))}},
                {{rent['property'].get('zipcode','')}}
            </span>
        </p>
    </div>

    <div class="surrouding">
        <ul class="content clearfix">
            % for item in rent['property'].get('featured_facility'):
            <li>
                <p class="title">{{item.get(item.get('type',{}).get('slug'),{}).get('name','')}}</p>
                <p class="facilityType">{{item.get('type',{}).get('value')}}</p>
                % matches = [time_item for time_item in item.get('traffic_time') if time_item.get('default') == True]
                % if len(matches) == 0:
                % time_item = item.get('traffic_time')[0]
                % else:
                % time_item = matches[0]
                % end
                <p class="time">
                    <i class="{{time_item.get('type',{}).get('iconfont')}}"></i>
                    %if time_item.get('time',{}).get('unit') == 'minute':
                    <span>{{time_item.get('time',{}).get('value')}}min</span>
                    %elif time_item.get('time',{}).get('unit') == 'second':
                    <span>{{1 if int(float(time_item.get('time',{}).get('value'))/60) == 0 else int(float(time_item.get('time',{}).get('value'))/60)}}min</span>
                    %end
                </p>
            </li>
            % end
        </ul>
    </div>
    <a class="btn btnCloseModal">{{_('收起')}}</a>
</div>
% end

<!--更多周边弹出层 end-->

<!--@@close-->

<!--@@block =scripts -->
<!--build:js /static/scripts/wechat_poster.html.js-->
<script type="text/javascript" src="/static/scripts/wechat_poster.js"></script>
<!--endbuild-->

<script>
    (function () {
        function initMapSrc(config){
            config.height = parseInt(config.width * $(window).height() / $(window).width())
            var baseSrc = 'http://dev.virtualearth.net/REST/v1/Imagery/Map/Road/{centerPoint}/{zoomLevel}?mapSize={width},{height}&mapLayer=TrafficFlow&format=jpeg&key={key}'
            if(config.centerPoint !== ',') {
                for(var k in config) {
                    baseSrc = baseSrc.replace('{' + k + '}', config[k])
                }
                $('.mapImage').css({
                    'background-image': 'url(' + baseSrc + ')'
                })
            } else {
                $('.mapImage').css({
                    'background': 'rgba(255,255,255,0.6)'
                }).find('.pushpin').addClass('noLocation').text(window.i18n('该房产暂无定位信息'))

            }
        }
        initMapSrc({
            key: 'AhibVPHzPshn8-vEIdCx0so7vCuuLPSMK7qLP3gej-HyzvYv4GJWbc4_FmRvbh43',
            width: 600,
            centerPoint: '{{rent["property"].get("latitude","")}},{{rent["property"].get("longitude","")}}',
            zoomLevel: 14
        })

        /*
         * Weixin share sdk
         * */
        var wechatShareData = {
                title: '{{rent.get('title','')}}',
                link: window.location.href,
                success:function(){
                    ga('send', 'event', 'wechat_poster', 'share', 'share-to-wechat-success')
                },
                cancel:function(){
                    ga('send', 'event', 'wechat_poster', 'share', 'share-to-wechat-cancel')
                }
            }
        % if rent['property'].get('reality_images'):
        wechatShareData.imgUrl = '{{rent['property'].get('reality_images')[0]}}' + '_thumbnail'
        %end


        %if rent.get('description'):
        wechatShareData.desc = '{{rent.get('description').replace('\n','\\n').replace('\r\n','\\r\\n')}}'.replace(/(\r\n|\n|\r)/gm,'').slice(0,100)

        %end

        window.wechatShareSDK.init(wechatShareData)
    })()
</script>
<!--@@close-->

