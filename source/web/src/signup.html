<!--@@master=masters/signin_master.html -->

<!--@@block=head -->
<!--build:css(dist) /static/styles/project/signup.html.css-->
<link rel="stylesheet" href="/static/styles/project/signupForm.css"/>
<link href="/static/styles/recaptcha.css" rel="stylesheet"/>
<!--endbuild-->
<!--@@close-->

<!--@@block=main -->
<!-- @@include =partials/signup_form.html -->
<!--@@close-->

<!--@@block=scripts -->

<script>
 function showRecaptcha() {

 }

 function getRecaptchaChallenge() {
     return  ''
 }

 function getRecaptchaResponse() {
     return  ''
 }

 $(function () {
     showRecaptcha()
     var errorArea = $('form[name=register]').find('.errorMessage')
     $('form[name=register]').submit(function (e) {
         e.preventDefault()
         errorArea.hide()

         var valid = $.validate(this, {onError: function (dom, validator, index) {
             errorArea.text(window.getErrorMessage(dom.name, validator))
             errorArea.show()
         }})

         if (!valid) {
             return
         }

         var params = $(this).serializeObject()
         params.password = Base64.encode(params.password)
         params['challenge'] = getRecaptchaChallenge()
         params['solution'] = getRecaptchaResponse()
         $.betterPost("/api/1/user/register", params)
                                 .done(function () {
                                     project.goToIntention()
                                 }).fail(function (ret) {
                                     errorArea.append(window.getErrorMessageFromErrorCode(ret))
                                 }).always(function () {
                                     //refresh it for may user submit fail, or submit again with another account
                                     showRecaptcha()
                                 })
     })


 })


</script>
<!--@@close-->
