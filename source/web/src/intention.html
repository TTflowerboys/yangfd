<!--@@master = masters/big_picture_bg_master.html-->

<!--@@block = head-->
<link rel="stylesheet" href="/static/styles/intentionPage.css"/>
<!--@@close-->

<!--@@block = main-->
<form class="box intentionPage" name="intentionForm">
    <div class="header">
        <h1>还差最后一步就可以看到为您推荐的投资机会了！</h1>
        <div class="action">
            <button type="submit" disabled>确定</button>
            <a href="/">跳过 &gt;</a>
        </div>
    </div>
    <hr/>
    <div class="row budget">
        <label>您的预算：</label>
        <div class="controls">

            %for index, budget in enumerate(budget_list):
            %if budget.get('currency') == _.currency:
            <label class="toggleTag"><input name="budget" type="radio" value="{{budget.get('id')}}"/>{{_i18n(budget.get('value'))}}</label>
            %end
            %end
        </div>
    </div>
    <!-- @@include=partials/intention_tabs.html -->
</form>
<!--@@close-->
<!--@@block = scripts-->
<script>
    (function () {
        var $form = $('form[name=intentionForm]')

        $('[data-tabs]').tabs().on('mouseover', 'li', function (e) {
            var tabName = $(e.currentTarget).find('[data-tab]').data('tab')
            $(e.currentTarget).addClass('indicator').siblings().removeClass('indicator')
            $(e.delegateTarget).find('[data-tab-name=' + tabName + ']').show().siblings().hide()
        })

        $form.find('[name=budget]').on('change', function () {
            $(this).parent().toggleClass('selected', this.checked)
                .siblings().removeClass('selected')
        })

        $form.find('[name=intention]').on('change', function () {
            $(this).closest('li').toggleClass('selected', this.checked)
        })

        $form.find('[name]').on('change', function () {
            var data = $form.serializeObject()
            $form.find('[type=submit]').prop('disabled', _.isEmpty(data))
        })

        $form.submit(function (e) {
            e.preventDefault()
            var data = $(this).serializeObject()
            if (_.isEmpty(data)) { location.href = '/' }
            $form.find('[type=submit]').css({cursor: 'wait'})
            $.post('/api/1/user/edit', data)
                .always(function () {
                    location.href = '/'
                    $form.find('[type=submit]').css({cursor: 'default'})
                })
        })

    })()
</script>
<!--@@close-->
